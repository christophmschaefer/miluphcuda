\hypertarget{xsph_8cu_source}{}\doxysection{xsph.\+cu}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001 /**}
\DoxyCodeLine{00002  * @author      Christoph Schaefer cm.schaefer@gmail.com}
\DoxyCodeLine{00003  *}
\DoxyCodeLine{00004  * @section     LICENSE}
\DoxyCodeLine{00005  * Copyright (c) 2019 Christoph Schaefer}
\DoxyCodeLine{00006  *}
\DoxyCodeLine{00007  * This file is part of miluphcuda.}
\DoxyCodeLine{00008  *}
\DoxyCodeLine{00009  * miluphcuda is free software: you can redistribute it and/or modify}
\DoxyCodeLine{00010  * it under the terms of the GNU General Public License as published by}
\DoxyCodeLine{00011  * the Free Software Foundation, either version 3 of the License, or}
\DoxyCodeLine{00012  * (at your option) any later version.}
\DoxyCodeLine{00013  *}
\DoxyCodeLine{00014  * miluphcuda is distributed in the hope that it will be useful,}
\DoxyCodeLine{00015  * but WITHOUT ANY WARRANTY; without even the implied warranty of}
\DoxyCodeLine{00016  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
\DoxyCodeLine{00017  * GNU General Public License for more details.}
\DoxyCodeLine{00018  *}
\DoxyCodeLine{00019  * You should have received a copy of the GNU General Public License}
\DoxyCodeLine{00020  * along with miluphcuda.  If not, see <http://www.gnu.org/licenses/>.}
\DoxyCodeLine{00021  *}
\DoxyCodeLine{00022  */}
\DoxyCodeLine{00023 \#include "{}xsph.h"{}}
\DoxyCodeLine{00024 \#include "{}miluph.h"{}}
\DoxyCodeLine{00025 \#include "{}timeintegration.h"{}}
\DoxyCodeLine{00026 \#include "{}parameter.h"{}}
\DoxyCodeLine{00027 \#include "{}pressure.h"{}}
\DoxyCodeLine{00028 \#include "{}kernel.h"{}}
\DoxyCodeLine{00029 }
\DoxyCodeLine{00030 }
\DoxyCodeLine{00031 extern \_\_device\_\_ SPH\_kernel kernel;}
\DoxyCodeLine{00032 }
\DoxyCodeLine{00033 }
\DoxyCodeLine{00034 \_\_global\_\_ void calculateXSPHchanges(int *interactions)}
\DoxyCodeLine{00035 \{}
\DoxyCodeLine{00036 }
\DoxyCodeLine{00037     register int i, k, inc, j, numInteractions;}
\DoxyCodeLine{00038 }
\DoxyCodeLine{00039     double W;}
\DoxyCodeLine{00040     double dWdx[DIM];}
\DoxyCodeLine{00041     double dWdr;}
\DoxyCodeLine{00042     double dx[DIM];}
\DoxyCodeLine{00043     double hbar;}
\DoxyCodeLine{00044     double densityi, densityj;}
\DoxyCodeLine{00045 }
\DoxyCodeLine{00046     double vx;}
\DoxyCodeLine{00047 \#if DIM > 1}
\DoxyCodeLine{00048     double vy;}
\DoxyCodeLine{00049 \#endif}
\DoxyCodeLine{00050 \#if DIM > 2}
\DoxyCodeLine{00051     double vz;}
\DoxyCodeLine{00052 \#endif}
\DoxyCodeLine{00053 }
\DoxyCodeLine{00054     double dvx;}
\DoxyCodeLine{00055 \#if DIM > 1}
\DoxyCodeLine{00056     double dvy;}
\DoxyCodeLine{00057 \#endif}
\DoxyCodeLine{00058 \#if DIM > 2}
\DoxyCodeLine{00059     double dvz;}
\DoxyCodeLine{00060 \#endif}
\DoxyCodeLine{00061 }
\DoxyCodeLine{00062     inc = blockDim.x * gridDim.x;}
\DoxyCodeLine{00063     // particle loop to smooth velocity field}
\DoxyCodeLine{00064     for (i = threadIdx.x + blockIdx.x * blockDim.x; i < numParticles; i += inc) \{}
\DoxyCodeLine{00065         if (EOS\_TYPE\_IGNORE == matEOS[p\_rhs.materialId[i]] || EOS\_TYPE\_IGNORE == p\_rhs.materialId[i]) \{}
\DoxyCodeLine{00066                 continue;}
\DoxyCodeLine{00067         \}}
\DoxyCodeLine{00068         numInteractions = p.noi[i];}
\DoxyCodeLine{00069         hbar = p.h[i];}
\DoxyCodeLine{00070         vx = p.vx[i];}
\DoxyCodeLine{00071 \#if DIM > 1}
\DoxyCodeLine{00072         vy = p.vy[i];}
\DoxyCodeLine{00073 \#if DIM == 3}
\DoxyCodeLine{00074         vz = p.vz[i];}
\DoxyCodeLine{00075 \#endif}
\DoxyCodeLine{00076 \#endif}
\DoxyCodeLine{00077         densityi = p.rho[i];}
\DoxyCodeLine{00078         p.xsphvx[i] = 0.0;}
\DoxyCodeLine{00079 \#if DIM > 1}
\DoxyCodeLine{00080         p.xsphvy[i] = 0.0;}
\DoxyCodeLine{00081 \#if DIM == 3}
\DoxyCodeLine{00082         p.xsphvz[i] = 0.0;}
\DoxyCodeLine{00083 \#endif}
\DoxyCodeLine{00084 \#endif}
\DoxyCodeLine{00085         // neighbours loop}
\DoxyCodeLine{00086         for (k = 0; k < numInteractions; k++) \{}
\DoxyCodeLine{00087             j = interactions[i * MAX\_NUM\_INTERACTIONS + k];}
\DoxyCodeLine{00088 }
\DoxyCodeLine{00089             // if j is brush, continue}
\DoxyCodeLine{00090             if (EOS\_TYPE\_IGNORE == matEOS[p\_rhs.materialId[j]] || EOS\_TYPE\_IGNORE == p\_rhs.materialId[j]) \{}
\DoxyCodeLine{00091                 continue;}
\DoxyCodeLine{00092             \}}
\DoxyCodeLine{00093 }
\DoxyCodeLine{00094 \#if VARIABLE\_SML}
\DoxyCodeLine{00095             hbar = 0.5*(p.h[i] + p.h[j]);}
\DoxyCodeLine{00096 \#endif}
\DoxyCodeLine{00097 }
\DoxyCodeLine{00098             densityj = p.rho[j];}
\DoxyCodeLine{00099             dx[0] = p.x[i] -\/ p.x[j];}
\DoxyCodeLine{00100 \#if DIM > 1}
\DoxyCodeLine{00101             dx[1] = p.y[i] -\/ p.y[j];}
\DoxyCodeLine{00102 \#if DIM > 2}
\DoxyCodeLine{00103             dx[2] = p.z[i] -\/ p.z[j];}
\DoxyCodeLine{00104 \#endif}
\DoxyCodeLine{00105 \#endif}
\DoxyCodeLine{00106             kernel(\&W, dWdx, \&dWdr, dx, hbar);}
\DoxyCodeLine{00107 }
\DoxyCodeLine{00108             dvx = vx -\/ p.vx[j];}
\DoxyCodeLine{00109 \#if DIM > 1}
\DoxyCodeLine{00110             dvy = vy -\/ p.vy[j];}
\DoxyCodeLine{00111 \#if DIM == 3}
\DoxyCodeLine{00112             dvz = vz -\/ p.vz[j];}
\DoxyCodeLine{00113 \#endif}
\DoxyCodeLine{00114 \#endif}
\DoxyCodeLine{00115             p.xsphvx[i] -\/= p.m[j] / (0.5 * (densityi + densityj)) * W * dvx;}
\DoxyCodeLine{00116 \#if DIM > 1}
\DoxyCodeLine{00117             p.xsphvy[i] -\/= p.m[j] / (0.5 * (densityi + densityj)) * W * dvy;}
\DoxyCodeLine{00118 \#if DIM == 3}
\DoxyCodeLine{00119             p.xsphvz[i] -\/= p.m[j] / (0.5 * (densityi + densityj)) * W * dvz;}
\DoxyCodeLine{00120 \#endif}
\DoxyCodeLine{00121 \#endif}
\DoxyCodeLine{00122         \} /* neighbours loop end */}
\DoxyCodeLine{00123     \}  /* first particle loop end */}
\DoxyCodeLine{00124 }
\DoxyCodeLine{00125 \}}

\end{DoxyCode}
