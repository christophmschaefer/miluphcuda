\hypertarget{pressure_8cu_source}{}\doxysection{pressure.\+cu}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001 /**}
\DoxyCodeLine{00002  * @author      Oliver Wandel, Christoph Burger, Christoph Schaefer and Thomas I. Maindl}
\DoxyCodeLine{00003  *}
\DoxyCodeLine{00004  * @section     LICENSE}
\DoxyCodeLine{00005  * Copyright (c) 2019 Christoph Schaefer}
\DoxyCodeLine{00006  *}
\DoxyCodeLine{00007  * This file is part of miluphcuda.}
\DoxyCodeLine{00008  *}
\DoxyCodeLine{00009  * miluphcuda is free software: you can redistribute it and/or modify}
\DoxyCodeLine{00010  * it under the terms of the GNU General Public License as published by}
\DoxyCodeLine{00011  * the Free Software Foundation, either version 3 of the License, or}
\DoxyCodeLine{00012  * (at your option) any later version.}
\DoxyCodeLine{00013  *}
\DoxyCodeLine{00014  * miluphcuda is distributed in the hope that it will be useful,}
\DoxyCodeLine{00015  * but WITHOUT ANY WARRANTY; without even the implied warranty of}
\DoxyCodeLine{00016  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
\DoxyCodeLine{00017  * GNU General Public License for more details.}
\DoxyCodeLine{00018  *}
\DoxyCodeLine{00019  * You should have received a copy of the GNU General Public License}
\DoxyCodeLine{00020  * along with miluphcuda.  If not, see <http://www.gnu.org/licenses/>.}
\DoxyCodeLine{00021  *}
\DoxyCodeLine{00022  */}
\DoxyCodeLine{00023 }
\DoxyCodeLine{00024 }
\DoxyCodeLine{00025 \#include "{}pressure.h"{}}
\DoxyCodeLine{00026 \#include "{}parameter.h"{}}
\DoxyCodeLine{00027 \#include "{}miluph.h"{}}
\DoxyCodeLine{00028 \#include "{}aneos.h"{}}
\DoxyCodeLine{00029 }
\DoxyCodeLine{00030 \_\_global\_\_ void calculatePressure() \{}
\DoxyCodeLine{00031     register int i, inc, matId;}
\DoxyCodeLine{00032     register double eta, e, rho, mu, p1, p2;}
\DoxyCodeLine{00033         int i\_rho, i\_e;}
\DoxyCodeLine{00034     double pressure;}
\DoxyCodeLine{00035     inc = blockDim.x * gridDim.x;}
\DoxyCodeLine{00036     for (i = threadIdx.x + blockIdx.x * blockDim.x; i < numParticles; i += inc) \{}
\DoxyCodeLine{00037         pressure = 0.0;}
\DoxyCodeLine{00038         matId = p\_rhs.materialId[i];}
\DoxyCodeLine{00039         if (EOS\_TYPE\_IGNORE == matEOS[matId] || matId == EOS\_TYPE\_IGNORE) \{}
\DoxyCodeLine{00040             continue;}
\DoxyCodeLine{00041         \}}
\DoxyCodeLine{00042         if (EOS\_TYPE\_POLYTROPIC\_GAS == matEOS[matId]) \{}
\DoxyCodeLine{00043             p.p[i] = matPolytropicK[matId] * pow(p.rho[i], matPolytropicGamma[matId]);}
\DoxyCodeLine{00044         \} else if (EOS\_TYPE\_IDEAL\_GAS == matEOS[matId]) \{}
\DoxyCodeLine{00045             p.p[i] = (matPolytropicGamma[matId] -\/ 1) * p.rho[i] * p.e[i];}
\DoxyCodeLine{00046         \} else if (EOS\_TYPE\_LOCALLY\_ISOTHERMAL\_GAS == matEOS[matId]) \{}
\DoxyCodeLine{00047             p.p[i] = p.cs[i]*p.cs[i] * p.rho[i];}
\DoxyCodeLine{00048         \} else if (EOS\_TYPE\_ISOTHERMAL\_GAS == matEOS[matId]) \{}
\DoxyCodeLine{00049             /* this is pure molecular hydrogen at 10 K */}
\DoxyCodeLine{00050                         p.p[i] = 41255.407 * p.rho[i];}
\DoxyCodeLine{00051                 \} else if (EOS\_TYPE\_MURNAGHAN == matEOS[matId] || EOS\_TYPE\_VISCOUS\_REGOLITH == matEOS[matId]) \{}
\DoxyCodeLine{00052                         eta = p.rho[i] / matRho0[matId];}
\DoxyCodeLine{00053                         if (eta < matRhoLimit[matId]) \{}
\DoxyCodeLine{00054                                 p.p[i] = 0.0;}
\DoxyCodeLine{00055                         \} else \{}
\DoxyCodeLine{00056                                 p.p[i] = (matBulkmodulus[matId]/matN[matId])*(pow(eta, matN[matId]) -\/ 1.0);}
\DoxyCodeLine{00057                         \}}
\DoxyCodeLine{00058                 \} else if (EOS\_TYPE\_TILLOTSON == matEOS[matId]) \{}
\DoxyCodeLine{00059                         rho = p.rho[i];}
\DoxyCodeLine{00060                         e = p.e[i];}
\DoxyCodeLine{00061                         eta = rho / matTillRho0[matId];}
\DoxyCodeLine{00062                         mu = eta -\/ 1.0;}
\DoxyCodeLine{00063                         if (eta < matRhoLimit[matId] \&\& e < matTillEcv[matId]) \{}
\DoxyCodeLine{00064                                 p.p[i] = 0.0;}
\DoxyCodeLine{00065                         \} else \{}
\DoxyCodeLine{00066                                 if (e <= matTillEiv[matId] || eta >= 1.0) \{}
\DoxyCodeLine{00067                                         p.p[i] = (matTilla[matId] + matTillb[matId]/(e/(eta*eta*matTillE0[matId])+1.0))}
\DoxyCodeLine{00068                                                    * rho * e + matTillA[matId]*mu + matTillB[matId]*mu*mu;}
\DoxyCodeLine{00069                                 \} else if (e >= matTillEcv[matId] \&\& eta >= 0.0) \{}
\DoxyCodeLine{00070                                         p.p[i] = matTilla[matId]*rho*e + (matTillb[matId]*rho*e/(e/(eta*eta*matTillE0[matId])+1.0)}
\DoxyCodeLine{00071                                                    + matTillA[matId] * mu * exp(-\/matTillBeta[matId]*(matTillRho0[matId]/rho -\/ 1.0)))}
\DoxyCodeLine{00072                                                    * exp(-\/matTillAlpha[matId] * (pow(matTillRho0[matId]/rho-\/1.0, 2)));}
\DoxyCodeLine{00073                                 \} else if (e > matTillEiv[matId] \&\& e < matTillEcv[matId]) \{}
\DoxyCodeLine{00074                                         // for intermediate states:}
\DoxyCodeLine{00075                                         // weighted average of pressures calculated by expanded}
\DoxyCodeLine{00076                                         // and compressed versions of Tillotson (both evaluated at e)}
\DoxyCodeLine{00077                                         p1 = (matTilla[matId]+matTillb[matId]/(e/(eta*eta*matTillE0[matId])+1.0)) * rho*e}
\DoxyCodeLine{00078                                            + matTillA[matId]*mu + matTillB[matId]*mu*mu;}
\DoxyCodeLine{00079                                         p2 = matTilla[matId]*rho*e + (matTillb[matId]*rho*e/(e/(eta*eta*matTillE0[matId])+1.0)}
\DoxyCodeLine{00080                                            + matTillA[matId] * mu * exp(-\/matTillBeta[matId]*(matTillRho0[matId]/rho -\/1.0)))}
\DoxyCodeLine{00081                                            * exp(-\/matTillAlpha[matId] * (pow(matTillRho0[matId]/rho-\/1.0, 2)));}
\DoxyCodeLine{00082                                         p.p[i] = ( p1*(matTillEcv[matId]-\/e) + p2*(e-\/matTillEiv[matId]) ) / (matTillEcv[matId]-\/matTillEiv[matId]);}
\DoxyCodeLine{00083                                 \} else \{}
\DoxyCodeLine{00084                                         printf("{}\(\backslash\)n\(\backslash\)nDeep trouble in pressure.\(\backslash\)nenergy[\%d] = \%e\(\backslash\)nE\_iv = \%e, E\_cv = \%e\(\backslash\)n\(\backslash\)n"{}, i, e, matTillEiv[matId], matTillEcv[matId]);}
\DoxyCodeLine{00085                                         p.p[i] = 0.0;}
\DoxyCodeLine{00086                                 \}}
\DoxyCodeLine{00087                         \}}
\DoxyCodeLine{00088         \} else if (EOS\_TYPE\_ANEOS == matEOS[matId]) \{}
\DoxyCodeLine{00089             /* find array-\/indices just below the actual values of rho and e */}
\DoxyCodeLine{00090             i\_rho = array\_index(p.rho[i], aneos\_rho\_c+aneos\_rho\_id\_c[matId], aneos\_n\_rho\_c[matId]);}
\DoxyCodeLine{00091             i\_e = array\_index(p.e[i], aneos\_e\_c+aneos\_e\_id\_c[matId], aneos\_n\_e\_c[matId]);}
\DoxyCodeLine{00092             /* interpolate (bi)linearly to obtain the pressure and other quantities of interest*/}
\DoxyCodeLine{00093             p.p[i] = bilinear\_interpolation\_from\_linearized(p.rho[i], p.e[i], aneos\_p\_c+aneos\_matrix\_id\_c[matId], aneos\_rho\_c+aneos\_rho\_id\_c[matId], aneos\_e\_c+aneos\_e\_id\_c[matId], i\_rho, i\_e, aneos\_n\_rho\_c[matId], aneos\_n\_e\_c[matId]);}
\DoxyCodeLine{00094 \#if SIRONO\_POROSITY}
\DoxyCodeLine{00095         \} else if (matEOS[matId] == EOS\_TYPE\_SIRONO) \{}
\DoxyCodeLine{00096             double K\_0 = matporsirono\_K\_0[matId];}
\DoxyCodeLine{00097             double rho\_0 = matporsirono\_rho\_0[matId];}
\DoxyCodeLine{00098             double gamma\_K = matporsirono\_gamma\_K[matId];}
\DoxyCodeLine{00099             pressure = p.K[i] * (p.rho[i] / p.rho\_0prime[i] -\/ 1.0);}
\DoxyCodeLine{00100             p.flag\_rho\_0prime[i] = -\/1;}
\DoxyCodeLine{00101             if (pressure >= 0.0) \{}
\DoxyCodeLine{00102                 if (p.rho[i] >= p.rho\_c\_plus[i]) \{}
\DoxyCodeLine{00103                     if (pressure >= p.compressive\_strength[i]) \{}
\DoxyCodeLine{00104                         pressure = p.compressive\_strength[i];}
\DoxyCodeLine{00105                         p.flag\_plastic[i] = 1;}
\DoxyCodeLine{00106                         p.rho\_c\_plus[i] = p.rho[i];}
\DoxyCodeLine{00107                         p.flag\_rho\_0prime[i] = 1;}
\DoxyCodeLine{00108                     \} else \{}
\DoxyCodeLine{00109                         p.flag\_plastic[i] = -\/1;}
\DoxyCodeLine{00110                         p.flag\_rho\_0prime[i] = -\/1;}
\DoxyCodeLine{00111                     \}}
\DoxyCodeLine{00112                 \} else \{}
\DoxyCodeLine{00113                     if (pressure >= p.compressive\_strength[i]) \{}
\DoxyCodeLine{00114                         pressure = p.compressive\_strength[i];}
\DoxyCodeLine{00115                     \}}
\DoxyCodeLine{00116                     if (p.flag\_plastic[i] == 1) \{}
\DoxyCodeLine{00117                         p.flag\_rho\_0prime[i] = 1;}
\DoxyCodeLine{00118                         p.flag\_plastic[i] = -\/1;}
\DoxyCodeLine{00119                     \} else \{}
\DoxyCodeLine{00120                         p.flag\_rho\_0prime[i] = -\/1;}
\DoxyCodeLine{00121                         p.flag\_plastic[i] = -\/1;}
\DoxyCodeLine{00122                     \}}
\DoxyCodeLine{00123                 \}}
\DoxyCodeLine{00124             \} else \{}
\DoxyCodeLine{00125                 if (p.rho[i] <= p.rho\_c\_minus[i]) \{}
\DoxyCodeLine{00126                     if (pressure <= p.tensile\_strength[i]) \{}
\DoxyCodeLine{00127                         pressure = p.tensile\_strength[i];}
\DoxyCodeLine{00128                         p.flag\_plastic[i] = 1;}
\DoxyCodeLine{00129                         p.rho\_c\_minus[i] = p.rho[i];}
\DoxyCodeLine{00130                         p.flag\_rho\_0prime[i] = 1;}
\DoxyCodeLine{00131                     \} else \{}
\DoxyCodeLine{00132                         p.flag\_plastic[i] = -\/1;}
\DoxyCodeLine{00133                         p.flag\_rho\_0prime[i] = -\/1;}
\DoxyCodeLine{00134                     \}}
\DoxyCodeLine{00135                 \} else \{}
\DoxyCodeLine{00136                     if (pressure <= p.tensile\_strength[i]) \{}
\DoxyCodeLine{00137                         pressure = p.tensile\_strength[i];}
\DoxyCodeLine{00138                     \}}
\DoxyCodeLine{00139                     if (p.flag\_plastic[i] == 1) \{}
\DoxyCodeLine{00140                         p.flag\_rho\_0prime[i] = 1;}
\DoxyCodeLine{00141                         p.flag\_plastic[i] = -\/1;}
\DoxyCodeLine{00142                     \} else \{}
\DoxyCodeLine{00143                         p.flag\_plastic[i] = -\/1;}
\DoxyCodeLine{00144                         p.flag\_rho\_0prime[i] = -\/1;}
\DoxyCodeLine{00145                     \}}
\DoxyCodeLine{00146                 \}}
\DoxyCodeLine{00147             \}}
\DoxyCodeLine{00148             /* determine new rho\_0prime and K if flag is set */}
\DoxyCodeLine{00149             if (p.flag\_rho\_0prime[i] == 1) \{}
\DoxyCodeLine{00150                 p.flag\_rho\_0prime[i] = -\/1;}
\DoxyCodeLine{00151                 p.flag\_plastic[i] = -\/1;}
\DoxyCodeLine{00152                 p.K[i] = K\_0 * pow((p.rho[i] / rho\_0), gamma\_K);}
\DoxyCodeLine{00153                 if (p.K[i] < 2000.0) \{}
\DoxyCodeLine{00154                     p.K[i] = 2000.0;}
\DoxyCodeLine{00155                     printf("{}p.K[\%d] is small and set to 2000.0"{}, i);}
\DoxyCodeLine{00156                 \}}
\DoxyCodeLine{00157                 p.rho\_0prime[i] = p.rho[i] / (1.0 + (pressure / p.K[i]));}
\DoxyCodeLine{00158             \}}
\DoxyCodeLine{00159             p.p[i] = pressure;}
\DoxyCodeLine{00160 \#endif}
\DoxyCodeLine{00161 \#if PALPHA\_POROSITY}
\DoxyCodeLine{00162         \} else if (matEOS[matId] == EOS\_TYPE\_JUTZI || matEOS[matId] == EOS\_TYPE\_JUTZI\_MURNAGHAN) \{}
\DoxyCodeLine{00163             double pressure\_solid = 0.0;}
\DoxyCodeLine{00164             double p\_e = matporjutzi\_p\_elastic[matId];          /* pressure at which the material switches from elastic to plastic */}
\DoxyCodeLine{00165             double p\_t = matporjutzi\_p\_transition[matId]; /* pressure indicating a transition */}
\DoxyCodeLine{00166             double p\_s = matporjutzi\_p\_compacted[matId];  /* pressure at which all pores are compacted (alpha = 1) */}
\DoxyCodeLine{00167             double alpha\_0 = matporjutzi\_alpha\_0[matId];  /* distention at which the material switches from elastic to plastic */}
\DoxyCodeLine{00168             double alpha\_t = matporjutzi\_alpha\_t[matId];  /* distention indicating a transition */}
\DoxyCodeLine{00169             double n1 = matporjutzi\_n1[matId];                  /* individual slope */}
\DoxyCodeLine{00170             double n2 = matporjutzi\_n2[matId];                  /* individual slope */}
\DoxyCodeLine{00171             double alpha\_e = matporjutzi\_alpha\_e[matId];        /* simplified otherwise alpha\_e = alpha(p\_e) */}
\DoxyCodeLine{00172 //            p.alpha\_jutzi\_old[i] = p.alpha\_jutzi[i];  /* saving the unchanged alpha value */}
\DoxyCodeLine{00173             int flag\_alpha\_quad;        /* if this flag is set -\/> alpha gets calculated by a quadradic equation and not via the crush curve */}
\DoxyCodeLine{00174             double dp;                  /* pressure change for the calculation of dalphadp */}
\DoxyCodeLine{00175             double rho\_0 = matTillRho0[matId];      /* parameters for Tillotson EOS -\/> calc pressure solid */}
\DoxyCodeLine{00176             double eta = p.rho[i] * p.alpha\_jutzi[i] / rho\_0;}
\DoxyCodeLine{00177                         int crushcurve\_style = matcrushcurve\_style[matId]; /* int crushcurve\_style from mat.cfg -\/> 0 is the quadratic crush curve, 1 is the real/steep crush curve by jutzi */}
\DoxyCodeLine{00178             if (matEOS[matId] == EOS\_TYPE\_JUTZI) \{}
\DoxyCodeLine{00179                 double alpha\_till = matTillAlpha[matId];}
\DoxyCodeLine{00180                 double beta\_till = matTillBeta[matId];}
\DoxyCodeLine{00181                 double a = matTilla[matId];}
\DoxyCodeLine{00182                 double b = matTillb[matId];}
\DoxyCodeLine{00183                 double A = matTillA[matId];}
\DoxyCodeLine{00184                 double B = matTillB[matId];}
\DoxyCodeLine{00185                 double E\_0 = matTillE0[matId];}
\DoxyCodeLine{00186                 double E\_iv = matTillEiv[matId];}
\DoxyCodeLine{00187                 double E\_cv = matTillEcv[matId];}
\DoxyCodeLine{00188                 p.delpdele[i] = 0.0;}
\DoxyCodeLine{00189                 p.delpdelrho[i] = 0.0;}
\DoxyCodeLine{00190                 /* calculate the pressure of the solid material and also}
\DoxyCodeLine{00191                  * calculate the derivative del p / del e and the derivative del p / del rho */}
\DoxyCodeLine{00192                 if (eta < matRhoLimit[matId] \&\& p.e[i] < E\_cv) \{}
\DoxyCodeLine{00193                     pressure\_solid = 0.0;}
\DoxyCodeLine{00194                 \} else \{}
\DoxyCodeLine{00195                     mu = eta -\/ 1.0;}
\DoxyCodeLine{00196                     if (p.e[i] < E\_iv || eta  >= 1.0) \{}
\DoxyCodeLine{00197                         pressure\_solid = (a + b / (p.e[i] / (eta * eta * E\_0) + 1.0))}
\DoxyCodeLine{00198                                        * p.rho[i] * p.alpha\_jutzi[i] * p.e[i] + A * mu + B * mu * mu;}
\DoxyCodeLine{00199                         p.delpdele[i] = a * p.rho[i] * p.alpha\_jutzi[i] + p.rho[i] * p.alpha\_jutzi[i]}
\DoxyCodeLine{00200                                       * b / (pow(p.e[i] / (E\_0 * eta * eta) + 1.0, 2));}
\DoxyCodeLine{00201                         p.delpdelrho[i] = a * p.e[i] + p.e[i] * b * (1.0 + 3.0 * p.e[i] / (E\_0 * eta * eta))}
\DoxyCodeLine{00202                                         / (pow(p.e[i] / (E\_0 * eta * eta) + 1.0, 2))}
\DoxyCodeLine{00203                                         + A / rho\_0 + 2.0 * B / rho\_0 * (eta -\/ 1.0);}
\DoxyCodeLine{00204                     \} else if (p.e[i] > E\_cv \&\& eta < 1.0) \{}
\DoxyCodeLine{00205                         pressure\_solid = a * p.rho[i] * p.alpha\_jutzi[i] * p.e[i]}
\DoxyCodeLine{00206                                        + (b * p.rho[i] * p.alpha\_jutzi[i] * p.e[i] / (p.e[i] / (eta * eta * E\_0) + 1.0)}
\DoxyCodeLine{00207                                        + A * mu * exp(-\/beta\_till * (rho\_0 / (p.rho[i] * p.alpha\_jutzi[i]) -\/ 1.0)))}
\DoxyCodeLine{00208                                        * exp(-\/alpha\_till * (pow(rho\_0 / (p.rho[i] * p.alpha\_jutzi[i]) -\/ 1.0, 2)));}
\DoxyCodeLine{00209                         p.delpdele[i] = a * p.rho[i] * p.alpha\_jutzi[i] + p.rho[i] * p.alpha\_jutzi[i] * b / (pow(p.e[i]/(E\_0 * eta * eta) + 1.0, 2))}
\DoxyCodeLine{00210                                       * exp(-\/alpha\_till * (pow(rho\_0 / (p.rho[i] * p.alpha\_jutzi[i]) -\/ 1.0, 2)));}
\DoxyCodeLine{00211                         p.delpdelrho[i] = a * p.e[i] + exp(-\/alpha\_till * (pow(rho\_0 / (p.rho[i] * p.alpha\_jutzi[i]) -\/ 1.0, 2)))}
\DoxyCodeLine{00212                                         * (2.0 * alpha\_till * rho\_0 / (p.rho[i] * p.rho[i] * p.alpha\_jutzi[i]}
\DoxyCodeLine{00213                                         * p.alpha\_jutzi[i]) * (rho\_0 / (p.rho[i] * p.alpha\_jutzi[i]) -\/ 1.0)}
\DoxyCodeLine{00214                                         * (b * p.rho[i] * p.alpha\_jutzi[i] * p.e[i] / (p.e[i] / (E\_0 * eta * eta) + 1.0)}
\DoxyCodeLine{00215                                         + A * mu * exp(-\/beta\_till * (rho\_0 / (p.rho[i] * p.alpha\_jutzi[i]) -\/ 1.0)))}
\DoxyCodeLine{00216                                         + b * p.e[i] * (1.0 + 3.0 * p.e[i] / (E\_0 * eta * eta)) / (pow(p.e[i] / (E\_0 * eta * eta) + 1.0, 2))}
\DoxyCodeLine{00217                                         + A * exp(-\/beta\_till * (rho\_0 / (p.rho[i] * p.alpha\_jutzi[i]) -\/ 1.0))}
\DoxyCodeLine{00218                                         * (1.0 / rho\_0 + beta\_till / (p.rho[i] * p.alpha\_jutzi[i])}
\DoxyCodeLine{00219                                         -\/ beta\_till * rho\_0 / (p.rho[i] * p.rho[i] * p.alpha\_jutzi[i] * p.alpha\_jutzi[i])));}
\DoxyCodeLine{00220                     \} else if (p.e[i] > E\_iv \&\& eta < 1.0) \{}
\DoxyCodeLine{00221                         /* for intermediate states:}
\DoxyCodeLine{00222                          * weighted average of pressures calculated by expanded}
\DoxyCodeLine{00223                          * and compressed versions of Tillotson (both evaluated at e)}
\DoxyCodeLine{00224                          */}
\DoxyCodeLine{00225                         p1 = (a + b / (p.e[i] / (eta * eta * E\_0) + 1.0))}
\DoxyCodeLine{00226                            * p.rho[i] * p.alpha\_jutzi[i] * p.e[i] + A * mu + B * mu * mu;}
\DoxyCodeLine{00227                         p2 = a * p.rho[i] * p.alpha\_jutzi[i] * p.e[i]}
\DoxyCodeLine{00228                            + (b * p.rho[i] * p.alpha\_jutzi[i] * p.e[i] / (p.e[i] / (eta * eta * E\_0) + 1.0)}
\DoxyCodeLine{00229                            + A * mu * exp(-\/beta\_till * (rho\_0 / (p.rho[i] * p.alpha\_jutzi[i]) -\/ 1.0)))}
\DoxyCodeLine{00230                            * exp(-\/alpha\_till * (pow(rho\_0 / (p.rho[i] * p.alpha\_jutzi[i]) -\/ 1.0, 2)));}
\DoxyCodeLine{00231                         pressure\_solid = ((p.e[i] -\/ E\_iv) * p2 + (E\_cv -\/ p.e[i]) * p1) / (E\_cv -\/ E\_iv);}
\DoxyCodeLine{00232                         p.delpdele[i] = ((p2 -\/ p1) + (p.e[i] -\/ E\_iv) * a * p.rho[i] * p.alpha\_jutzi[i]}
\DoxyCodeLine{00233                                       + p.rho[i] * p.alpha\_jutzi[i] * b / (pow(p.e[i]/(E\_0 * eta * eta) + 1.0, 2))}
\DoxyCodeLine{00234                                       * exp(-\/alpha\_till * (pow(rho\_0 / (p.rho[i] * p.alpha\_jutzi[i]) -\/ 1.0, 2)))}
\DoxyCodeLine{00235                                       + (E\_cv -\/ p.e[i]) * a * p.rho[i] * p.alpha\_jutzi[i] + p.rho[i] * p.alpha\_jutzi[i]}
\DoxyCodeLine{00236                                       * b / (pow(p.e[i] / (E\_0 * eta * eta) + 1.0, 2))) / (E\_cv -\/ E\_iv);}
\DoxyCodeLine{00237                         p.delpdelrho[i] = ((a * p.e[i] + exp(-\/alpha\_till * (pow(rho\_0 / (p.rho[i] * p.alpha\_jutzi[i]) -\/ 1.0, 2)))}
\DoxyCodeLine{00238                                         * (2.0 * alpha\_till * rho\_0 / (p.rho[i] * p.rho[i] * p.alpha\_jutzi[i]}
\DoxyCodeLine{00239                                         * p.alpha\_jutzi[i]) * (rho\_0 / (p.rho[i] * p.alpha\_jutzi[i]) -\/ 1.0)}
\DoxyCodeLine{00240                                         * (b * p.rho[i] * p.alpha\_jutzi[i] * p.e[i] / (p.e[i] / (E\_0 * eta * eta) + 1.0)}
\DoxyCodeLine{00241                                         + A * mu * exp(-\/beta\_till * (rho\_0 / (p.rho[i] * p.alpha\_jutzi[i]) -\/ 1.0)))}
\DoxyCodeLine{00242                                         + b * p.e[i] * (1.0 + 3.0 * p.e[i] / (E\_0 * eta * eta)) / (pow(p.e[i] / (E\_0 * eta * eta) + 1.0, 2))}
\DoxyCodeLine{00243                                         + A * exp(-\/beta\_till * (rho\_0 / (p.rho[i] * p.alpha\_jutzi[i]) -\/ 1.0))}
\DoxyCodeLine{00244                                         * (1.0 / rho\_0 + beta\_till / (p.rho[i] * p.alpha\_jutzi[i]) -\/ beta\_till * rho\_0}
\DoxyCodeLine{00245                                         / (p.rho[i] * p.rho[i] * p.alpha\_jutzi[i] * p.alpha\_jutzi[i])))) * (p.e[i] -\/ E\_iv)}
\DoxyCodeLine{00246                                         + (a * p.e[i] + p.e[i] * b * (1.0 + 3.0 * p.e[i]  / (E\_0 * eta * eta))}
\DoxyCodeLine{00247                                         / (pow(p.e[i] / (E\_0 * eta * eta) + 1.0, 2))}
\DoxyCodeLine{00248                                         + A / rho\_0 + 2.0 * B / rho\_0 * (eta -\/ 1.0))}
\DoxyCodeLine{00249                                         * (E\_cv -\/ p.e[i])) / (E\_cv -\/ E\_iv);}
\DoxyCodeLine{00250                     \} else \{}
\DoxyCodeLine{00251                         printf("{}Deep trouble in pressure.\(\backslash\)n"{});}
\DoxyCodeLine{00252                         printf("{}p[\%d].e = \%e\(\backslash\)n"{}, i, p.e[i]);}
\DoxyCodeLine{00253                         printf("{}E\_iv: \%e, E\_cv: \%e\(\backslash\)n"{}, E\_iv, E\_cv);}
\DoxyCodeLine{00254                         pressure\_solid = 0.0;}
\DoxyCodeLine{00255                     \}}
\DoxyCodeLine{00256                 \}}
\DoxyCodeLine{00257             \} else if (matEOS[matId] == EOS\_TYPE\_JUTZI\_MURNAGHAN) \{}
\DoxyCodeLine{00258                 double rho\_0 = matRho0[matId];}
\DoxyCodeLine{00259                 double n = matN[matId];}
\DoxyCodeLine{00260                 double K\_0 = matBulkmodulus[matId];}
\DoxyCodeLine{00261                 double eta = p.rho[i] * p.alpha\_jutzi[i] / rho\_0;}
\DoxyCodeLine{00262                 pressure\_solid = K\_0 / n * (pow(eta, n) -\/ 1.0);}
\DoxyCodeLine{00263                 p.delpdele[i] = 0.0;}
\DoxyCodeLine{00264                 p.delpdelrho[i] = K\_0 / rho\_0 * (pow(eta, n -\/ 1.0));}
\DoxyCodeLine{00265             \}}
\DoxyCodeLine{00266             pressure = pressure\_solid / p.alpha\_jutzi[i]; /* from the P-\/alpha model */}
\DoxyCodeLine{00267             /* calculate the derivative dalpha / dpressure */}
\DoxyCodeLine{00268             double dalphadp\_elastic = 0.0;}
\DoxyCodeLine{00269             // double c\_0 = 5350.0; /* If dalpha\_dp\_elastic is NOT Zero then you need values for c\_0 and c\_e */}
\DoxyCodeLine{00270             // double c\_e = 4110.0;}
\DoxyCodeLine{00271             // double h = 1 + (p.alpha\_jutzi[i] -\/ 1.0) * (c\_e -\/ c\_0) / (c\_0 * (alpha\_e -\/ 1.0));         /* needs to have c\_e and c\_0 set */}
\DoxyCodeLine{00272             // dalphadp\_elastic = p.alpha\_jutzi[i] * p.alpha\_jutzi[i] / (c\_0 * c\_0 * rho\_0) * (1.0 -\/ (1.0 / (h * h)));}
\DoxyCodeLine{00273             p.dalphadp[i] = 0.0;}
\DoxyCodeLine{00274             if (crushcurve\_style == 0) \{}
\DoxyCodeLine{00275                 if (pressure <= p\_e) \{}
\DoxyCodeLine{00276                     p.dalphadp[i] = dalphadp\_elastic;}
\DoxyCodeLine{00277                 \} else if (pressure > p\_e \&\& pressure < p\_s) \{}
\DoxyCodeLine{00278                     p.dalphadp[i] = -\/ 2.0 * (alpha\_0 -\/ 1.0) * (p\_s -\/ pressure) / (pow((p\_s -\/ p\_e), 2));}
\DoxyCodeLine{00279                 \} else if (pressure >= p\_s) \{}
\DoxyCodeLine{00280                     p.dalphadp[i] = 0.0;}
\DoxyCodeLine{00281 //                    p.alpha\_jutzi[i] = 1.0;}
\DoxyCodeLine{00282                                 \}}
\DoxyCodeLine{00283             \} else if (crushcurve\_style == 1) \{}
\DoxyCodeLine{00284                 if (pressure <= p\_e) \{}
\DoxyCodeLine{00285                     p.dalphadp[i] = dalphadp\_elastic;}
\DoxyCodeLine{00286                 \} else if (pressure > p\_e \&\& pressure < p\_t) \{}
\DoxyCodeLine{00287                     p.dalphadp[i] = -\/ ((alpha\_0 -\/ 1.0) / (alpha\_e -\/ 1.0)) * (alpha\_e -\/ alpha\_t) * n1 * (pow(p\_t -\/ pressure, n1 -\/ 1.0) / pow(p\_t -\/ p\_e, n1))}
\DoxyCodeLine{00288                                   -\/ ((alpha\_0 -\/ 1.0) / (alpha\_e -\/ 1.0)) * (alpha\_t -\/ 1.0) * n2 * (pow(p\_s -\/ pressure, n2 -\/ 1.0) / pow(p\_s -\/ p\_e, n2));}
\DoxyCodeLine{00289                 \} else if (pressure >= p\_t \&\& pressure < p\_s) \{}
\DoxyCodeLine{00290                     p.dalphadp[i] = -\/ ((alpha\_0 -\/ 1.0) / (alpha\_e -\/ 1.0)) * (alpha\_t -\/ 1.0) * n2 * (pow(p\_s -\/ pressure, n2 -\/ 1.0) / pow(p\_s -\/ p\_e, n2));}
\DoxyCodeLine{00291                 \} else if (pressure >= p\_s) \{}
\DoxyCodeLine{00292                     p.dalphadp[i] = 0.0;}
\DoxyCodeLine{00293 //                    p.alpha\_jutzi[i] = 1.0;}
\DoxyCodeLine{00294                 \}}
\DoxyCodeLine{00295             \}}
\DoxyCodeLine{00296             p.dalphadrho[i] = ((pressure / (p.rho[i] * p.rho[i]) * p.delpdele[i] + p.alpha\_jutzi[i] * p.delpdelrho[i]) * p.dalphadp[i])}
\DoxyCodeLine{00297                             / (p.alpha\_jutzi[i] + p.dalphadp[i] * (pressure -\/ p.rho[i] * p.delpdelrho[i]));}
\DoxyCodeLine{00298             p.f[i] = 1.0 + p.dalphadrho[i] * p.rho[i] / p.alpha\_jutzi[i];}
\DoxyCodeLine{00299             if (p.alpha\_jutzi[i] <= 1.0) \{}
\DoxyCodeLine{00300                 p.f[i] = 1.0;}
\DoxyCodeLine{00301                 p.alpha\_jutzi[i] = 1.0;}
\DoxyCodeLine{00302                 p.dalphadp[i] = 0.0;}
\DoxyCodeLine{00303                 p.dalphadrho[i] = 0.0;}
\DoxyCodeLine{00304             \}}
\DoxyCodeLine{00305 \#endif}
\DoxyCodeLine{00306 \#if EPSALPHA\_POROSITY}
\DoxyCodeLine{00307         \} else if (EOS\_TYPE\_EPSILON == matEOS[matId]) \{}
\DoxyCodeLine{00308             double pressure\_solid = 0.0;}
\DoxyCodeLine{00309             double rho\_0 = matTillRho0[matId];      /* parameters for Tillotson EOS -\/> calc pressure solid */}
\DoxyCodeLine{00310             double eta = p.rho[i] * p.alpha\_epspor[i] / rho\_0;}
\DoxyCodeLine{00311             double alpha\_till = matTillAlpha[matId];}
\DoxyCodeLine{00312             double beta\_till = matTillBeta[matId];}
\DoxyCodeLine{00313             double a = matTilla[matId];}
\DoxyCodeLine{00314             double b = matTillb[matId];}
\DoxyCodeLine{00315             double A = matTillA[matId];}
\DoxyCodeLine{00316             double B = matTillB[matId];}
\DoxyCodeLine{00317             double E\_0 = matTillE0[matId];}
\DoxyCodeLine{00318             double E\_iv = matTillEiv[matId];}
\DoxyCodeLine{00319             double E\_cv = matTillEcv[matId];}
\DoxyCodeLine{00320             if (eta < matRhoLimit[matId] \&\& p.e[i] < E\_cv) \{}
\DoxyCodeLine{00321                 pressure\_solid = 0.0;}
\DoxyCodeLine{00322             \} else \{}
\DoxyCodeLine{00323                 mu = eta -\/ 1.0;}
\DoxyCodeLine{00324                 if (p.e[i] <= E\_iv || eta  >= 1.0) \{}
\DoxyCodeLine{00325                     pressure\_solid = (a + b / (p.e[i] / (eta * eta * E\_0) + 1.0))}
\DoxyCodeLine{00326                                    * p.rho[i] * p.alpha\_epspor[i] * p.e[i] + A * mu + B * mu * mu;}
\DoxyCodeLine{00327                 \} else if (p.e[i] >= E\_cv \&\& eta >= 0.0) \{}
\DoxyCodeLine{00328                     pressure\_solid = a * p.rho[i] * p.alpha\_epspor[i] * p.e[i]}
\DoxyCodeLine{00329                                    + (b * p.rho[i] * p.alpha\_epspor[i] * p.e[i] / (p.e[i] / (eta * eta * E\_0) + 1.0)}
\DoxyCodeLine{00330                                    + A * mu * exp(-\/beta\_till * (rho\_0 / (p.rho[i] * p.alpha\_epspor[i]) -\/ 1.0)))}
\DoxyCodeLine{00331                                    * exp(-\/alpha\_till * (pow(rho\_0 / (p.rho[i]}
\DoxyCodeLine{00332                                    * p.alpha\_epspor[i]) -\/ 1.0, 2)));}
\DoxyCodeLine{00333                 \} else if (p.e[i] > E\_iv \&\& p.e[i] < E\_cv) \{}
\DoxyCodeLine{00334                     /* for intermediate states:}
\DoxyCodeLine{00335                     * weighted average of pressures calculated by expanded}
\DoxyCodeLine{00336                     * and compressed versions of Tillotson (both evaluated at e)}
\DoxyCodeLine{00337                     */}
\DoxyCodeLine{00338                     p1 = (a + b / (p.e[i] / (eta * eta * E\_0) + 1.0))}
\DoxyCodeLine{00339                        * p.rho[i] * p.alpha\_epspor[i] * p.e[i] + A * mu + B * mu * mu;}
\DoxyCodeLine{00340                     p2 = a * p.rho[i] * p.alpha\_epspor[i] * p.e[i]}
\DoxyCodeLine{00341                        + (b * p.rho[i] * p.alpha\_epspor[i] * p.e[i] / (p.e[i] / (eta * eta * E\_0) + 1.0)}
\DoxyCodeLine{00342                        + A * mu * exp(-\/beta\_till * (rho\_0 / (p.rho[i] * p.alpha\_epspor[i]) -\/ 1.0)))}
\DoxyCodeLine{00343                        * exp(-\/alpha\_till * (pow(rho\_0 / (p.rho[i] * p.alpha\_epspor[i]) -\/ 1.0, 2)));}
\DoxyCodeLine{00344                     pressure\_solid = ((p.e[i] -\/ E\_iv) * p2 + (E\_cv -\/ p.e[i]) * p1) / (E\_cv -\/ E\_iv);}
\DoxyCodeLine{00345                 \} else \{}
\DoxyCodeLine{00346                     printf("{}Deep trouble in pressure.\(\backslash\)n"{});}
\DoxyCodeLine{00347                     printf("{}p[\%d].e = \%e\(\backslash\)n"{}, i, p.e[i]);}
\DoxyCodeLine{00348                     printf("{}E\_iv: \%e, E\_cv: \%e\(\backslash\)n"{}, E\_iv, E\_cv);}
\DoxyCodeLine{00349                     pressure\_solid = 0.0;}
\DoxyCodeLine{00350                 \}}
\DoxyCodeLine{00351             \}}
\DoxyCodeLine{00352             pressure = pressure\_solid / p.alpha\_epspor[i]; /* from the P-\/alpha model which is also used here */}
\DoxyCodeLine{00353             p.p[i] = pressure;}
\DoxyCodeLine{00354             //            printf("{}Particle: \%d \(\backslash\)t P: \%e \(\backslash\)t Alpha: \%e \(\backslash\)t Rho: \%e \(\backslash\)t E: \%e \(\backslash\)t Mu: \%e\(\backslash\)n"{}, i, pressure, p.alpha\_epspor[i], p.rho[i], p.e[i], mu);}
\DoxyCodeLine{00355 \#endif}
\DoxyCodeLine{00356         \} else if (EOS\_TYPE\_REGOLITH == matEOS[matId]) \{}
\DoxyCodeLine{00357 \#if SOLID}
\DoxyCodeLine{00358             p.p[i] = 0.0;}
\DoxyCodeLine{00359             double I1;}
\DoxyCodeLine{00360 \#if DIM == 2}
\DoxyCodeLine{00361             double shear = matShearmodulus[matId];}
\DoxyCodeLine{00362             double bulk = matBulkmodulus[matId];}
\DoxyCodeLine{00363             double poissons\_ratio = (3.0*bulk -\/ 2.0*shear) / (2.0*(3.0*bulk + shear));}
\DoxyCodeLine{00364             I1 = (1 + poissons\_ratio) * (p.S[stressIndex(i, 0, 0)] + p.S[stressIndex(i, 1, 1)]);}
\DoxyCodeLine{00365 \#else}
\DoxyCodeLine{00366             I1 = p.S[stressIndex(i,0,0)] + p.S[stressIndex(i,1,1)] + p.S[stressIndex(i,2,2)];}
\DoxyCodeLine{00367 \#endif}
\DoxyCodeLine{00368             p.p[i] = -\/I1/3.0;}
\DoxyCodeLine{00369 \#endif}
\DoxyCodeLine{00370         \} else \{}
\DoxyCodeLine{00371             printf("{}No such EOS. \%d\(\backslash\)n"{}, matEOS[matId]);}
\DoxyCodeLine{00372         \}}
\DoxyCodeLine{00373 \#if PALPHA\_POROSITY}
\DoxyCodeLine{00374         if (matEOS[matId] == EOS\_TYPE\_JUTZI || matEOS[matId] == EOS\_TYPE\_JUTZI\_MURNAGHAN) \{}
\DoxyCodeLine{00375             p.p[i] = pressure;}
\DoxyCodeLine{00376         \} else \{}
\DoxyCodeLine{00377             p.alpha\_jutzi\_old[i] = p.alpha\_jutzi[i];}
\DoxyCodeLine{00378         \}}
\DoxyCodeLine{00379 \#endif}
\DoxyCodeLine{00380 \#if REAL\_HYDRO}
\DoxyCodeLine{00381         if (p.p[i] < 0.0)}
\DoxyCodeLine{00382             p.p[i] = 0.0;}
\DoxyCodeLine{00383 \#endif}
\DoxyCodeLine{00384     \}}
\DoxyCodeLine{00385 \}}

\end{DoxyCode}
