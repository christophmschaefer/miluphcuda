\hypertarget{io_8cu_source}{}\doxysection{io.\+cu}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001 /**}
\DoxyCodeLine{00002  * @author      Christoph Schaefer cm.schaefer@gmail.com and Thomas I. Maindl}
\DoxyCodeLine{00003  *}
\DoxyCodeLine{00004  * @section     LICENSE}
\DoxyCodeLine{00005  * Copyright (c) 2019 Christoph Schaefer}
\DoxyCodeLine{00006  *}
\DoxyCodeLine{00007  * This file is part of miluphcuda.}
\DoxyCodeLine{00008  *}
\DoxyCodeLine{00009  * miluphcuda is free software: you can redistribute it and/or modify}
\DoxyCodeLine{00010  * it under the terms of the GNU General Public License as published by}
\DoxyCodeLine{00011  * the Free Software Foundation, either version 3 of the License, or}
\DoxyCodeLine{00012  * (at your option) any later version.}
\DoxyCodeLine{00013  *}
\DoxyCodeLine{00014  * miluphcuda is distributed in the hope that it will be useful,}
\DoxyCodeLine{00015  * but WITHOUT ANY WARRANTY; without even the implied warranty of}
\DoxyCodeLine{00016  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
\DoxyCodeLine{00017  * GNU General Public License for more details.}
\DoxyCodeLine{00018  *}
\DoxyCodeLine{00019  * You should have received a copy of the GNU General Public License}
\DoxyCodeLine{00020  * along with miluphcuda.  If not, see <http://www.gnu.org/licenses/>.}
\DoxyCodeLine{00021  *}
\DoxyCodeLine{00022  */}
\DoxyCodeLine{00023 }
\DoxyCodeLine{00024 }
\DoxyCodeLine{00025 \#include "{}io.h"{}}
\DoxyCodeLine{00026 \#include "{}timeintegration.h"{}}
\DoxyCodeLine{00027 \#include "{}pressure.h"{}}
\DoxyCodeLine{00028 \#include <libconfig.h>}
\DoxyCodeLine{00029 \#include "{}aneos.h"{}}
\DoxyCodeLine{00030 }
\DoxyCodeLine{00031 }
\DoxyCodeLine{00032 \#if HDF5IO}
\DoxyCodeLine{00033 \#include <hdf5.h>}
\DoxyCodeLine{00034 \#endif}
\DoxyCodeLine{00035 }
\DoxyCodeLine{00036 }
\DoxyCodeLine{00037 int currentDiskIO = FALSE;}
\DoxyCodeLine{00038 }
\DoxyCodeLine{00039 extern pthread\_t fileIOthread;}
\DoxyCodeLine{00040 }
\DoxyCodeLine{00041 extern double startTime;}
\DoxyCodeLine{00042 }
\DoxyCodeLine{00043 extern double Smin;}
\DoxyCodeLine{00044 extern double alphamin;}
\DoxyCodeLine{00045 extern double emin;}
\DoxyCodeLine{00046 extern double rhomin;}
\DoxyCodeLine{00047 extern double damagemin;}
\DoxyCodeLine{00048 extern double betamin;}
\DoxyCodeLine{00049 extern double alpha\_epspormin;}
\DoxyCodeLine{00050 extern double epsilon\_vmin;}
\DoxyCodeLine{00051 }
\DoxyCodeLine{00052 File inputFile;}
\DoxyCodeLine{00053 }
\DoxyCodeLine{00054 /*! \(\backslash\)brief}
\DoxyCodeLine{00055   Reading the material properties using libconfig.}
\DoxyCodeLine{00056   \(\backslash\)param pointer to config file}
\DoxyCodeLine{00057   \(\backslash\)return nothing}
\DoxyCodeLine{00058 */}
\DoxyCodeLine{00059 void loadConfigFromFile(char *configFile)}
\DoxyCodeLine{00060 \{}
\DoxyCodeLine{00061     config\_init(\&param.config);}
\DoxyCodeLine{00062 }
\DoxyCodeLine{00063 }
\DoxyCodeLine{00064     if (!config\_read\_file(\&param.config, configFile)) \{}
\DoxyCodeLine{00065         fprintf(stderr, "{}Error reading config file \%s.\(\backslash\)n"{}, configFile);}
\DoxyCodeLine{00066         config\_destroy(\&param.config);}
\DoxyCodeLine{00067         exit(1);}
\DoxyCodeLine{00068     \}}
\DoxyCodeLine{00069 \}}
\DoxyCodeLine{00070 }
\DoxyCodeLine{00071 }
\DoxyCodeLine{00072 void set\_integration\_parameters()}
\DoxyCodeLine{00073 \{}
\DoxyCodeLine{00074     FILE *f;}
\DoxyCodeLine{00075     char line[1024];}
\DoxyCodeLine{00076     char *name;}
\DoxyCodeLine{00077     char *value;}
\DoxyCodeLine{00078     char *fn = "{}pc\_values.dat"{};}
\DoxyCodeLine{00079     const char s[] = "{} = "{};}
\DoxyCodeLine{00080     int found = FALSE;}
\DoxyCodeLine{00081 }
\DoxyCodeLine{00082     f = fopen(fn,"{}r"{});}
\DoxyCodeLine{00083 }
\DoxyCodeLine{00084 }
\DoxyCodeLine{00085     if (f == NULL)\{}
\DoxyCodeLine{00086         if (param.integrator\_type == MONAGHAN\_PC || param.integrator\_type == EULER\_PC) \{}
\DoxyCodeLine{00087             fprintf(stderr, "{}Can't open file \%s!\(\backslash\)n"{}, fn);}
\DoxyCodeLine{00088             exit(1);}
\DoxyCodeLine{00089         \}}
\DoxyCodeLine{00090     \} else \{}
\DoxyCodeLine{00091         found = TRUE;}
\DoxyCodeLine{00092     \}}
\DoxyCodeLine{00093 }
\DoxyCodeLine{00094     Smin = rhomin = emin = alphamin = betamin = damagemin = alpha\_epspormin = epsilon\_vmin = 1e99;}
\DoxyCodeLine{00095 }
\DoxyCodeLine{00096     if (found) \{}
\DoxyCodeLine{00097         while (fgets(line, sizeof(line), f)) \{}
\DoxyCodeLine{00098             /* comments start with \# */}
\DoxyCodeLine{00099             if (line[0] == '\#') continue;}
\DoxyCodeLine{00100             name = strtok(line, s);}
\DoxyCodeLine{00101             value = strtok(NULL, s);}
\DoxyCodeLine{00102             if (!strcmp(name, "{}Smin"{})) \{}
\DoxyCodeLine{00103                 Smin = atof(value);}
\DoxyCodeLine{00104             \}}
\DoxyCodeLine{00105             else if (!strcmp(name, "{}rhomin"{})) \{}
\DoxyCodeLine{00106                 rhomin = atof(value);}
\DoxyCodeLine{00107             \}}
\DoxyCodeLine{00108             else if (!strcmp(name, "{}emin"{})) \{}
\DoxyCodeLine{00109                 emin = atof(value);}
\DoxyCodeLine{00110             \}}
\DoxyCodeLine{00111             else if (!strcmp(name, "{}alphamin"{})) \{}
\DoxyCodeLine{00112                 alphamin = atof(value);}
\DoxyCodeLine{00113             \}}
\DoxyCodeLine{00114             else if (!strcmp(name, "{}betamin"{})) \{}
\DoxyCodeLine{00115                 betamin = atof(value);}
\DoxyCodeLine{00116             \}}
\DoxyCodeLine{00117             else if (!strcmp(name, "{}damagemin"{})) \{}
\DoxyCodeLine{00118                 damagemin = atof(value);}
\DoxyCodeLine{00119             \}}
\DoxyCodeLine{00120             else if (!strcmp(name, "{}alpha\_epspormin"{})) \{}
\DoxyCodeLine{00121                 alpha\_epspormin = atof(value);}
\DoxyCodeLine{00122             \}}
\DoxyCodeLine{00123             else if (!strcmp(name, "{}epsilon\_vmin"{})) \{}
\DoxyCodeLine{00124                 epsilon\_vmin = atof(value);}
\DoxyCodeLine{00125             \}}
\DoxyCodeLine{00126         \}}
\DoxyCodeLine{00127         fclose (f);}
\DoxyCodeLine{00128     \}}
\DoxyCodeLine{00129     if (param.verbose \&\& (param.integrator\_type == MONAGHAN\_PC || param.integrator\_type == EULER\_PC)) \{}
\DoxyCodeLine{00130         fprintf(stdout, "{}Using following values for the predictor corrector integrator:\(\backslash\)n"{});}
\DoxyCodeLine{00131 \#if SOLID}
\DoxyCodeLine{00132         fprintf(stdout, "{}Smin:\(\backslash\)t\(\backslash\)t\(\backslash\)t \%e\(\backslash\)n"{}, Smin);}
\DoxyCodeLine{00133 \#endif}
\DoxyCodeLine{00134 \#if INTEGRATE\_ENERGY}
\DoxyCodeLine{00135         fprintf(stdout, "{}emin:\(\backslash\)t\(\backslash\)t\(\backslash\)t \%e\(\backslash\)n"{}, emin);}
\DoxyCodeLine{00136 \#endif}
\DoxyCodeLine{00137 \#if INTEGRATE\_DENSITY}
\DoxyCodeLine{00138         fprintf(stdout, "{}rhomin:\(\backslash\)t\(\backslash\)t\(\backslash\)t \%e\(\backslash\)n"{}, rhomin);}
\DoxyCodeLine{00139 \#endif}
\DoxyCodeLine{00140 \#if FRAGMENTATION}
\DoxyCodeLine{00141         fprintf(stdout, "{}damagemin:\(\backslash\)t\(\backslash\)t \%e\(\backslash\)n"{}, damagemin);}
\DoxyCodeLine{00142 \#endif}
\DoxyCodeLine{00143 \#if PALPHA\_POROSITY}
\DoxyCodeLine{00144         fprintf(stdout, "{}alphamin:\(\backslash\)t\(\backslash\)t \%e\(\backslash\)n"{}, alphamin);}
\DoxyCodeLine{00145 \#endif}
\DoxyCodeLine{00146 \#if INVISCID\_SPH}
\DoxyCodeLine{00147         fprintf(stdout, "{}betamin:\(\backslash\)t\(\backslash\)t \%e\(\backslash\)n"{}, betamin);}
\DoxyCodeLine{00148 \#endif}
\DoxyCodeLine{00149 \#if EPSALPHA\_POROSITY}
\DoxyCodeLine{00150         fprintf(stdout, "{}alpha\_epspormin:\(\backslash\)t\(\backslash\)t \%e\(\backslash\)n"{}, alpha\_epspormin);}
\DoxyCodeLine{00151         fprintf(stdout, "{}epsilon\_vmin:\(\backslash\)t\(\backslash\)t \%e\(\backslash\)n"{}, epsilon\_vmin);}
\DoxyCodeLine{00152 \#endif}
\DoxyCodeLine{00153         fprintf(stdout, "{}These values (if not 1e99) are taken from file <pc\_values.dat>.\(\backslash\)n"{});}
\DoxyCodeLine{00154     \}}
\DoxyCodeLine{00155 \}}
\DoxyCodeLine{00156 }
\DoxyCodeLine{00157 }
\DoxyCodeLine{00158 }
\DoxyCodeLine{00159 }
\DoxyCodeLine{00160 }
\DoxyCodeLine{00161 }
\DoxyCodeLine{00162 }
\DoxyCodeLine{00163 /* set some initial values */}
\DoxyCodeLine{00164 void init\_values(void)}
\DoxyCodeLine{00165 \{}
\DoxyCodeLine{00166 }
\DoxyCodeLine{00167     int i;}
\DoxyCodeLine{00168     int matId;}
\DoxyCodeLine{00169 }
\DoxyCodeLine{00170 }
\DoxyCodeLine{00171     if (param.verbose) \{}
\DoxyCodeLine{00172         printf("{}initialising material constants and copying them to the gpu\(\backslash\)n"{});}
\DoxyCodeLine{00173     \}}
\DoxyCodeLine{00174     transferMaterialsToGPU();}
\DoxyCodeLine{00175 }
\DoxyCodeLine{00176     for (i = 0; i < numberOfParticles; i++) \{}
\DoxyCodeLine{00177         matId = p\_host.materialId[i];}
\DoxyCodeLine{00178 \#if PALPHA\_POROSITY}
\DoxyCodeLine{00179         p\_host.cs[i] = cs\_porous[matId];}
\DoxyCodeLine{00180 \#else}
\DoxyCodeLine{00181         p\_host.cs[i] = sqrt(bulk\_modulus[matId]/till\_rho\_0[matId]);}
\DoxyCodeLine{00182 \#endif}
\DoxyCodeLine{00183 \#if !READ\_INITIAL\_SML\_FROM\_PARTICLE\_FILE}
\DoxyCodeLine{00184         if (!(p\_host.h[i] > 0)) \{}
\DoxyCodeLine{00185             p\_host.h[i] = sml[matId];}
\DoxyCodeLine{00186         \}}
\DoxyCodeLine{00187 \#endif}
\DoxyCodeLine{00188     \}}
\DoxyCodeLine{00189 }
\DoxyCodeLine{00190 }
\DoxyCodeLine{00191 }
\DoxyCodeLine{00192 }
\DoxyCodeLine{00193 \}}
\DoxyCodeLine{00194 }
\DoxyCodeLine{00195 // read in particle from start file}
\DoxyCodeLine{00196 void read\_particles\_from\_file(File inputFile) \{}
\DoxyCodeLine{00197 }
\DoxyCodeLine{00198     int my\_anop;}
\DoxyCodeLine{00199     int i;}
\DoxyCodeLine{00200     int d;}
\DoxyCodeLine{00201     int c;}
\DoxyCodeLine{00202 \#if SOLID || NAVIER\_STOKES}
\DoxyCodeLine{00203     int e;}
\DoxyCodeLine{00204 \#endif}
\DoxyCodeLine{00205     /*int rc = 1;*/}
\DoxyCodeLine{00206     char h5filename[256];}
\DoxyCodeLine{00207     char h5massfilename[256];}
\DoxyCodeLine{00208     char massfilename[256];}
\DoxyCodeLine{00209     FILE *massfile;}
\DoxyCodeLine{00210     double h5time;}
\DoxyCodeLine{00211     double *x;}
\DoxyCodeLine{00212     int *ix;}
\DoxyCodeLine{00213 }
\DoxyCodeLine{00214 }
\DoxyCodeLine{00215 \#if HDF5IO}
\DoxyCodeLine{00216     /* hdf5 related stuff */}
\DoxyCodeLine{00217     hid\_t file\_id;}
\DoxyCodeLine{00218     hid\_t x\_id, v\_id, m\_id, mtype\_id;}
\DoxyCodeLine{00219 \#if INTEGRATE\_DENSITY}
\DoxyCodeLine{00220     hid\_t rho\_id;}
\DoxyCodeLine{00221 \#endif}
\DoxyCodeLine{00222 \#if INTEGRATE\_ENERGY}
\DoxyCodeLine{00223     hid\_t e\_id;}
\DoxyCodeLine{00224 \#endif}
\DoxyCodeLine{00225     hid\_t time\_id;}
\DoxyCodeLine{00226 \#if VARIABLE\_SML || READ\_INITIAL\_SML\_FROM\_PARTICLE\_FILE}
\DoxyCodeLine{00227     hid\_t sml\_id;}
\DoxyCodeLine{00228 \#endif}
\DoxyCodeLine{00229     hid\_t dspace;}
\DoxyCodeLine{00230 }
\DoxyCodeLine{00231 \#if FRAGMENTATION}
\DoxyCodeLine{00232     hid\_t noaf\_id, damage\_id;}
\DoxyCodeLine{00233     hid\_t activation\_thresholds\_id;}
\DoxyCodeLine{00234     hid\_t maxnof\_id;}
\DoxyCodeLine{00235     int nofi;}
\DoxyCodeLine{00236     int maxnof;}
\DoxyCodeLine{00237     double *ax;}
\DoxyCodeLine{00238 \#endif}
\DoxyCodeLine{00239 \#if GRAVITATING\_POINT\_MASSES}
\DoxyCodeLine{00240     hid\_t rmin\_id;}
\DoxyCodeLine{00241     hid\_t rmax\_id;}
\DoxyCodeLine{00242 \#endif}
\DoxyCodeLine{00243 \#if JC\_PLASTICITY}
\DoxyCodeLine{00244     hid\_t ep\_id, T\_id;}
\DoxyCodeLine{00245 \#endif}
\DoxyCodeLine{00246 \#if SOLID}
\DoxyCodeLine{00247     hid\_t S\_id;}
\DoxyCodeLine{00248 \#endif}
\DoxyCodeLine{00249 \#if NAVIER\_STOKES}
\DoxyCodeLine{00250     hid\_t Tshear\_id;}
\DoxyCodeLine{00251 \#endif}
\DoxyCodeLine{00252 }
\DoxyCodeLine{00253 \#if PALPHA\_POROSITY}
\DoxyCodeLine{00254     hid\_t p\_id;}
\DoxyCodeLine{00255     hid\_t alpha\_id;}
\DoxyCodeLine{00256 \#if SOLID}
\DoxyCodeLine{00257 \#if FRAGMENTATION}
\DoxyCodeLine{00258     hid\_t damage\_porjutzi\_id;}
\DoxyCodeLine{00259 \#endif}
\DoxyCodeLine{00260 \#endif}
\DoxyCodeLine{00261 \#endif}
\DoxyCodeLine{00262 }
\DoxyCodeLine{00263 \#if SIRONO\_POROSITY}
\DoxyCodeLine{00264     hid\_t K\_id;}
\DoxyCodeLine{00265     hid\_t rho\_0prime\_id;}
\DoxyCodeLine{00266     hid\_t rho\_c\_plus\_id;}
\DoxyCodeLine{00267     hid\_t rho\_c\_minus\_id;}
\DoxyCodeLine{00268     hid\_t compressive\_strength\_id;}
\DoxyCodeLine{00269     hid\_t tensile\_strength\_id;}
\DoxyCodeLine{00270     hid\_t flag\_rho\_0prime\_id;}
\DoxyCodeLine{00271     hid\_t flag\_plastic\_id;}
\DoxyCodeLine{00272     hid\_t shear\_strength\_id;}
\DoxyCodeLine{00273 \#endif}
\DoxyCodeLine{00274 }
\DoxyCodeLine{00275 \#if EPSALPHA\_POROSITY}
\DoxyCodeLine{00276     hid\_t alpha\_epspor\_id;}
\DoxyCodeLine{00277     hid\_t epsilon\_v\_id;}
\DoxyCodeLine{00278 \#endif}
\DoxyCodeLine{00279 }
\DoxyCodeLine{00280     herr\_t status;}
\DoxyCodeLine{00281 }
\DoxyCodeLine{00282     /* filename extension is .h5 */}
\DoxyCodeLine{00283     strcpy(massfilename, inputFile.name);}
\DoxyCodeLine{00284     strcat(massfilename, "{}.mass"{});}
\DoxyCodeLine{00285     strcpy(h5filename, inputFile.name);}
\DoxyCodeLine{00286     strcpy(h5massfilename, inputFile.name);}
\DoxyCodeLine{00287     strcat(h5filename, "{}.h5"{});}
\DoxyCodeLine{00288     strcat(h5massfilename, "{}.mass.h5"{});}
\DoxyCodeLine{00289 \#endif}
\DoxyCodeLine{00290 }
\DoxyCodeLine{00291     // set start timestep from input filename}
\DoxyCodeLine{00292     const char* ext;}
\DoxyCodeLine{00293     ext = strrchr(inputFile.name, '.');}
\DoxyCodeLine{00294     if (!ext) \{}
\DoxyCodeLine{00295         printf("{}could not get start timestep from filename. make sure to name the file *.1234 or something like this"{});}
\DoxyCodeLine{00296         exit(1);}
\DoxyCodeLine{00297     \} else \{}
\DoxyCodeLine{00298         sscanf(ext+1, "{}\%04d"{}, \&startTimestep);}
\DoxyCodeLine{00299         printf("{}set start timestep to \%d\(\backslash\)n"{}, startTimestep);}
\DoxyCodeLine{00300     \}}
\DoxyCodeLine{00301 }
\DoxyCodeLine{00302 }
\DoxyCodeLine{00303 }
\DoxyCodeLine{00304 \#if HDF5IO}
\DoxyCodeLine{00305     if (param.hdf5input) \{}
\DoxyCodeLine{00306         printf("{}reading particle data from hdf5 file: \%s.h5\(\backslash\)n"{}, inputFile.name);}
\DoxyCodeLine{00307 \#if GRAVITATING\_POINT\_MASSES}
\DoxyCodeLine{00308         printf("{}reading pointmass data from hdf5 file: \%s.mass.h5\(\backslash\)n"{}, inputFile.name);}
\DoxyCodeLine{00309 \#endif}
\DoxyCodeLine{00310 }
\DoxyCodeLine{00311         file\_id = H5Fopen (h5filename, H5F\_ACC\_RDONLY, H5P\_DEFAULT);}
\DoxyCodeLine{00312         if (file\_id < 0) \{}
\DoxyCodeLine{00313             fprintf(stderr, "{}********************** Error opening file \%s\(\backslash\)n"{}, h5filename);}
\DoxyCodeLine{00314             exit(1);}
\DoxyCodeLine{00315         \} else \{}
\DoxyCodeLine{00316             fprintf(stdout, "{}Using hdf5 input file \%s\(\backslash\)n"{}, h5filename);}
\DoxyCodeLine{00317         \}}
\DoxyCodeLine{00318 }
\DoxyCodeLine{00319         /* open the dataset for the positions */}
\DoxyCodeLine{00320         x\_id = H5Dopen(file\_id, "{}/x"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00321         if (x\_id < 0) \{}
\DoxyCodeLine{00322             fprintf(stderr, "{}Could not find locations in hdf5 file.  Exiting.\(\backslash\)n"{});}
\DoxyCodeLine{00323         \}}
\DoxyCodeLine{00324 }
\DoxyCodeLine{00325         /* determine number of particles stored in hdf5 file */}
\DoxyCodeLine{00326         dspace = H5Dget\_space(x\_id);}
\DoxyCodeLine{00327         const int ndims = H5Sget\_simple\_extent\_ndims(dspace);}
\DoxyCodeLine{00328         hsize\_t dims[ndims];}
\DoxyCodeLine{00329         H5Sget\_simple\_extent\_dims(dspace, dims, NULL);}
\DoxyCodeLine{00330         my\_anop = dims[0];}
\DoxyCodeLine{00331 }
\DoxyCodeLine{00332         fprintf(stdout, "{}Reading data for \%d particles.\(\backslash\)n"{}, my\_anop);}
\DoxyCodeLine{00333 }
\DoxyCodeLine{00334         /* allocate space for my\_anop particles */}
\DoxyCodeLine{00335 }
\DoxyCodeLine{00336         /* read positions */}
\DoxyCodeLine{00337         x = (double *) malloc(sizeof(double) * my\_anop * DIM);}
\DoxyCodeLine{00338 }
\DoxyCodeLine{00339         status = H5Dread(x\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00340         status = H5Dclose(x\_id);}
\DoxyCodeLine{00341         for (i = 0, d = 0; i < my\_anop; i++, d += DIM) \{}
\DoxyCodeLine{00342             p\_host.x[i] = x[d];}
\DoxyCodeLine{00343 \#if DIM > 1}
\DoxyCodeLine{00344             p\_host.y[i] = x[d+1];}
\DoxyCodeLine{00345 \#if DIM == 3}
\DoxyCodeLine{00346             p\_host.z[i] = x[d+2];}
\DoxyCodeLine{00347 \#endif}
\DoxyCodeLine{00348 \#endif}
\DoxyCodeLine{00349         \}}
\DoxyCodeLine{00350 }
\DoxyCodeLine{00351         /* read velocities */}
\DoxyCodeLine{00352         v\_id = H5Dopen(file\_id, "{}/v"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00353         if (v\_id < 0) \{}
\DoxyCodeLine{00354             fprintf(stderr, "{}Could not find velocities in hdf5 file.  Exiting.\(\backslash\)n"{});}
\DoxyCodeLine{00355             exit(1);}
\DoxyCodeLine{00356         \}}
\DoxyCodeLine{00357         status = H5Dread(v\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00358         status = H5Dclose(v\_id);}
\DoxyCodeLine{00359         for (i = 0, d = 0; i < my\_anop; i++, d += DIM) \{}
\DoxyCodeLine{00360             p\_host.vx[i] = x[d];}
\DoxyCodeLine{00361 \#if DIM > 1}
\DoxyCodeLine{00362             p\_host.vy[i] = x[d+1];}
\DoxyCodeLine{00363 \#if DIM == 3}
\DoxyCodeLine{00364             p\_host.vz[i] = x[d+2];}
\DoxyCodeLine{00365 \#endif}
\DoxyCodeLine{00366 \#endif}
\DoxyCodeLine{00367         \}}
\DoxyCodeLine{00368         free(x);}
\DoxyCodeLine{00369 }
\DoxyCodeLine{00370         /* read simulation time */}
\DoxyCodeLine{00371         time\_id = H5Dopen(file\_id, "{}/time"{},  H5P\_DEFAULT);}
\DoxyCodeLine{00372         if (time\_id < 0) \{}
\DoxyCodeLine{00373             fprintf(stderr, "{}Could not find time in hdf5 file.  Exiting.\(\backslash\)n"{});}
\DoxyCodeLine{00374             exit(1);}
\DoxyCodeLine{00375         \}}
\DoxyCodeLine{00376         status = H5Dread(time\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, \&h5time);}
\DoxyCodeLine{00377         status = H5Dclose(time\_id);}
\DoxyCodeLine{00378 }
\DoxyCodeLine{00379         fprintf(stdout, "{}Current time: \%g\(\backslash\)n"{}, h5time);}
\DoxyCodeLine{00380         startTime = h5time;}
\DoxyCodeLine{00381 }
\DoxyCodeLine{00382         /* read mass */}
\DoxyCodeLine{00383         /* mass */}
\DoxyCodeLine{00384         dims[0] = my\_anop;}
\DoxyCodeLine{00385         dims[1] = 1;}
\DoxyCodeLine{00386         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00387         m\_id = H5Dopen(file\_id, "{}/m"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00388         if (m\_id < 0) \{}
\DoxyCodeLine{00389             fprintf(stderr, "{}Could not find mass information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00390             exit(1);}
\DoxyCodeLine{00391         \}}
\DoxyCodeLine{00392         status = H5Dread(m\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00393         status = H5Dclose(m\_id);}
\DoxyCodeLine{00394 }
\DoxyCodeLine{00395         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00396             p\_host.m[i] = x[i];}
\DoxyCodeLine{00397         \}}
\DoxyCodeLine{00398         free(x);}
\DoxyCodeLine{00399 }
\DoxyCodeLine{00400 }
\DoxyCodeLine{00401 \#if PALPHA\_POROSITY}
\DoxyCodeLine{00402         /* read alpha\_jutzi */}
\DoxyCodeLine{00403         dims[0] = my\_anop;}
\DoxyCodeLine{00404         dims[1] = 1;}
\DoxyCodeLine{00405         alpha\_id = H5Dopen(file\_id, "{}/alpha\_jutzi"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00406         if (alpha\_id < 0) \{}
\DoxyCodeLine{00407             fprintf(stderr, "{}Could not find alpha\_jutzi information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00408             exit(1);}
\DoxyCodeLine{00409         \}}
\DoxyCodeLine{00410         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00411         status = H5Dread(alpha\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00412         status = H5Dclose(alpha\_id);}
\DoxyCodeLine{00413 }
\DoxyCodeLine{00414         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00415             p\_host.alpha\_jutzi[i] = x[i];}
\DoxyCodeLine{00416         \}}
\DoxyCodeLine{00417         free(x);}
\DoxyCodeLine{00418 }
\DoxyCodeLine{00419         /* read pressure */}
\DoxyCodeLine{00420         p\_id = H5Dopen(file\_id, "{}/p"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00421         if (p\_id < 0) \{}
\DoxyCodeLine{00422             fprintf(stderr, "{}Could not find pressure information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00423             exit(1);}
\DoxyCodeLine{00424         \} else \{}
\DoxyCodeLine{00425             fprintf(stdout, "{}Reading actual pressure data to pressure\_old on the device.\(\backslash\)n"{});}
\DoxyCodeLine{00426         \}}
\DoxyCodeLine{00427         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00428         status = H5Dread(p\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00429         status = H5Dclose(p\_id);}
\DoxyCodeLine{00430 }
\DoxyCodeLine{00431         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00432             p\_host.pold[i] = x[i];}
\DoxyCodeLine{00433         \}}
\DoxyCodeLine{00434         free(x);}
\DoxyCodeLine{00435 }
\DoxyCodeLine{00436 \#if FRAGMENTATION}
\DoxyCodeLine{00437         /* damage\_porjutzi */}
\DoxyCodeLine{00438         damage\_porjutzi\_id = H5Dopen(file\_id, "{}/DIM\_root\_of\_damage\_porjutzi"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00439         if (damage\_porjutzi\_id < 0) \{}
\DoxyCodeLine{00440             fprintf(stderr, "{}Could not find damage\_porjutzi information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00441             exit(1);}
\DoxyCodeLine{00442         \}}
\DoxyCodeLine{00443         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00444         status = H5Dread(damage\_porjutzi\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00445         status = H5Dclose(damage\_porjutzi\_id);}
\DoxyCodeLine{00446 }
\DoxyCodeLine{00447         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00448             p\_host.damage\_porjutzi[i] = x[i];}
\DoxyCodeLine{00449         \}}
\DoxyCodeLine{00450         free(x);}
\DoxyCodeLine{00451 \#endif}
\DoxyCodeLine{00452 \#endif}
\DoxyCodeLine{00453 }
\DoxyCodeLine{00454 \#if SIRONO\_POROSITY}
\DoxyCodeLine{00455         /* read rho\_c\_plus */}
\DoxyCodeLine{00456         rho\_c\_plus\_id = H5Dopen(file\_id, "{}/rho\_c\_plus"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00457         if (rho\_c\_plus\_id < 0) \{}
\DoxyCodeLine{00458             fprintf(stderr, "{}Could not find rho\_c\_plus information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00459             exit(1);}
\DoxyCodeLine{00460         \}}
\DoxyCodeLine{00461         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00462         status = H5Dread(rho\_c\_plus\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00463         status = H5Dclose(rho\_c\_plus\_id);}
\DoxyCodeLine{00464         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00465             p\_host.rho\_c\_plus[i] = x[i];}
\DoxyCodeLine{00466         \}}
\DoxyCodeLine{00467         free(x);}
\DoxyCodeLine{00468 }
\DoxyCodeLine{00469 }
\DoxyCodeLine{00470         /* read rho\_c\_minus */}
\DoxyCodeLine{00471         rho\_c\_minus\_id = H5Dopen(file\_id, "{}/rho\_c\_minus"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00472         if (rho\_c\_minus\_id < 0) \{}
\DoxyCodeLine{00473             fprintf(stderr, "{}Could not find rho\_c\_minus information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00474             exit(1);}
\DoxyCodeLine{00475         \}}
\DoxyCodeLine{00476         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00477         status = H5Dread(rho\_c\_minus\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00478         status = H5Dclose(rho\_c\_minus\_id);}
\DoxyCodeLine{00479 }
\DoxyCodeLine{00480         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00481             p\_host.rho\_c\_minus[i] = x[i];}
\DoxyCodeLine{00482         \}}
\DoxyCodeLine{00483         free(x);}
\DoxyCodeLine{00484 }
\DoxyCodeLine{00485 }
\DoxyCodeLine{00486         /* read bulk modulus */}
\DoxyCodeLine{00487         K\_id = H5Dopen(file\_id, "{}/K"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00488         if (K\_id < 0) \{}
\DoxyCodeLine{00489             fprintf(stderr, "{}Could not find bulk modulus information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00490             exit(1);}
\DoxyCodeLine{00491         \}}
\DoxyCodeLine{00492         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00493         status = H5Dread(K\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00494         status = H5Dclose(K\_id);}
\DoxyCodeLine{00495 }
\DoxyCodeLine{00496         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00497             p\_host.K[i] = x[i];}
\DoxyCodeLine{00498         \}}
\DoxyCodeLine{00499         free(x);}
\DoxyCodeLine{00500 }
\DoxyCodeLine{00501         /* read rho\_0prime */}
\DoxyCodeLine{00502         rho\_0prime\_id = H5Dopen(file\_id, "{}/rho\_0prime"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00503         if (rho\_0prime\_id < 0) \{}
\DoxyCodeLine{00504             fprintf(stderr, "{}Could not find rho\_0prime information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00505             exit(1);}
\DoxyCodeLine{00506         \}}
\DoxyCodeLine{00507         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00508         status = H5Dread(rho\_0prime\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00509         status = H5Dclose(rho\_0prime\_id);}
\DoxyCodeLine{00510 }
\DoxyCodeLine{00511         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00512             p\_host.rho\_0prime[i] = x[i];}
\DoxyCodeLine{00513         \}}
\DoxyCodeLine{00514         free(x);}
\DoxyCodeLine{00515 }
\DoxyCodeLine{00516 }
\DoxyCodeLine{00517         /* read compressive\_strength */}
\DoxyCodeLine{00518         compressive\_strength\_id = H5Dopen(file\_id, "{}/compressive\_strength"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00519         if (compressive\_strength\_id < 0) \{}
\DoxyCodeLine{00520             fprintf(stderr, "{}Could not find compressive\_strength information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00521             exit(1);}
\DoxyCodeLine{00522         \}}
\DoxyCodeLine{00523         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00524         status = H5Dread(compressive\_strength\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00525         status = H5Dclose(compressive\_strength\_id);}
\DoxyCodeLine{00526 }
\DoxyCodeLine{00527         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00528             p\_host.compressive\_strength[i] = x[i];}
\DoxyCodeLine{00529         \}}
\DoxyCodeLine{00530         free(x);}
\DoxyCodeLine{00531 }
\DoxyCodeLine{00532 }
\DoxyCodeLine{00533         /* read tensile\_strength */}
\DoxyCodeLine{00534         tensile\_strength\_id = H5Dopen(file\_id, "{}/tensile\_strength"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00535         if (tensile\_strength\_id < 0) \{}
\DoxyCodeLine{00536             fprintf(stderr, "{}Could not find tensile\_strength information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00537             exit(1);}
\DoxyCodeLine{00538         \}}
\DoxyCodeLine{00539         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00540         status = H5Dread(tensile\_strength\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00541         status = H5Dclose(tensile\_strength\_id);}
\DoxyCodeLine{00542 }
\DoxyCodeLine{00543         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00544             p\_host.tensile\_strength[i] = x[i];}
\DoxyCodeLine{00545         \}}
\DoxyCodeLine{00546         free(x);}
\DoxyCodeLine{00547 }
\DoxyCodeLine{00548 }
\DoxyCodeLine{00549         /* read shear\_strength */}
\DoxyCodeLine{00550         shear\_strength\_id = H5Dopen(file\_id, "{}/shear\_strength"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00551         if (shear\_strength\_id < 0) \{}
\DoxyCodeLine{00552             fprintf(stderr, "{}Could not find shear\_strength information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00553             exit(1);}
\DoxyCodeLine{00554         \}}
\DoxyCodeLine{00555         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00556         status = H5Dread(shear\_strength\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00557         status = H5Dclose(shear\_strength\_id);}
\DoxyCodeLine{00558 }
\DoxyCodeLine{00559         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00560             p\_host.shear\_strength[i] = x[i];}
\DoxyCodeLine{00561         \}}
\DoxyCodeLine{00562         free(x);}
\DoxyCodeLine{00563 }
\DoxyCodeLine{00564 }
\DoxyCodeLine{00565         /* read flag\_rho\_0prime */}
\DoxyCodeLine{00566         flag\_rho\_0prime\_id = H5Dopen(file\_id, "{}/flag\_rho\_0prime"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00567         if (flag\_rho\_0prime\_id < 0) \{}
\DoxyCodeLine{00568             fprintf(stderr, "{}Could not flag\_rho\_0prime information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00569             exit(1);}
\DoxyCodeLine{00570         \}}
\DoxyCodeLine{00571 }
\DoxyCodeLine{00572         ix = (int *) malloc(sizeof(int) * my\_anop);}
\DoxyCodeLine{00573         if (!(ix)) \{}
\DoxyCodeLine{00574             fprintf(stderr, "{}Cannot allocate enough memory.\(\backslash\)n"{});}
\DoxyCodeLine{00575             exit(1);}
\DoxyCodeLine{00576         \}}
\DoxyCodeLine{00577 }
\DoxyCodeLine{00578         status = H5Dread(flag\_rho\_0prime\_id, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, ix);}
\DoxyCodeLine{00579         status = H5Dclose(flag\_rho\_0prime\_id);}
\DoxyCodeLine{00580 }
\DoxyCodeLine{00581         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00582             p\_host.flag\_rho\_0prime[i] = ix[i];}
\DoxyCodeLine{00583         \}}
\DoxyCodeLine{00584         free(ix);}
\DoxyCodeLine{00585 }
\DoxyCodeLine{00586 }
\DoxyCodeLine{00587         /* read flag\_plastic */}
\DoxyCodeLine{00588         flag\_plastic\_id = H5Dopen(file\_id, "{}/flag\_plastic"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00589         if (flag\_plastic\_id < 0) \{}
\DoxyCodeLine{00590             fprintf(stderr, "{}Could not flag\_plastic information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00591             exit(1);}
\DoxyCodeLine{00592         \}}
\DoxyCodeLine{00593 }
\DoxyCodeLine{00594         ix = (int *) malloc(sizeof(int) * my\_anop);}
\DoxyCodeLine{00595         status = H5Dread(flag\_plastic\_id, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, ix);}
\DoxyCodeLine{00596         status = H5Dclose(flag\_plastic\_id);}
\DoxyCodeLine{00597 }
\DoxyCodeLine{00598         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00599             p\_host.flag\_plastic[i] = ix[i];}
\DoxyCodeLine{00600         \}}
\DoxyCodeLine{00601         free(ix);}
\DoxyCodeLine{00602 \#endif}
\DoxyCodeLine{00603 }
\DoxyCodeLine{00604 \#if EPSALPHA\_POROSITY}
\DoxyCodeLine{00605         /* read alpha\_epspor */}
\DoxyCodeLine{00606         alpha\_epspor\_id = H5Dopen(file\_id, "{}/alpha\_epspor"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00607         if (alpha\_epspor\_id < 0) \{}
\DoxyCodeLine{00608             fprintf(stderr, "{}Could not find alpha\_epspor information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00609             exit(1);}
\DoxyCodeLine{00610         \}}
\DoxyCodeLine{00611         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00612         status = H5Dread(alpha\_epspor\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00613         status = H5Dclose(alpha\_epspor\_id);}
\DoxyCodeLine{00614 }
\DoxyCodeLine{00615         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00616             p\_host.alpha\_epspor[i] = x[i];}
\DoxyCodeLine{00617         \}}
\DoxyCodeLine{00618         free(x);}
\DoxyCodeLine{00619         /* read epsilon\_v */}
\DoxyCodeLine{00620         epsilon\_v\_id = H5Dopen(file\_id, "{}/epsilon\_v"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00621         if (epsilon\_v\_id < 0) \{}
\DoxyCodeLine{00622             fprintf(stderr, "{}Could not find epsilon\_v information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00623             exit(1);}
\DoxyCodeLine{00624         \}}
\DoxyCodeLine{00625         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00626         status = H5Dread(epsilon\_v\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00627         status = H5Dclose(epsilon\_v\_id);}
\DoxyCodeLine{00628 }
\DoxyCodeLine{00629         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00630             p\_host.epsilon\_v[i] = x[i];}
\DoxyCodeLine{00631         \}}
\DoxyCodeLine{00632         free(x);}
\DoxyCodeLine{00633 }
\DoxyCodeLine{00634 \#endif}
\DoxyCodeLine{00635 }
\DoxyCodeLine{00636 \#if VARIABLE\_SML || READ\_INITIAL\_SML\_FROM\_PARTICLE\_FILE}
\DoxyCodeLine{00637         /* read sml */}
\DoxyCodeLine{00638         sml\_id =  H5Dopen(file\_id, "{}/sml"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00639         if (sml\_id < 0) \{}
\DoxyCodeLine{00640             fprintf(stderr, "{}Could not find smoothing length information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00641             exit(1);}
\DoxyCodeLine{00642         \}}
\DoxyCodeLine{00643         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00644         status = H5Dread(sml\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00645         status = H5Dclose(sml\_id);}
\DoxyCodeLine{00646 }
\DoxyCodeLine{00647         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00648             p\_host.h[i] = x[i];}
\DoxyCodeLine{00649         \}}
\DoxyCodeLine{00650         free(x);}
\DoxyCodeLine{00651 \#endif}
\DoxyCodeLine{00652 }
\DoxyCodeLine{00653 }
\DoxyCodeLine{00654 \#if INTEGRATE\_DENSITY}
\DoxyCodeLine{00655         /* density */}
\DoxyCodeLine{00656         rho\_id = H5Dopen(file\_id, "{}/rho"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00657         if (rho\_id < 0) \{}
\DoxyCodeLine{00658             fprintf(stderr, "{}Could not find density information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00659             exit(1);}
\DoxyCodeLine{00660         \}}
\DoxyCodeLine{00661         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00662         status = H5Dread(rho\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00663         status = H5Dclose(rho\_id);}
\DoxyCodeLine{00664 }
\DoxyCodeLine{00665         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00666             p\_host.rho[i] = x[i];}
\DoxyCodeLine{00667         \}}
\DoxyCodeLine{00668         free(x);}
\DoxyCodeLine{00669 \#endif}
\DoxyCodeLine{00670 }
\DoxyCodeLine{00671 \#if INTEGRATE\_ENERGY}
\DoxyCodeLine{00672         /* internal energy */}
\DoxyCodeLine{00673         e\_id = H5Dopen(file\_id, "{}/e"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00674         if (e\_id < 0) \{}
\DoxyCodeLine{00675             fprintf(stderr, "{}Could not find energy information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00676             exit(1);}
\DoxyCodeLine{00677         \}}
\DoxyCodeLine{00678         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00679         status = H5Dread(e\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00680         status = H5Dclose(e\_id);}
\DoxyCodeLine{00681 }
\DoxyCodeLine{00682         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00683             p\_host.e[i] = x[i];}
\DoxyCodeLine{00684         \}}
\DoxyCodeLine{00685         free(x);}
\DoxyCodeLine{00686 \#endif}
\DoxyCodeLine{00687 }
\DoxyCodeLine{00688 }
\DoxyCodeLine{00689         /* material types */}
\DoxyCodeLine{00690         mtype\_id = H5Dopen(file\_id, "{}/material\_type"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00691         if (mtype\_id < 0) \{}
\DoxyCodeLine{00692             fprintf(stderr, "{}Could not material type information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00693             exit(1);}
\DoxyCodeLine{00694         \}}
\DoxyCodeLine{00695         ix = (int *) malloc(sizeof(int) * my\_anop);}
\DoxyCodeLine{00696         if (!(ix)) \{}
\DoxyCodeLine{00697             fprintf(stderr, "{}Cannot allocate enough memory.\(\backslash\)n"{});}
\DoxyCodeLine{00698             exit(1);}
\DoxyCodeLine{00699         \}}
\DoxyCodeLine{00700         status = H5Dread(mtype\_id, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, ix);}
\DoxyCodeLine{00701         status = H5Dclose(mtype\_id);}
\DoxyCodeLine{00702 }
\DoxyCodeLine{00703         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00704             p\_host.materialId[i] = ix[i];}
\DoxyCodeLine{00705         \}}
\DoxyCodeLine{00706         free(ix);}
\DoxyCodeLine{00707 }
\DoxyCodeLine{00708 \#if JC\_PLASTICITY}
\DoxyCodeLine{00709         /* plastic strain */}
\DoxyCodeLine{00710         ep\_id = H5Dopen(file\_id, "{}/ep"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00711         if (ep\_id < 0) \{}
\DoxyCodeLine{00712             fprintf(stderr, "{}Could not find plastic strain information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00713             exit(1);}
\DoxyCodeLine{00714         \}}
\DoxyCodeLine{00715         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00716         status = H5Dread(ep\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00717         status = H5Dclose(ep\_id);}
\DoxyCodeLine{00718 }
\DoxyCodeLine{00719         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00720             p\_host.ep[i] = x[i];}
\DoxyCodeLine{00721         \}}
\DoxyCodeLine{00722         free(x);}
\DoxyCodeLine{00723 }
\DoxyCodeLine{00724         /* temperature */}
\DoxyCodeLine{00725         T\_id = H5Dopen(file\_id, "{}/T"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00726         if (T\_id < 0) \{}
\DoxyCodeLine{00727             fprintf(stderr, "{}Could not find temperature information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00728             exit(1);}
\DoxyCodeLine{00729         \}}
\DoxyCodeLine{00730         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00731         status = H5Dread(T\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00732         status = H5Dclose(T\_id);}
\DoxyCodeLine{00733 }
\DoxyCodeLine{00734         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00735             p\_host.T[i] = x[i];}
\DoxyCodeLine{00736         \}}
\DoxyCodeLine{00737         free(x);}
\DoxyCodeLine{00738 \#endif}
\DoxyCodeLine{00739 }
\DoxyCodeLine{00740 }
\DoxyCodeLine{00741 \#if FRAGMENTATION}
\DoxyCodeLine{00742         /* number of activated flaws */}
\DoxyCodeLine{00743         noaf\_id = H5Dopen(file\_id, "{}/number\_of\_activated\_flaws"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00744         if (noaf\_id < 0) \{}
\DoxyCodeLine{00745             fprintf(stderr, "{}Could not find number of activated flaws information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00746             exit(1);}
\DoxyCodeLine{00747         \}}
\DoxyCodeLine{00748         ix = (int *) malloc(sizeof(int) * my\_anop);}
\DoxyCodeLine{00749         status = H5Dread(noaf\_id, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, ix);}
\DoxyCodeLine{00750         status = H5Dclose(noaf\_id);}
\DoxyCodeLine{00751 }
\DoxyCodeLine{00752         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00753             p\_host.numActiveFlaws[i] = ix[i];}
\DoxyCodeLine{00754         \}}
\DoxyCodeLine{00755         free(ix);}
\DoxyCodeLine{00756 }
\DoxyCodeLine{00757         /* damage */}
\DoxyCodeLine{00758         damage\_id = H5Dopen(file\_id, "{}/DIM\_root\_of\_damage\_tensile"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00759         if (damage\_id < 0) \{}
\DoxyCodeLine{00760             fprintf(stderr, "{}Could not find tensile damage information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00761             exit(1);}
\DoxyCodeLine{00762         \}}
\DoxyCodeLine{00763         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00764         status = H5Dread(damage\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00765         status = H5Dclose(damage\_id);}
\DoxyCodeLine{00766 }
\DoxyCodeLine{00767         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00768             p\_host.d[i] = x[i];}
\DoxyCodeLine{00769         \}}
\DoxyCodeLine{00770         free(x);}
\DoxyCodeLine{00771 }
\DoxyCodeLine{00772 }
\DoxyCodeLine{00773         /* now the activation thresholds */}
\DoxyCodeLine{00774         /* read max number of activation threshold */}
\DoxyCodeLine{00775         maxnof\_id = H5Dopen(file\_id, "{}/maximum\_number\_of\_flaws"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00776         if (maxnof\_id < 0) \{}
\DoxyCodeLine{00777             fprintf(stderr, "{}Could not find maximum number of flaws in hdf5 file.  Exiting.\(\backslash\)n"{});}
\DoxyCodeLine{00778             exit(1);}
\DoxyCodeLine{00779         \}}
\DoxyCodeLine{00780         status = H5Dread(maxnof\_id, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, \&maxnof);}
\DoxyCodeLine{00781         status = H5Dclose(maxnof\_id);}
\DoxyCodeLine{00782 }
\DoxyCodeLine{00783         fprintf(stdout, "{}Maximum number of activation thresholds for a particle in the data is \%d\(\backslash\)n"{}, maxnof);}
\DoxyCodeLine{00784 }
\DoxyCodeLine{00785 }
\DoxyCodeLine{00786         /* now read the activation thresholds */}
\DoxyCodeLine{00787         dims[0] = my\_anop;}
\DoxyCodeLine{00788         dims[1] = maxnof;}
\DoxyCodeLine{00789         x = (double *) malloc(sizeof(double) * my\_anop * maxnof);}
\DoxyCodeLine{00790         if (!x) \{}
\DoxyCodeLine{00791             fprintf(stderr, "{}Cannot allocate enough memory.\(\backslash\)n"{});}
\DoxyCodeLine{00792             exit(1);}
\DoxyCodeLine{00793         \}}
\DoxyCodeLine{00794         activation\_thresholds\_id = H5Dopen(file\_id, "{}/activation\_thresholds"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00795         if (activation\_thresholds\_id < 0) \{}
\DoxyCodeLine{00796             fprintf(stderr, "{}Could not find activation thresholds in hdf5 file.  Exiting.\(\backslash\)n"{});}
\DoxyCodeLine{00797             exit(1);}
\DoxyCodeLine{00798         \}}
\DoxyCodeLine{00799         status = H5Dread(activation\_thresholds\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00800         status = H5Dclose(activation\_thresholds\_id);}
\DoxyCodeLine{00801 }
\DoxyCodeLine{00802         ax = (double *) malloc(sizeof(double) * maxnof);}
\DoxyCodeLine{00803         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00804             nofi = 0;}
\DoxyCodeLine{00805             while (x[i*maxnof + nofi] > 0 \&\& nofi < maxnof) \{}
\DoxyCodeLine{00806                 ax[nofi] = x[i*maxnof + nofi];}
\DoxyCodeLine{00807                 nofi++;}
\DoxyCodeLine{00808             \}}
\DoxyCodeLine{00809 }
\DoxyCodeLine{00810             p\_host.numFlaws[i] = nofi;}
\DoxyCodeLine{00811             for (d = 0; d < nofi; d++) \{}
\DoxyCodeLine{00812                 p\_host.flaws[i*MAX\_NUM\_FLAWS+d] = ax[d];}
\DoxyCodeLine{00813             \}}
\DoxyCodeLine{00814         \}}
\DoxyCodeLine{00815         free(ax);}
\DoxyCodeLine{00816         free(x);}
\DoxyCodeLine{00817 \#endif}
\DoxyCodeLine{00818 }
\DoxyCodeLine{00819 \#if NAVIER\_STOKES}
\DoxyCodeLine{00820         /* deviatoric stresses */}
\DoxyCodeLine{00821         x = (double *) malloc(sizeof(double) * my\_anop * DIM * DIM);}
\DoxyCodeLine{00822         dims[0] = my\_anop;}
\DoxyCodeLine{00823         dims[1] = DIM*DIM;}
\DoxyCodeLine{00824 }
\DoxyCodeLine{00825         Tshear\_id = H5Dopen(file\_id, "{}/viscous\_shear\_stress"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00826         if (Tshear\_id < 0) \{}
\DoxyCodeLine{00827             fprintf(stderr, "{}Could not find viscous\_shear\_stress information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00828             exit(1);}
\DoxyCodeLine{00829         \}}
\DoxyCodeLine{00830         status = H5Dread(Tshear\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00831         status = H5Dclose(Tshear\_id);}
\DoxyCodeLine{00832         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00833             for (d = 0; d < DIM; d++) \{}
\DoxyCodeLine{00834                 for (e = 0; e < DIM; e++) \{}
\DoxyCodeLine{00835                     p\_host.Tshear[i*DIM*DIM+d*DIM+e] = x[i*DIM*DIM + d*DIM + e];}
\DoxyCodeLine{00836                 \}}
\DoxyCodeLine{00837             \}}
\DoxyCodeLine{00838         \}}
\DoxyCodeLine{00839         free(x);}
\DoxyCodeLine{00840 \#endif}
\DoxyCodeLine{00841 }
\DoxyCodeLine{00842 \#if SOLID}
\DoxyCodeLine{00843         /* deviatoric stresses */}
\DoxyCodeLine{00844         x = (double *) malloc(sizeof(double) * my\_anop * DIM * DIM);}
\DoxyCodeLine{00845         dims[0] = my\_anop;}
\DoxyCodeLine{00846         dims[1] = DIM*DIM;}
\DoxyCodeLine{00847 }
\DoxyCodeLine{00848         S\_id = H5Dopen(file\_id, "{}/deviatoric\_stress"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00849         if (S\_id < 0) \{}
\DoxyCodeLine{00850             fprintf(stderr, "{}Could not find stress information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00851             exit(1);}
\DoxyCodeLine{00852         \}}
\DoxyCodeLine{00853         status = H5Dread(S\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00854         status = H5Dclose(S\_id);}
\DoxyCodeLine{00855         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00856             for (d = 0; d < DIM; d++) \{}
\DoxyCodeLine{00857                 for (e = 0; e < DIM; e++) \{}
\DoxyCodeLine{00858                     p\_host.S[i*DIM*DIM+d*DIM+e] = x[i*DIM*DIM + d*DIM + e];}
\DoxyCodeLine{00859                 \}}
\DoxyCodeLine{00860             \}}
\DoxyCodeLine{00861         \}}
\DoxyCodeLine{00862         free(x);}
\DoxyCodeLine{00863 \#endif}
\DoxyCodeLine{00864 }
\DoxyCodeLine{00865         H5Fclose(file\_id);}
\DoxyCodeLine{00866 }
\DoxyCodeLine{00867 \#if GRAVITATING\_POINT\_MASSES}
\DoxyCodeLine{00868         file\_id = H5Fopen (h5massfilename, H5F\_ACC\_RDONLY, H5P\_DEFAULT);}
\DoxyCodeLine{00869         if (file\_id < 0) \{}
\DoxyCodeLine{00870             fprintf(stderr, "{}********************** Error opening file \%s\(\backslash\)n"{}, h5massfilename);}
\DoxyCodeLine{00871             exit(1);}
\DoxyCodeLine{00872         \} else \{}
\DoxyCodeLine{00873             fprintf(stdout, "{}Using hdf5 input file \%s\(\backslash\)n"{}, h5massfilename);}
\DoxyCodeLine{00874         \}}
\DoxyCodeLine{00875 }
\DoxyCodeLine{00876         /* open the dataset for the positions */}
\DoxyCodeLine{00877         x\_id = H5Dopen(file\_id, "{}/x"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00878         if (x\_id < 0) \{}
\DoxyCodeLine{00879             fprintf(stderr, "{}Could not find locations in hdf5 file.  Exiting.\(\backslash\)n"{});}
\DoxyCodeLine{00880         \}}
\DoxyCodeLine{00881 }
\DoxyCodeLine{00882         /* determine number of particles stored in hdf5 file */}
\DoxyCodeLine{00883         dspace = H5Dget\_space(x\_id);}
\DoxyCodeLine{00884         const int mndims = H5Sget\_simple\_extent\_ndims(dspace);}
\DoxyCodeLine{00885         hsize\_t mdims[mndims];}
\DoxyCodeLine{00886         H5Sget\_simple\_extent\_dims(dspace, mdims, NULL);}
\DoxyCodeLine{00887         my\_anop = mdims[0];}
\DoxyCodeLine{00888 }
\DoxyCodeLine{00889         fprintf(stdout, "{}Reading data for \%d pointmasses.\(\backslash\)n"{}, my\_anop);}
\DoxyCodeLine{00890 }
\DoxyCodeLine{00891         /* allocate space for my\_anop particles */}
\DoxyCodeLine{00892 }
\DoxyCodeLine{00893         /* read positions */}
\DoxyCodeLine{00894         x = (double *) malloc(sizeof(double) * my\_anop * DIM);}
\DoxyCodeLine{00895 }
\DoxyCodeLine{00896         status = H5Dread(x\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00897         status = H5Dclose(x\_id);}
\DoxyCodeLine{00898         for (i = 0, d = 0; i < my\_anop; i++, d += DIM) \{}
\DoxyCodeLine{00899             pointmass\_host.x[i] = x[d];}
\DoxyCodeLine{00900 \#if DIM > 1}
\DoxyCodeLine{00901             pointmass\_host.y[i] = x[d+1];}
\DoxyCodeLine{00902 \#if DIM == 3}
\DoxyCodeLine{00903             pointmass\_host.z[i] = x[d+2];}
\DoxyCodeLine{00904 \#endif}
\DoxyCodeLine{00905 \#endif}
\DoxyCodeLine{00906         \}}
\DoxyCodeLine{00907 }
\DoxyCodeLine{00908         /* read velocities */}
\DoxyCodeLine{00909         v\_id = H5Dopen(file\_id, "{}/v"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00910         if (v\_id < 0) \{}
\DoxyCodeLine{00911             fprintf(stderr, "{}Could not find velocities in hdf5 file.  Exiting.\(\backslash\)n"{});}
\DoxyCodeLine{00912             exit(1);}
\DoxyCodeLine{00913         \}}
\DoxyCodeLine{00914         status = H5Dread(v\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00915         status = H5Dclose(v\_id);}
\DoxyCodeLine{00916         for (i = 0, d = 0; i < my\_anop; i++, d += DIM) \{}
\DoxyCodeLine{00917             pointmass\_host.vx[i] = x[d];}
\DoxyCodeLine{00918 \#if DIM > 1}
\DoxyCodeLine{00919             pointmass\_host.vy[i] = x[d+1];}
\DoxyCodeLine{00920 \#if DIM == 3}
\DoxyCodeLine{00921             pointmass\_host.vz[i] = x[d+2];}
\DoxyCodeLine{00922 \#endif}
\DoxyCodeLine{00923 \#endif}
\DoxyCodeLine{00924         \}}
\DoxyCodeLine{00925 }
\DoxyCodeLine{00926         /* read mass */}
\DoxyCodeLine{00927         /* mass */}
\DoxyCodeLine{00928         dims[0] = my\_anop;}
\DoxyCodeLine{00929         dims[1] = 1;}
\DoxyCodeLine{00930         free(x);}
\DoxyCodeLine{00931         x = (double * ) malloc(sizeof(double) * my\_anop);}
\DoxyCodeLine{00932         m\_id = H5Dopen(file\_id, "{}/m"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00933         if (m\_id < 0) \{}
\DoxyCodeLine{00934             fprintf(stderr, "{}Could not find mass information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00935             exit(1);}
\DoxyCodeLine{00936         \}}
\DoxyCodeLine{00937         status = H5Dread(m\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00938         status = H5Dclose(m\_id);}
\DoxyCodeLine{00939 }
\DoxyCodeLine{00940         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00941             pointmass\_host.m[i] = x[i];}
\DoxyCodeLine{00942         \}}
\DoxyCodeLine{00943 }
\DoxyCodeLine{00944         rmin\_id = H5Dopen(file\_id, "{}/rmin"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00945         if (rmin\_id < 0) \{}
\DoxyCodeLine{00946             fprintf(stderr, "{}Could not find rmin information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00947             exit(1);}
\DoxyCodeLine{00948         \}}
\DoxyCodeLine{00949         status = H5Dread(rmin\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00950         status = H5Dclose(rmin\_id);}
\DoxyCodeLine{00951 }
\DoxyCodeLine{00952         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00953             pointmass\_host.rmin[i] = x[i];}
\DoxyCodeLine{00954         \}}
\DoxyCodeLine{00955 }
\DoxyCodeLine{00956         rmax\_id = H5Dopen(file\_id, "{}/rmax"{}, H5P\_DEFAULT);}
\DoxyCodeLine{00957         if (rmax\_id < 0) \{}
\DoxyCodeLine{00958             fprintf(stderr, "{}Could not find rmax information in hdf5 file.  Exiting\(\backslash\)n"{});}
\DoxyCodeLine{00959             exit(1);}
\DoxyCodeLine{00960         \}}
\DoxyCodeLine{00961         status = H5Dread(rmax\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{00962         status = H5Dclose(rmax\_id);}
\DoxyCodeLine{00963 }
\DoxyCodeLine{00964         for (i = 0; i < my\_anop; i++) \{}
\DoxyCodeLine{00965             pointmass\_host.rmax[i] = x[i];}
\DoxyCodeLine{00966         \}}
\DoxyCodeLine{00967 }
\DoxyCodeLine{00968         free(x);}
\DoxyCodeLine{00969         H5Fclose(file\_id);}
\DoxyCodeLine{00970 \#endif}
\DoxyCodeLine{00971 }
\DoxyCodeLine{00972 }
\DoxyCodeLine{00973         if (param.verbose) \{}
\DoxyCodeLine{00974             fprintf(stdout, "{}\%d\(\backslash\)n"{}, status);}
\DoxyCodeLine{00975         \}}
\DoxyCodeLine{00976 }
\DoxyCodeLine{00977     \}}
\DoxyCodeLine{00978 }
\DoxyCodeLine{00979 \#endif}
\DoxyCodeLine{00980 }
\DoxyCodeLine{00981 \#if FRAGMENTATION}
\DoxyCodeLine{00982     maxNumFlaws\_host = MAX\_NUM\_FLAWS;}
\DoxyCodeLine{00983 \#endif}
\DoxyCodeLine{00984     int columns;}
\DoxyCodeLine{00985     char iotmp[256];}
\DoxyCodeLine{00986 }
\DoxyCodeLine{00987 }
\DoxyCodeLine{00988     if (!param.hdf5input) \{}
\DoxyCodeLine{00989         for (i = 0; i < numberOfParticles; i++) \{}
\DoxyCodeLine{00990             // read in coordinates}
\DoxyCodeLine{00991             columns = 0;}
\DoxyCodeLine{00992             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{00993                 fprintf(stderr, "{}could not read x-\/position from input file\(\backslash\)n"{});}
\DoxyCodeLine{00994             p\_host.x[i] = atof(iotmp);}
\DoxyCodeLine{00995             columns++;}
\DoxyCodeLine{00996 \#if DIM > 1}
\DoxyCodeLine{00997             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{00998                 fprintf(stderr, "{}could not read y-\/position from input file\(\backslash\)n"{});}
\DoxyCodeLine{00999             p\_host.y[i] = atof(iotmp);}
\DoxyCodeLine{01000             columns++;}
\DoxyCodeLine{01001 \#if DIM == 3}
\DoxyCodeLine{01002             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01003                 fprintf(stderr, "{}could not read z-\/position from input file\(\backslash\)n"{});}
\DoxyCodeLine{01004             p\_host.z[i] = atof(iotmp);}
\DoxyCodeLine{01005             columns++;}
\DoxyCodeLine{01006 \#endif}
\DoxyCodeLine{01007 \#endif}
\DoxyCodeLine{01008             // read in velocities}
\DoxyCodeLine{01009             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01010                 fprintf(stderr, "{}could not read x-\/velocity from input file\(\backslash\)n"{});}
\DoxyCodeLine{01011             p\_host.vx[i] = atof(iotmp);}
\DoxyCodeLine{01012             columns++;}
\DoxyCodeLine{01013 \#if DIM > 1}
\DoxyCodeLine{01014             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01015                 fprintf(stderr, "{}could not read y-\/velocity from input file\(\backslash\)n"{});}
\DoxyCodeLine{01016             p\_host.vy[i] = atof(iotmp);}
\DoxyCodeLine{01017             columns++;}
\DoxyCodeLine{01018 \#if DIM == 3}
\DoxyCodeLine{01019             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01020                 fprintf(stderr, "{}could not read z-\/velocity from input file\(\backslash\)n"{});}
\DoxyCodeLine{01021             p\_host.vz[i] = atof(iotmp);}
\DoxyCodeLine{01022             columns++;}
\DoxyCodeLine{01023 \#endif}
\DoxyCodeLine{01024 \#endif}
\DoxyCodeLine{01025             // read in mass}
\DoxyCodeLine{01026             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01027                 fprintf(stderr, "{}could not read mass from input file\(\backslash\)n"{});}
\DoxyCodeLine{01028             p\_host.m[i] = atof(iotmp);}
\DoxyCodeLine{01029             columns++;}
\DoxyCodeLine{01030 \#if INTEGRATE\_DENSITY}
\DoxyCodeLine{01031             // read in density}
\DoxyCodeLine{01032             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01033                 fprintf(stderr, "{}could not read density from input file\(\backslash\)n"{});}
\DoxyCodeLine{01034             p\_host.rho[i] = atof(iotmp);}
\DoxyCodeLine{01035             columns++;}
\DoxyCodeLine{01036 \#endif}
\DoxyCodeLine{01037 }
\DoxyCodeLine{01038 \#if INTEGRATE\_ENERGY}
\DoxyCodeLine{01039             // read in energy}
\DoxyCodeLine{01040             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01041                 fprintf(stderr, "{}could not read energy from input file\(\backslash\)n"{});}
\DoxyCodeLine{01042             p\_host.e[i] = atof(iotmp);}
\DoxyCodeLine{01043             columns++;}
\DoxyCodeLine{01044 \#endif}
\DoxyCodeLine{01045 }
\DoxyCodeLine{01046 }
\DoxyCodeLine{01047 \#if READ\_INITIAL\_SML\_FROM\_PARTICLE\_FILE}
\DoxyCodeLine{01048             // read in smoothing length}
\DoxyCodeLine{01049             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01050                 fprintf(stderr, "{}could not read smoothing length from input file\(\backslash\)n"{});}
\DoxyCodeLine{01051             p\_host.h[i] = atof(iotmp);}
\DoxyCodeLine{01052             columns++;}
\DoxyCodeLine{01053 \#else}
\DoxyCodeLine{01054             if (param.restart) \{}
\DoxyCodeLine{01055                 // dummy read in of sml}
\DoxyCodeLine{01056                 fscanf(inputFile.data, "{}\%s"{}, \&iotmp);}
\DoxyCodeLine{01057                 // dummy read in of number of interaction partners}
\DoxyCodeLine{01058                 fscanf(inputFile.data, "{}\%s"{}, \&iotmp);}
\DoxyCodeLine{01059             \}}
\DoxyCodeLine{01060 \#endif}
\DoxyCodeLine{01061 }
\DoxyCodeLine{01062             // read in material ID}
\DoxyCodeLine{01063             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01064                 fprintf(stderr, "{}could not read material ID from particle \%d input file\(\backslash\)n"{}, i);}
\DoxyCodeLine{01065             p\_host.materialId[i] = atoi(iotmp);}
\DoxyCodeLine{01066             columns++;}
\DoxyCodeLine{01067 }
\DoxyCodeLine{01068 \#if JC\_PLASTICITY}
\DoxyCodeLine{01069             // read in strain}
\DoxyCodeLine{01070             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01071                 fprintf(stderr, "{}could not read strain from particle \%d input file\(\backslash\)n"{}, i);}
\DoxyCodeLine{01072             p\_host.ep[i] = atof(iotmp);}
\DoxyCodeLine{01073             columns++;}
\DoxyCodeLine{01074 }
\DoxyCodeLine{01075             // read in temperature}
\DoxyCodeLine{01076             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01077                 fprintf(stderr, "{}could not read temperature from particle \%d input file\(\backslash\)n"{}, i);}
\DoxyCodeLine{01078             p\_host.T[i] = atof(iotmp);}
\DoxyCodeLine{01079             columns++;}
\DoxyCodeLine{01080 \#endif}
\DoxyCodeLine{01081 }
\DoxyCodeLine{01082 \#if FRAGMENTATION}
\DoxyCodeLine{01083             // read in number of flaws}
\DoxyCodeLine{01084             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01085                 fprintf(stderr, "{}could not read number of flaws from input file\(\backslash\)n"{});}
\DoxyCodeLine{01086             p\_host.numFlaws[i] = atoi(iotmp);}
\DoxyCodeLine{01087             columns++;}
\DoxyCodeLine{01088             maxNumFlaws\_host = max(maxNumFlaws\_host, p\_host.numFlaws[i]);}
\DoxyCodeLine{01089             if (maxNumFlaws\_host > MAX\_NUM\_FLAWS) \{}
\DoxyCodeLine{01090                 fprintf(stderr, "{}set max num flaws higher: \%d\(\backslash\)n"{}, maxNumFlaws\_host);}
\DoxyCodeLine{01091                 exit(1);}
\DoxyCodeLine{01092             \}}
\DoxyCodeLine{01093             if (param.restart) \{}
\DoxyCodeLine{01094                 // dummy read in of number of activated flaws}
\DoxyCodeLine{01095                 fscanf(inputFile.data, "{}\%s"{}, \&iotmp);}
\DoxyCodeLine{01096                 // dummy read in of local strain}
\DoxyCodeLine{01097                 fscanf(inputFile.data, "{}\%s"{}, \&iotmp);}
\DoxyCodeLine{01098             \}}
\DoxyCodeLine{01099             // read in damage}
\DoxyCodeLine{01100             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01101                 fprintf(stderr, "{}could not read damage from input file\(\backslash\)n"{});}
\DoxyCodeLine{01102             p\_host.d[i] = atof(iotmp);}
\DoxyCodeLine{01103             columns++;}
\DoxyCodeLine{01104 \#endif}
\DoxyCodeLine{01105 }
\DoxyCodeLine{01106             if (param.restart) \{}
\DoxyCodeLine{01107                 // dummy read in of pressure}
\DoxyCodeLine{01108                 fscanf(inputFile.data, "{}\%s"{}, \&iotmp);}
\DoxyCodeLine{01109 }
\DoxyCodeLine{01110             \}}
\DoxyCodeLine{01111 }
\DoxyCodeLine{01112 \#if SOLID}
\DoxyCodeLine{01113             // read in stress tensor}
\DoxyCodeLine{01114             int j, k;}
\DoxyCodeLine{01115             for (j = 0; j < DIM; j++) \{}
\DoxyCodeLine{01116                 for (k = 0; k < DIM; k++) \{}
\DoxyCodeLine{01117                     if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01118                         fprintf(stderr, "{}could not read stress tensor from input file\(\backslash\)n"{});}
\DoxyCodeLine{01119                     p\_host.S[i*DIM*DIM+j*DIM+k] = atof(iotmp);}
\DoxyCodeLine{01120                     columns++;}
\DoxyCodeLine{01121                 \}}
\DoxyCodeLine{01122             \}}
\DoxyCodeLine{01123 \#endif}
\DoxyCodeLine{01124 }
\DoxyCodeLine{01125 \#if SIRONO\_POROSITY}
\DoxyCodeLine{01126             // read in rho\_0prime}
\DoxyCodeLine{01127             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01128                 fprintf(stderr, "{}could not read rho\_0prime from input file\(\backslash\)n"{});}
\DoxyCodeLine{01129             p\_host.rho\_0prime[i] = atof(iotmp);}
\DoxyCodeLine{01130             columns++;}
\DoxyCodeLine{01131 }
\DoxyCodeLine{01132             // read in rho\_c\_plus}
\DoxyCodeLine{01133             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01134                 fprintf(stderr, "{}could not read rho\_c\_plus from input file\(\backslash\)n"{});}
\DoxyCodeLine{01135             p\_host.rho\_c\_plus[i] = atof(iotmp);}
\DoxyCodeLine{01136             columns++;}
\DoxyCodeLine{01137 }
\DoxyCodeLine{01138             // read in rho\_c\_minus}
\DoxyCodeLine{01139             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01140                 fprintf(stderr, "{}could not read rho\_c\_minus from input file\(\backslash\)n"{});}
\DoxyCodeLine{01141             p\_host.rho\_c\_minus[i] = atof(iotmp);}
\DoxyCodeLine{01142             columns++;}
\DoxyCodeLine{01143 }
\DoxyCodeLine{01144             // read in compressive\_strength}
\DoxyCodeLine{01145             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01146                 fprintf(stderr, "{}could not read compressive\_strength from input file\(\backslash\)n"{});}
\DoxyCodeLine{01147             p\_host.compressive\_strength[i] = atof(iotmp);}
\DoxyCodeLine{01148             columns++;}
\DoxyCodeLine{01149 }
\DoxyCodeLine{01150             // read in tensile\_strength}
\DoxyCodeLine{01151             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01152                 fprintf(stderr, "{}could not read tensile\_strength from input file\(\backslash\)n"{});}
\DoxyCodeLine{01153             p\_host.tensile\_strength[i] = atof(iotmp);}
\DoxyCodeLine{01154             columns++;}
\DoxyCodeLine{01155 }
\DoxyCodeLine{01156             // read in bulk modulus K}
\DoxyCodeLine{01157             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01158                 fprintf(stderr, "{}could not read bulk modulus K from input file\(\backslash\)n"{});}
\DoxyCodeLine{01159             p\_host.K[i] = atof(iotmp);}
\DoxyCodeLine{01160             columns++;}
\DoxyCodeLine{01161 }
\DoxyCodeLine{01162             // read in flag\_rho\_0prime}
\DoxyCodeLine{01163             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01164                 fprintf(stderr, "{}could not read flag\_rho\_0prime from input file\(\backslash\)n"{});}
\DoxyCodeLine{01165             p\_host.flag\_rho\_0prime[i] = atoi(iotmp);}
\DoxyCodeLine{01166             columns++;}
\DoxyCodeLine{01167 }
\DoxyCodeLine{01168             // read in flag\_plastic}
\DoxyCodeLine{01169             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01170                 fprintf(stderr, "{}could not read flag\_plastic from input file\(\backslash\)n"{});}
\DoxyCodeLine{01171             p\_host.flag\_plastic[i] = atoi(iotmp);}
\DoxyCodeLine{01172             columns++;}
\DoxyCodeLine{01173 }
\DoxyCodeLine{01174             // read in shear\_strength}
\DoxyCodeLine{01175             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01176                 fprintf(stderr, "{}could not read shear\_strength from input file\(\backslash\)n"{});}
\DoxyCodeLine{01177             p\_host.shear\_strength[i] = atof(iotmp);}
\DoxyCodeLine{01178             columns++;}
\DoxyCodeLine{01179 \#endif}
\DoxyCodeLine{01180 }
\DoxyCodeLine{01181 \#if PALPHA\_POROSITY}
\DoxyCodeLine{01182             // read in alpha\_jutzi}
\DoxyCodeLine{01183             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01184                 fprintf(stderr, "{}could not read alpha\_jutzi from input file\(\backslash\)n"{});}
\DoxyCodeLine{01185             p\_host.alpha\_jutzi[i] = atof(iotmp);}
\DoxyCodeLine{01186             columns++;}
\DoxyCodeLine{01187             // read in initial pressure}
\DoxyCodeLine{01188             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01189                 fprintf(stderr, "{}could not read pressure from input file\(\backslash\)n"{});}
\DoxyCodeLine{01190             p\_host.pold[i] = atof(iotmp);}
\DoxyCodeLine{01191             columns++;}
\DoxyCodeLine{01192 \#endif}
\DoxyCodeLine{01193 \#if EPSALPHA\_POROSITY}
\DoxyCodeLine{01194             // read in alpha\_epspor}
\DoxyCodeLine{01195             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01196                 fprintf(stderr, "{}could not read alpha\_epspor from input file\(\backslash\)n"{});}
\DoxyCodeLine{01197             p\_host.alpha\_epspor[i] = atof(iotmp);}
\DoxyCodeLine{01198             columns++;}
\DoxyCodeLine{01199             // read in  epsilon\_v}
\DoxyCodeLine{01200             if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01201                 fprintf(stderr, "{}could not read epsilon\_v from input file\(\backslash\)n"{});}
\DoxyCodeLine{01202             p\_host.epsilon\_v[i] = atof(iotmp);}
\DoxyCodeLine{01203             columns++;}
\DoxyCodeLine{01204 \#endif}
\DoxyCodeLine{01205 \#if FRAGMENTATION}
\DoxyCodeLine{01206             int d;}
\DoxyCodeLine{01207             for (d = 0; d < p\_host.numFlaws[i]; d++) \{}
\DoxyCodeLine{01208                 if (!fscanf(inputFile.data, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01209                     fprintf(stderr, "{}could not read activation threshold\(\backslash\)n"{});}
\DoxyCodeLine{01210                 p\_host.flaws[i*MAX\_NUM\_FLAWS+d] = atof(iotmp);}
\DoxyCodeLine{01211                 columns++;}
\DoxyCodeLine{01212             \}}
\DoxyCodeLine{01213 \#endif}
\DoxyCodeLine{01214 //          fprintf(stderr,"{}i= \%d xyz= \%e \%e \%e\(\backslash\)n"{},i,p\_host.x[i],p\_host.y[i],p\_host.z[i]);}
\DoxyCodeLine{01215         \}}
\DoxyCodeLine{01216         // here we check if we reached the end of the line or the file}
\DoxyCodeLine{01217         c = fgetc(inputFile.data);}
\DoxyCodeLine{01218         if (c != '\(\backslash\)n' \&\& c != EOF \&\& c != '\(\backslash\)t') \{}
\DoxyCodeLine{01219             fprintf(stderr, "{}Error in input file formation. Read \%d columns and did not reach end of line.\(\backslash\)n"{}, columns);}
\DoxyCodeLine{01220             fprintf(stderr, "{}c=\%c. i=\%d.\(\backslash\)n"{}, c, c);}
\DoxyCodeLine{01221             exit(1);}
\DoxyCodeLine{01222         \}}
\DoxyCodeLine{01223 }
\DoxyCodeLine{01224 \#if GRAVITATING\_POINT\_MASSES}
\DoxyCodeLine{01225         if ((massfile = fopen(massfilename, "{}r"{})) == NULL) \{}
\DoxyCodeLine{01226         fprintf(stderr, "{}Wtf? File \%s not found.\(\backslash\)n"{}, massfilename);}
\DoxyCodeLine{01227             exit(1);}
\DoxyCodeLine{01228         \}}
\DoxyCodeLine{01229 }
\DoxyCodeLine{01230         for (i = 0; i < numberOfPointmasses; i++) \{}
\DoxyCodeLine{01231             // read in coordinates}
\DoxyCodeLine{01232             columns = 0;}
\DoxyCodeLine{01233             if (!fscanf(massfile, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01234                 fprintf(stderr, "{}could not read x-\/position from input file\(\backslash\)n"{});}
\DoxyCodeLine{01235             pointmass\_host.x[i] = atof(iotmp);}
\DoxyCodeLine{01236             columns++;}
\DoxyCodeLine{01237 \#if DIM > 1}
\DoxyCodeLine{01238             if (!fscanf(massfile, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01239                 fprintf(stderr, "{}could not read y-\/position from input file\(\backslash\)n"{});}
\DoxyCodeLine{01240             pointmass\_host.y[i] = atof(iotmp);}
\DoxyCodeLine{01241             columns++;}
\DoxyCodeLine{01242 \#if DIM == 3}
\DoxyCodeLine{01243             if (!fscanf(massfile, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01244                 fprintf(stderr, "{}could not read z-\/position from input file\(\backslash\)n"{});}
\DoxyCodeLine{01245             pointmass\_host.z[i] = atof(iotmp);}
\DoxyCodeLine{01246             columns++;}
\DoxyCodeLine{01247 \#endif}
\DoxyCodeLine{01248 \#endif}
\DoxyCodeLine{01249             // read in velocities}
\DoxyCodeLine{01250             if (!fscanf(massfile, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01251                 fprintf(stderr, "{}could not read x-\/velocity from input file\(\backslash\)n"{});}
\DoxyCodeLine{01252             pointmass\_host.vx[i] = atof(iotmp);}
\DoxyCodeLine{01253             columns++;}
\DoxyCodeLine{01254 \#if DIM > 1}
\DoxyCodeLine{01255             if (!fscanf(massfile, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01256                 fprintf(stderr, "{}could not read y-\/velocity from input file\(\backslash\)n"{});}
\DoxyCodeLine{01257             pointmass\_host.vy[i] = atof(iotmp);}
\DoxyCodeLine{01258             columns++;}
\DoxyCodeLine{01259 \#if DIM == 3}
\DoxyCodeLine{01260             if (!fscanf(massfile, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01261                 fprintf(stderr, "{}could not read z-\/velocity from input file\(\backslash\)n"{});}
\DoxyCodeLine{01262             pointmass\_host.vz[i] = atof(iotmp);}
\DoxyCodeLine{01263             columns++;}
\DoxyCodeLine{01264 \#endif}
\DoxyCodeLine{01265 \#endif}
\DoxyCodeLine{01266             // read in mass}
\DoxyCodeLine{01267             if (!fscanf(massfile, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01268                 fprintf(stderr, "{}could not read mass from input file\(\backslash\)n"{});}
\DoxyCodeLine{01269             pointmass\_host.m[i] = atof(iotmp);}
\DoxyCodeLine{01270             columns++;}
\DoxyCodeLine{01271             // read in rmin}
\DoxyCodeLine{01272             if (!fscanf(massfile, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01273                 fprintf(stderr, "{}could not read rmin from input file\(\backslash\)n"{});}
\DoxyCodeLine{01274             pointmass\_host.rmin[i] = atof(iotmp);}
\DoxyCodeLine{01275             columns++;}
\DoxyCodeLine{01276             // read in rmax}
\DoxyCodeLine{01277             if (!fscanf(massfile, "{}\%s"{}, \&iotmp))}
\DoxyCodeLine{01278                 fprintf(stderr, "{}could not read rmax from input file\(\backslash\)n"{});}
\DoxyCodeLine{01279             pointmass\_host.rmax[i] = atof(iotmp);}
\DoxyCodeLine{01280             columns++;}
\DoxyCodeLine{01281         \}}
\DoxyCodeLine{01282 }
\DoxyCodeLine{01283         c = fgetc(massfile);}
\DoxyCodeLine{01284         if (c != '\(\backslash\)n' \&\& c != EOF \&\& c != '\(\backslash\)t') \{}
\DoxyCodeLine{01285             fprintf(stderr, "{}Error in input file formation. Read \%d columns and did not reach end of line.\(\backslash\)n"{}, columns);}
\DoxyCodeLine{01286             fprintf(stderr, "{}c=\%c. i=\%d.\(\backslash\)n"{}, c, c);}
\DoxyCodeLine{01287             exit(1);}
\DoxyCodeLine{01288         \}}
\DoxyCodeLine{01289         fclose(massfile);}
\DoxyCodeLine{01290 \#endif // GRAVITATING\_POINT\_MASSES}
\DoxyCodeLine{01291     \} /* ! param.hdf5input */}
\DoxyCodeLine{01292 }
\DoxyCodeLine{01293 }
\DoxyCodeLine{01294 \}}
\DoxyCodeLine{01295 }
\DoxyCodeLine{01296 void write\_particles\_to\_file(File file) \{}
\DoxyCodeLine{01297 }
\DoxyCodeLine{01298     char h5filename[256];}
\DoxyCodeLine{01299     char infofilename[256];}
\DoxyCodeLine{01300     char massfilename[256];}
\DoxyCodeLine{01301     char h5massfilename[256];}
\DoxyCodeLine{01302     double *x;}
\DoxyCodeLine{01303     int *ix;}
\DoxyCodeLine{01304     int e;}
\DoxyCodeLine{01305     int i, j, k;}
\DoxyCodeLine{01306     int d;}
\DoxyCodeLine{01307     FILE *infofile;}
\DoxyCodeLine{01308     FILE *massfile;}
\DoxyCodeLine{01309     double totalp, totalmass, totalkineticenergy, totalinnerenergy;}
\DoxyCodeLine{01310     double totalangularmomentum[DIM], totalL;}
\DoxyCodeLine{01311     double totalpx, totalpy, v;}
\DoxyCodeLine{01312 \#if DIM == 3}
\DoxyCodeLine{01313     double totalpz = 0;}
\DoxyCodeLine{01314 \#endif}
\DoxyCodeLine{01315     totalp = totalmass = totalkineticenergy = totalinnerenergy = totalpx = totalpy = 0.0;}
\DoxyCodeLine{01316 }
\DoxyCodeLine{01317     strcpy(h5filename, file.name);}
\DoxyCodeLine{01318     strcat(h5filename, "{}.h5"{});}
\DoxyCodeLine{01319     strcpy(infofilename, file.name);}
\DoxyCodeLine{01320     strcat(infofilename, "{}.info"{});}
\DoxyCodeLine{01321     strcpy(massfilename, file.name);}
\DoxyCodeLine{01322     strcat(massfilename, "{}.mass"{});}
\DoxyCodeLine{01323     strcpy(h5massfilename, massfilename);}
\DoxyCodeLine{01324     strcat(h5massfilename, "{}.h5"{});}
\DoxyCodeLine{01325 }
\DoxyCodeLine{01326 \#if HDF5IO}
\DoxyCodeLine{01327     /* hdf5 related stuff */}
\DoxyCodeLine{01328     hid\_t file\_id;}
\DoxyCodeLine{01329     hid\_t x\_id, v\_id, m\_id, rho\_id, e\_id, sml\_id, noi\_id, mtype\_id;}
\DoxyCodeLine{01330     hid\_t a\_id;}
\DoxyCodeLine{01331     hid\_t g\_a\_id;}
\DoxyCodeLine{01332 \#if MORE\_ANEOS\_OUTPUT}
\DoxyCodeLine{01333     hid\_t aneos\_T\_id, aneos\_cs\_id, aneos\_entropy\_id, aneos\_phase\_flag\_id;}
\DoxyCodeLine{01334 \#endif}
\DoxyCodeLine{01335     hid\_t time\_id;}
\DoxyCodeLine{01336     hid\_t cs\_id;}
\DoxyCodeLine{01337     hid\_t depth\_id;}
\DoxyCodeLine{01338 \#if GRAVITATING\_POINT\_MASSES}
\DoxyCodeLine{01339     hid\_t rmin\_id, rmax\_id;}
\DoxyCodeLine{01340 \#endif}
\DoxyCodeLine{01341 \#if FRAGMENTATION}
\DoxyCodeLine{01342     hid\_t noaf\_id, damage\_id;}
\DoxyCodeLine{01343     hid\_t dddt\_id;}
\DoxyCodeLine{01344     hid\_t activation\_thresholds\_id;}
\DoxyCodeLine{01345     hid\_t maxnof\_id;}
\DoxyCodeLine{01346     int maxnof = 0;}
\DoxyCodeLine{01347 \#if PALPHA\_POROSITY}
\DoxyCodeLine{01348     hid\_t damage\_porjutzi\_id;}
\DoxyCodeLine{01349     hid\_t damage\_total\_id;}
\DoxyCodeLine{01350     hid\_t ddamage\_porjutzidt\_id;}
\DoxyCodeLine{01351 \#endif}
\DoxyCodeLine{01352 \#endif}
\DoxyCodeLine{01353 \#if INTEGRATE\_DENSITY}
\DoxyCodeLine{01354     hid\_t drhodt\_id;}
\DoxyCodeLine{01355 \#endif}
\DoxyCodeLine{01356 \#if INTEGRATE\_ENERGY}
\DoxyCodeLine{01357     hid\_t dedt\_id;}
\DoxyCodeLine{01358 \#endif}
\DoxyCodeLine{01359 \#if JC\_PLASTICITY}
\DoxyCodeLine{01360     hid\_t ep\_id, T\_id;}
\DoxyCodeLine{01361 \#endif}
\DoxyCodeLine{01362     hid\_t p\_id;}
\DoxyCodeLine{01363 \#if NAVIER\_STOKES}
\DoxyCodeLine{01364     hid\_t Tshear\_id;}
\DoxyCodeLine{01365 \#endif}
\DoxyCodeLine{01366 \#if SOLID}
\DoxyCodeLine{01367     hid\_t S\_id;}
\DoxyCodeLine{01368     hid\_t dSdt\_id;}
\DoxyCodeLine{01369     hid\_t local\_strain\_id;}
\DoxyCodeLine{01370 \#endif}
\DoxyCodeLine{01371 }
\DoxyCodeLine{01372 \#if PALPHA\_POROSITY}
\DoxyCodeLine{01373     hid\_t alpha\_id;}
\DoxyCodeLine{01374     hid\_t dalphadt\_id;}
\DoxyCodeLine{01375 \#endif}
\DoxyCodeLine{01376 }
\DoxyCodeLine{01377 \#if SIRONO\_POROSITY}
\DoxyCodeLine{01378     hid\_t compressive\_strength\_id;}
\DoxyCodeLine{01379     hid\_t tensile\_strength\_id;}
\DoxyCodeLine{01380     hid\_t K\_id;}
\DoxyCodeLine{01381     hid\_t rho\_0prime\_id;}
\DoxyCodeLine{01382     hid\_t rho\_c\_plus\_id;}
\DoxyCodeLine{01383     hid\_t rho\_c\_minus\_id;}
\DoxyCodeLine{01384     hid\_t flag\_rho\_0prime\_id;}
\DoxyCodeLine{01385     hid\_t flag\_plastic\_id;}
\DoxyCodeLine{01386     hid\_t shear\_strength\_id;}
\DoxyCodeLine{01387 \#endif}
\DoxyCodeLine{01388 }
\DoxyCodeLine{01389 \#if EPSALPHA\_POROSITY}
\DoxyCodeLine{01390     hid\_t alpha\_epspor\_id;}
\DoxyCodeLine{01391     hid\_t epsilon\_v\_id;}
\DoxyCodeLine{01392 \#endif}
\DoxyCodeLine{01393 }
\DoxyCodeLine{01394     herr\_t status;}
\DoxyCodeLine{01395     hsize\_t dims[2];}
\DoxyCodeLine{01396     hid\_t dataspace\_id;}
\DoxyCodeLine{01397 \#endif // HDF5IO}
\DoxyCodeLine{01398 }
\DoxyCodeLine{01399     totalp = totalmass = totalkineticenergy = totalinnerenergy;}
\DoxyCodeLine{01400 }
\DoxyCodeLine{01401     if (! (param.hdf5output || param.ascii\_output)) \{}
\DoxyCodeLine{01402         fprintf(stderr, "{}Neither HDF5 nor ASCII output wanted. That's not what you want. Re-\/enabling ASCII output.\(\backslash\)n"{});}
\DoxyCodeLine{01403         param.ascii\_output = TRUE;}
\DoxyCodeLine{01404     \}}
\DoxyCodeLine{01405 }
\DoxyCodeLine{01406     if (param.ascii\_output) \{}
\DoxyCodeLine{01407         // open file for writing}
\DoxyCodeLine{01408         if ((file.data = fopen(file.name, "{}w"{})) == NULL) \{}
\DoxyCodeLine{01409             fprintf(stderr, "{}Eih? Cannot write to \%s.\(\backslash\)n"{}, file.name);}
\DoxyCodeLine{01410             exit(1);}
\DoxyCodeLine{01411         \}}
\DoxyCodeLine{01412         // write to file}
\DoxyCodeLine{01413         for (i = 0; i < numberOfParticles; i++) \{}
\DoxyCodeLine{01414             fprintf(file.data, "{}\%+.15le\(\backslash\)t"{}, p\_host.x[i]);}
\DoxyCodeLine{01415 \#if DIM > 1}
\DoxyCodeLine{01416             fprintf(file.data, "{}\%+.15le\(\backslash\)t"{}, p\_host.y[i]);}
\DoxyCodeLine{01417 \#if DIM == 3}
\DoxyCodeLine{01418             fprintf(file.data, "{}\%+.15le\(\backslash\)t"{}, p\_host.z[i]);}
\DoxyCodeLine{01419 \#endif}
\DoxyCodeLine{01420 \#endif}
\DoxyCodeLine{01421             fprintf(file.data, "{}\%+.15le\(\backslash\)t"{}, p\_host.vx[i]);}
\DoxyCodeLine{01422 \#if DIM > 1}
\DoxyCodeLine{01423             fprintf(file.data, "{}\%+.15le\(\backslash\)t"{}, p\_host.vy[i]);}
\DoxyCodeLine{01424 \#if DIM == 3}
\DoxyCodeLine{01425             fprintf(file.data, "{}\%+.15le\(\backslash\)t"{}, p\_host.vz[i]);}
\DoxyCodeLine{01426 \#endif}
\DoxyCodeLine{01427 \#endif}
\DoxyCodeLine{01428             fprintf(file.data, "{}\%e\(\backslash\)t"{}, p\_host.m[i]);}
\DoxyCodeLine{01429             fprintf(file.data, "{}\%e\(\backslash\)t"{}, p\_host.rho[i]);}
\DoxyCodeLine{01430 \#if INTEGRATE\_ENERGY}
\DoxyCodeLine{01431             fprintf(file.data, "{}\%e\(\backslash\)t"{}, p\_host.e[i]);}
\DoxyCodeLine{01432 \#endif}
\DoxyCodeLine{01433             fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.h[i]);}
\DoxyCodeLine{01434             fprintf(file.data, "{}\%d\(\backslash\)t"{}, p\_host.noi[i]);}
\DoxyCodeLine{01435             fprintf(file.data, "{}\%d\(\backslash\)t"{}, p\_host.materialId[i]);}
\DoxyCodeLine{01436 \#if JC\_PLASTICITY}
\DoxyCodeLine{01437             fprintf(file.data, "{}\%+.6le\(\backslash\)t"{}, p\_host.ep[i]);}
\DoxyCodeLine{01438             fprintf(file.data, "{}\%+.6le\(\backslash\)t"{}, p\_host.T[i]);}
\DoxyCodeLine{01439 \#endif}
\DoxyCodeLine{01440 \#if FRAGMENTATION}
\DoxyCodeLine{01441             fprintf(file.data, "{}\%d\(\backslash\)t"{}, p\_host.numFlaws[i]);}
\DoxyCodeLine{01442             fprintf(file.data, "{}\%d\(\backslash\)t"{}, p\_host.numActiveFlaws[i]);}
\DoxyCodeLine{01443             fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.d[i]);}
\DoxyCodeLine{01444 \#endif}
\DoxyCodeLine{01445 \#if !PALPHA\_POROSITY}
\DoxyCodeLine{01446             fprintf(file.data, "{}\%e\(\backslash\)t"{}, p\_host.p[i]);}
\DoxyCodeLine{01447 \#endif}
\DoxyCodeLine{01448 \#if SOLID}
\DoxyCodeLine{01449             fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.local\_strain[i]);}
\DoxyCodeLine{01450             for (j = 0; j < DIM; j++) \{}
\DoxyCodeLine{01451                 for (k = 0; k < DIM; k++) \{}
\DoxyCodeLine{01452                     fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.S[i*DIM*DIM+j*DIM+k]);}
\DoxyCodeLine{01453                 \}}
\DoxyCodeLine{01454             \}}
\DoxyCodeLine{01455 \#endif}
\DoxyCodeLine{01456 \#if NAVIER\_STOKES}
\DoxyCodeLine{01457             for (j = 0; j < DIM; j++) \{}
\DoxyCodeLine{01458                 for (k = 0; k < DIM; k++) \{}
\DoxyCodeLine{01459                     fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.Tshear[i*DIM*DIM+j*DIM+k]);}
\DoxyCodeLine{01460                 \}}
\DoxyCodeLine{01461             \}}
\DoxyCodeLine{01462 \#endif}
\DoxyCodeLine{01463 \#if SIRONO\_POROSITY}
\DoxyCodeLine{01464             fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.rho\_0prime[i]);}
\DoxyCodeLine{01465             fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.rho\_c\_plus[i]);}
\DoxyCodeLine{01466             fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.rho\_c\_minus[i]);}
\DoxyCodeLine{01467             fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.compressive\_strength[i]);}
\DoxyCodeLine{01468             fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.tensile\_strength[i]);}
\DoxyCodeLine{01469             fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.K[i]);}
\DoxyCodeLine{01470             fprintf(file.data, "{}\%.d\(\backslash\)t"{}, p\_host.flag\_rho\_0prime[i]);}
\DoxyCodeLine{01471             fprintf(file.data, "{}\%.d\(\backslash\)t"{}, p\_host.flag\_plastic[i]);}
\DoxyCodeLine{01472             fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.shear\_strength[i]);}
\DoxyCodeLine{01473 \#endif}
\DoxyCodeLine{01474 \#if PALPHA\_POROSITY}
\DoxyCodeLine{01475             fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.alpha\_jutzi[i]);}
\DoxyCodeLine{01476             fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.p[i]);}
\DoxyCodeLine{01477 \#endif}
\DoxyCodeLine{01478 \#if EPSALPHA\_POROSITY}
\DoxyCodeLine{01479             fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.alpha\_epspor[i]);}
\DoxyCodeLine{01480             fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.epsilon\_v[i]);}
\DoxyCodeLine{01481 \#endif}
\DoxyCodeLine{01482 \#if FRAGMENTATION}
\DoxyCodeLine{01483             for (d = 0; d < p\_host.numFlaws[i]; d++) \{}
\DoxyCodeLine{01484                 fprintf(file.data, "{}\%.6le\(\backslash\)t"{}, p\_host.flaws[i*maxNumFlaws\_host+d]);}
\DoxyCodeLine{01485             \}}
\DoxyCodeLine{01486 \#endif}
\DoxyCodeLine{01487             fprintf(file.data, "{}\(\backslash\)n"{});}
\DoxyCodeLine{01488         \}}
\DoxyCodeLine{01489         fclose(file.data);}
\DoxyCodeLine{01490         if (param.verbose) \{}
\DoxyCodeLine{01491             printf("{}wrote to \%s.\(\backslash\)n"{}, file.name);}
\DoxyCodeLine{01492         \}}
\DoxyCodeLine{01493     \} /* ascii\_output == TRUE */}
\DoxyCodeLine{01494 }
\DoxyCodeLine{01495 }
\DoxyCodeLine{01496     /* energy and momentum */}
\DoxyCodeLine{01497     totalL = 0;}
\DoxyCodeLine{01498     for (d = 0; d < DIM; d++) \{}
\DoxyCodeLine{01499         totalangularmomentum[d] = 0.0;}
\DoxyCodeLine{01500     \}}
\DoxyCodeLine{01501     for (i = 0; i < numberOfParticles; i++) \{}
\DoxyCodeLine{01502         v = 0;}
\DoxyCodeLine{01503         v = p\_host.vx[i] * p\_host.vx[i];}
\DoxyCodeLine{01504         totalpx += p\_host.vx[i] * p\_host.m[i];}
\DoxyCodeLine{01505 \#if DIM > 1}
\DoxyCodeLine{01506         v += p\_host.vy[i] * p\_host.vy[i];}
\DoxyCodeLine{01507         totalpy += p\_host.vy[i] * p\_host.m[i];}
\DoxyCodeLine{01508 \#if DIM == 3}
\DoxyCodeLine{01509         v += p\_host.vz[i] * p\_host.vz[i];}
\DoxyCodeLine{01510         totalpz += p\_host.vz[i] * p\_host.m[i];}
\DoxyCodeLine{01511 \#endif}
\DoxyCodeLine{01512 \#endif}
\DoxyCodeLine{01513         totalmass += p\_host.m[i];}
\DoxyCodeLine{01514         totalkineticenergy += p\_host.m[i] * v;}
\DoxyCodeLine{01515 \#if INTEGRATE\_ENERGY}
\DoxyCodeLine{01516         totalinnerenergy += p\_host.m[i] * p\_host.e[i];}
\DoxyCodeLine{01517 \#endif}
\DoxyCodeLine{01518 }
\DoxyCodeLine{01519 \#if DIM == 2}
\DoxyCodeLine{01520         totalangularmomentum[0] += p\_host.m[i] * (p\_host.x[i]*p\_host.vy[i] -\/ p\_host.y[i]*p\_host.vx[i]);}
\DoxyCodeLine{01521 \#elif DIM > 2}
\DoxyCodeLine{01522         totalangularmomentum[0] += p\_host.m[i] * (p\_host.y[i]*p\_host.vz[i] -\/ p\_host.z[i]*p\_host.vy[i]);}
\DoxyCodeLine{01523         totalangularmomentum[1] += p\_host.m[i] * (p\_host.z[i]*p\_host.vx[i] -\/ p\_host.x[i]*p\_host.vz[i]);}
\DoxyCodeLine{01524         totalangularmomentum[2] += p\_host.m[i] * (p\_host.x[i]*p\_host.vy[i] -\/ p\_host.y[i]*p\_host.vx[i]);}
\DoxyCodeLine{01525 \#endif}
\DoxyCodeLine{01526 }
\DoxyCodeLine{01527     \}}
\DoxyCodeLine{01528 }
\DoxyCodeLine{01529 }
\DoxyCodeLine{01530     totalkineticenergy *= 0.5;}
\DoxyCodeLine{01531     totalp = totalpx*totalpx;}
\DoxyCodeLine{01532 \#if DIM > 1}
\DoxyCodeLine{01533     totalp += totalpy*totalpy;}
\DoxyCodeLine{01534 \#if DIM == 3}
\DoxyCodeLine{01535     totalp += totalpz*totalpz;}
\DoxyCodeLine{01536 \#endif}
\DoxyCodeLine{01537 \#endif}
\DoxyCodeLine{01538     totalp = sqrt(totalp);}
\DoxyCodeLine{01539 }
\DoxyCodeLine{01540 \#if GRAVITATING\_POINT\_MASSES}
\DoxyCodeLine{01541     // write mass file}
\DoxyCodeLine{01542     /* write info file name */}
\DoxyCodeLine{01543     if (param.verbose) \{}
\DoxyCodeLine{01544         printf("{}writing info file \%s.mass.\(\backslash\)n"{}, file.name);}
\DoxyCodeLine{01545     \}}
\DoxyCodeLine{01546     if ((massfile = fopen(massfilename, "{}w"{})) == NULL) \{}
\DoxyCodeLine{01547         fprintf(stderr, "{}Eih? Cannot write to \%s.\(\backslash\)n"{}, massfilename);}
\DoxyCodeLine{01548         exit(1);}
\DoxyCodeLine{01549     \}}
\DoxyCodeLine{01550 }
\DoxyCodeLine{01551     for (i = 0; i < numberOfPointmasses; i++)\{}
\DoxyCodeLine{01552         fprintf(massfile, "{}\%+.15le\(\backslash\)t"{}, pointmass\_host.x[i]);}
\DoxyCodeLine{01553 \#if DIM > 1}
\DoxyCodeLine{01554         fprintf(massfile, "{}\%+.15le\(\backslash\)t"{}, pointmass\_host.y[i]);}
\DoxyCodeLine{01555 \#if DIM == 3}
\DoxyCodeLine{01556         fprintf(massfile, "{}\%+.15le\(\backslash\)t"{}, pointmass\_host.z[i]);}
\DoxyCodeLine{01557 \#endif}
\DoxyCodeLine{01558 \#endif}
\DoxyCodeLine{01559         fprintf(massfile, "{}\%+.15le\(\backslash\)t"{}, pointmass\_host.vx[i]);}
\DoxyCodeLine{01560 \#if DIM > 1}
\DoxyCodeLine{01561         fprintf(massfile, "{}\%+.15le\(\backslash\)t"{}, pointmass\_host.vy[i]);}
\DoxyCodeLine{01562 \#if DIM == 3}
\DoxyCodeLine{01563         fprintf(massfile, "{}\%+.15le\(\backslash\)t"{}, pointmass\_host.vz[i]);}
\DoxyCodeLine{01564 \#endif}
\DoxyCodeLine{01565 \#endif}
\DoxyCodeLine{01566         fprintf(massfile, "{}\%e\(\backslash\)t"{}, pointmass\_host.m[i]);}
\DoxyCodeLine{01567         fprintf(massfile, "{}\%e\(\backslash\)t"{}, pointmass\_host.rmin[i]);}
\DoxyCodeLine{01568         fprintf(massfile, "{}\%e"{}, pointmass\_host.rmax[i]);}
\DoxyCodeLine{01569         fprintf(massfile, "{}\(\backslash\)n"{});}
\DoxyCodeLine{01570     \}}
\DoxyCodeLine{01571 }
\DoxyCodeLine{01572     fclose(massfile);}
\DoxyCodeLine{01573 \#endif // GRAVITATING\_POINT\_MASSES}
\DoxyCodeLine{01574     /* write info file name */}
\DoxyCodeLine{01575     if (param.verbose) \{}
\DoxyCodeLine{01576         printf("{}writing info file \%s.info.\(\backslash\)n"{}, file.name);}
\DoxyCodeLine{01577     \}}
\DoxyCodeLine{01578 }
\DoxyCodeLine{01579     if ((infofile = fopen(infofilename, "{}w"{})) == NULL) \{}
\DoxyCodeLine{01580         fprintf(stderr, "{}Eih? Cannot write to \%s.\(\backslash\)n"{}, infofilename);}
\DoxyCodeLine{01581         exit(1);}
\DoxyCodeLine{01582     \}}
\DoxyCodeLine{01583 }
\DoxyCodeLine{01584     fprintf(infofile, "{}Information about particle data of file \%s\(\backslash\)n"{}, file.name);}
\DoxyCodeLine{01585     fprintf(infofile, "{}Time: \(\backslash\)t \%.20e\(\backslash\)n"{}, h5time);}
\DoxyCodeLine{01586     fprintf(infofile, "{}Number of particles: \(\backslash\)t \%d\(\backslash\)n"{}, numberOfParticles);}
\DoxyCodeLine{01587     fprintf(infofile, "{}Total mass: \(\backslash\)t \%.20e\(\backslash\)n"{}, totalmass);}
\DoxyCodeLine{01588     fprintf(infofile, "{}Total kinetic energy: \(\backslash\)t \%.20e\(\backslash\)n"{}, totalkineticenergy);}
\DoxyCodeLine{01589     fprintf(infofile, "{}Total internal energy: \(\backslash\)t \%.20e\(\backslash\)n"{}, totalinnerenergy);}
\DoxyCodeLine{01590     fprintf(infofile, "{}Total momentum: \(\backslash\)t \%.20e\(\backslash\)n"{}, totalp);}
\DoxyCodeLine{01591     fprintf(infofile, "{}Total momentum in each direction: \(\backslash\)t \%.20e "{}, totalpx);}
\DoxyCodeLine{01592 \#if DIM > 1}
\DoxyCodeLine{01593     fprintf(infofile, "{}  \%.20e "{}, totalpy);}
\DoxyCodeLine{01594 \#if DIM == 3}
\DoxyCodeLine{01595     fprintf(infofile, "{}  \%.20e "{}, totalpz);}
\DoxyCodeLine{01596 \#endif}
\DoxyCodeLine{01597 \#endif}
\DoxyCodeLine{01598     fprintf(infofile, "{}\(\backslash\)n"{});}
\DoxyCodeLine{01599     fprintf(infofile, "{}Total angular momentum:   "{});}
\DoxyCodeLine{01600     for (d = 0; d < DIM; d++) \{}
\DoxyCodeLine{01601         fprintf(infofile, "{}L[\%d] = \%.20e \(\backslash\)t"{}, d, totalangularmomentum[d]);}
\DoxyCodeLine{01602         totalL += totalangularmomentum[d]*totalangularmomentum[d];}
\DoxyCodeLine{01603     \}}
\DoxyCodeLine{01604     fprintf(infofile, "{}\(\backslash\)n"{});}
\DoxyCodeLine{01605     totalL = sqrt(totalL);}
\DoxyCodeLine{01606     fprintf(infofile, "{}Total angular momentum: norm(L) = \%.20e\(\backslash\)n"{}, totalL);}
\DoxyCodeLine{01607 }
\DoxyCodeLine{01608     fprintf(infofile, "{}\(\backslash\)n"{});}
\DoxyCodeLine{01609     fclose(infofile);}
\DoxyCodeLine{01610 }
\DoxyCodeLine{01611 \#if HDF5IO}
\DoxyCodeLine{01612     if (param.hdf5output) \{}
\DoxyCodeLine{01613         if (param.verbose) \{}
\DoxyCodeLine{01614             printf("{}writing to \%s.h5.\(\backslash\)n"{}, file.name);}
\DoxyCodeLine{01615         \}}
\DoxyCodeLine{01616         file\_id = H5Fcreate(h5filename, H5F\_ACC\_TRUNC, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01617         /* the positions */}
\DoxyCodeLine{01618         dims[0] = numberOfParticles;}
\DoxyCodeLine{01619         dims[1] = DIM;}
\DoxyCodeLine{01620         dataspace\_id =  H5Screate\_simple(2, dims, NULL);}
\DoxyCodeLine{01621         x\_id = H5Dcreate2(file\_id, "{}/x"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01622                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01623 }
\DoxyCodeLine{01624         v\_id = H5Dcreate2(file\_id, "{}/v"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01625                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01626 }
\DoxyCodeLine{01627         a\_id = H5Dcreate2(file\_id, "{}/a"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01628                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01629 }
\DoxyCodeLine{01630         g\_a\_id = H5Dcreate2(file\_id, "{}/a\_grav"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01631                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01632 }
\DoxyCodeLine{01633 }
\DoxyCodeLine{01634         x = (double *) malloc(sizeof(double) * numberOfParticles * DIM);}
\DoxyCodeLine{01635         for (i = 0, e = 0; i < numberOfParticles; i++, e += DIM) \{}
\DoxyCodeLine{01636             x[e] = p\_host.x[i];}
\DoxyCodeLine{01637 \#if DIM > 1}
\DoxyCodeLine{01638             x[e+1] = p\_host.y[i];}
\DoxyCodeLine{01639 \#if DIM == 3}
\DoxyCodeLine{01640             x[e+2] = p\_host.z[i];}
\DoxyCodeLine{01641 \#endif}
\DoxyCodeLine{01642 \#endif}
\DoxyCodeLine{01643         \}}
\DoxyCodeLine{01644 }
\DoxyCodeLine{01645         status = H5Dwrite(x\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01646         status = H5Dclose(x\_id);}
\DoxyCodeLine{01647 }
\DoxyCodeLine{01648         /* the velocities */}
\DoxyCodeLine{01649         for (i = 0, e = 0; i < numberOfParticles; i++, e += DIM) \{}
\DoxyCodeLine{01650             x[e] = p\_host.vx[i];}
\DoxyCodeLine{01651 \#if DIM > 1}
\DoxyCodeLine{01652             x[e+1] = p\_host.vy[i];}
\DoxyCodeLine{01653 \#if DIM == 3}
\DoxyCodeLine{01654             x[e+2] = p\_host.vz[i];}
\DoxyCodeLine{01655 \#endif}
\DoxyCodeLine{01656 \#endif}
\DoxyCodeLine{01657         \}}
\DoxyCodeLine{01658 }
\DoxyCodeLine{01659         status = H5Dwrite(v\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01660         status = H5Dclose(v\_id);}
\DoxyCodeLine{01661 }
\DoxyCodeLine{01662 }
\DoxyCodeLine{01663         /* the accelerations */}
\DoxyCodeLine{01664         for (i = 0, e = 0; i < numberOfParticles; i++, e += DIM) \{}
\DoxyCodeLine{01665             x[e] = p\_host.ax[i];}
\DoxyCodeLine{01666 \#if DIM > 1}
\DoxyCodeLine{01667             x[e+1] = p\_host.ay[i];}
\DoxyCodeLine{01668 \#if DIM == 3}
\DoxyCodeLine{01669             x[e+2] = p\_host.az[i];}
\DoxyCodeLine{01670 \#endif}
\DoxyCodeLine{01671 \#endif}
\DoxyCodeLine{01672         \}}
\DoxyCodeLine{01673         status = H5Dwrite(a\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01674         status = H5Dclose(a\_id);}
\DoxyCodeLine{01675 }
\DoxyCodeLine{01676 }
\DoxyCodeLine{01677         /* the accelerations due to gravity */}
\DoxyCodeLine{01678         for (i = 0, e = 0; i < numberOfParticles; i++, e += DIM) \{}
\DoxyCodeLine{01679             x[e] = p\_host.g\_ax[i];}
\DoxyCodeLine{01680 \#if DIM > 1}
\DoxyCodeLine{01681             x[e+1] = p\_host.g\_ay[i];}
\DoxyCodeLine{01682 \#if DIM == 3}
\DoxyCodeLine{01683             x[e+2] = p\_host.g\_az[i];}
\DoxyCodeLine{01684 \#endif}
\DoxyCodeLine{01685 \#endif}
\DoxyCodeLine{01686         \}}
\DoxyCodeLine{01687         status = H5Dwrite(g\_a\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01688         status = H5Dclose(g\_a\_id);}
\DoxyCodeLine{01689 }
\DoxyCodeLine{01690         free(x);}
\DoxyCodeLine{01691         x = (double *)  malloc(sizeof(double) * numberOfParticles);}
\DoxyCodeLine{01692 }
\DoxyCodeLine{01693         /* time */}
\DoxyCodeLine{01694         dims[0] = 1;}
\DoxyCodeLine{01695         dataspace\_id = H5Screate\_simple(1, dims, NULL);}
\DoxyCodeLine{01696         time\_id = H5Dcreate2(file\_id, "{}/time"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01697                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01698         status = H5Dwrite(time\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, \&h5time);}
\DoxyCodeLine{01699         status = H5Dclose(time\_id);}
\DoxyCodeLine{01700 }
\DoxyCodeLine{01701         /* mass */}
\DoxyCodeLine{01702         dims[0] = numberOfParticles;}
\DoxyCodeLine{01703         dims[1] = 1;}
\DoxyCodeLine{01704         dataspace\_id = H5Screate\_simple(1, dims, NULL);}
\DoxyCodeLine{01705         m\_id = H5Dcreate2(file\_id, "{}/m"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01706                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01707 }
\DoxyCodeLine{01708         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01709             x[i] = p\_host.m[i];}
\DoxyCodeLine{01710 }
\DoxyCodeLine{01711         status = H5Dwrite(m\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01712         status = H5Dclose(m\_id);}
\DoxyCodeLine{01713 }
\DoxyCodeLine{01714         /* density */}
\DoxyCodeLine{01715         rho\_id = H5Dcreate2(file\_id, "{}/rho"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01716                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01717         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01718             x[i] = p\_host.rho[i];}
\DoxyCodeLine{01719 }
\DoxyCodeLine{01720         status = H5Dwrite(rho\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01721         status = H5Dclose(rho\_id);}
\DoxyCodeLine{01722 }
\DoxyCodeLine{01723         /* energy */}
\DoxyCodeLine{01724         e\_id = H5Dcreate2(file\_id, "{}/e"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01725                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01726         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01727             x[i] = p\_host.e[i];}
\DoxyCodeLine{01728 }
\DoxyCodeLine{01729         status = H5Dwrite(e\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01730         status = H5Dclose(e\_id);}
\DoxyCodeLine{01731 }
\DoxyCodeLine{01732 \#if MORE\_ANEOS\_OUTPUT}
\DoxyCodeLine{01733         // compute ANEOS quantities}
\DoxyCodeLine{01734         int aneos\_i\_rho, aneos\_i\_e;}
\DoxyCodeLine{01735         double *x\_aneos\_T = (double *)malloc(numberOfParticles*sizeof(double));}
\DoxyCodeLine{01736         double *x\_aneos\_cs = (double *)malloc(numberOfParticles*sizeof(double));}
\DoxyCodeLine{01737         double *x\_aneos\_entropy = (double *)malloc(numberOfParticles*sizeof(double));}
\DoxyCodeLine{01738         int *x\_aneos\_phase\_flag = (int *)malloc(numberOfParticles*sizeof(int));}
\DoxyCodeLine{01739         for(i=0; i<numberOfParticles; i++) \{}
\DoxyCodeLine{01740             j = p\_host.materialId[i];}
\DoxyCodeLine{01741             if( g\_eos\_is\_aneos[j] == TRUE ) \{}
\DoxyCodeLine{01742                 aneos\_i\_rho = array\_index\_host(p\_host.rho[i], g\_aneos\_rho[j], g\_aneos\_n\_rho[j]);}
\DoxyCodeLine{01743                 aneos\_i\_e = array\_index\_host(p\_host.e[i], g\_aneos\_e[j], g\_aneos\_n\_e[j]);}
\DoxyCodeLine{01744                 x\_aneos\_T[i] = bilinear\_interpolation\_from\_matrix(p\_host.rho[i], p\_host.e[i], g\_aneos\_T[j], g\_aneos\_rho[j], g\_aneos\_e[j], aneos\_i\_rho, aneos\_i\_e, g\_aneos\_n\_rho[j], g\_aneos\_n\_e[j]);}
\DoxyCodeLine{01745                 x\_aneos\_cs[i] = bilinear\_interpolation\_from\_matrix(p\_host.rho[i], p\_host.e[i], g\_aneos\_cs[j], g\_aneos\_rho[j], g\_aneos\_e[j], aneos\_i\_rho, aneos\_i\_e, g\_aneos\_n\_rho[j], g\_aneos\_n\_e[j]);}
\DoxyCodeLine{01746                 x\_aneos\_entropy[i] = bilinear\_interpolation\_from\_matrix(p\_host.rho[i], p\_host.e[i], g\_aneos\_entropy[j], g\_aneos\_rho[j], g\_aneos\_e[j], aneos\_i\_rho, aneos\_i\_e, g\_aneos\_n\_rho[j], g\_aneos\_n\_e[j]);}
\DoxyCodeLine{01747                 x\_aneos\_phase\_flag[i] = discrete\_value\_table\_lookup\_from\_matrix(p\_host.rho[i], p\_host.e[i], g\_aneos\_phase\_flag[j], g\_aneos\_rho[j], g\_aneos\_e[j], aneos\_i\_rho, aneos\_i\_e, g\_aneos\_n\_rho[j], g\_aneos\_n\_e[j]);}
\DoxyCodeLine{01748             \}}
\DoxyCodeLine{01749             else \{}
\DoxyCodeLine{01750                 x\_aneos\_T[i] = -\/1.0;}
\DoxyCodeLine{01751                 x\_aneos\_cs[i] = -\/1.0;}
\DoxyCodeLine{01752                 x\_aneos\_entropy[i] = -\/1.0;}
\DoxyCodeLine{01753                 x\_aneos\_phase\_flag[i] = -\/1;}
\DoxyCodeLine{01754             \}}
\DoxyCodeLine{01755         \}}
\DoxyCodeLine{01756 }
\DoxyCodeLine{01757         // write them to the output file}
\DoxyCodeLine{01758         aneos\_T\_id = H5Dcreate2(file\_id, "{}/aneos\_T"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01759                     H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01760         status = H5Dwrite(aneos\_T\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x\_aneos\_T);}
\DoxyCodeLine{01761         status = H5Dclose(aneos\_T\_id);}
\DoxyCodeLine{01762         aneos\_cs\_id = H5Dcreate2(file\_id, "{}/aneos\_cs"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01763                     H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01764         status = H5Dwrite(aneos\_cs\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x\_aneos\_cs);}
\DoxyCodeLine{01765         status = H5Dclose(aneos\_cs\_id);}
\DoxyCodeLine{01766         aneos\_entropy\_id = H5Dcreate2(file\_id, "{}/aneos\_entropy"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01767                     H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01768         status = H5Dwrite(aneos\_entropy\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x\_aneos\_entropy);}
\DoxyCodeLine{01769         status = H5Dclose(aneos\_entropy\_id);}
\DoxyCodeLine{01770         aneos\_phase\_flag\_id = H5Dcreate2(file\_id, "{}/aneos\_phase\_flag"{}, H5T\_NATIVE\_INT, dataspace\_id,}
\DoxyCodeLine{01771                     H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01772         status = H5Dwrite(aneos\_phase\_flag\_id, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x\_aneos\_phase\_flag);}
\DoxyCodeLine{01773         status = H5Dclose(aneos\_phase\_flag\_id);}
\DoxyCodeLine{01774 }
\DoxyCodeLine{01775         // free memory}
\DoxyCodeLine{01776         free(x\_aneos\_T);}
\DoxyCodeLine{01777         free(x\_aneos\_cs);}
\DoxyCodeLine{01778         free(x\_aneos\_entropy);}
\DoxyCodeLine{01779         free(x\_aneos\_phase\_flag);}
\DoxyCodeLine{01780 \#endif}
\DoxyCodeLine{01781 }
\DoxyCodeLine{01782         /* sml */}
\DoxyCodeLine{01783         sml\_id = H5Dcreate2(file\_id, "{}/sml"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01784                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01785         for (i = 0; i < numberOfParticles; i++) \{}
\DoxyCodeLine{01786 \#if (VARIABLE\_SML || INTEGRATE\_SML || DEAL\_WITH\_TOO\_MANY\_INTERACTIONS || READ\_INITIAL\_SML\_FROM\_PARTICLE\_FILE)}
\DoxyCodeLine{01787             x[i] = p\_host.h[i];}
\DoxyCodeLine{01788 \#else}
\DoxyCodeLine{01789             x[i] = sml[p\_host.materialId[i]];}
\DoxyCodeLine{01790 \#endif}
\DoxyCodeLine{01791         \}}
\DoxyCodeLine{01792 }
\DoxyCodeLine{01793         status = H5Dwrite(sml\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01794         status = H5Dclose(sml\_id);}
\DoxyCodeLine{01795 }
\DoxyCodeLine{01796 }
\DoxyCodeLine{01797 \#if JC\_PLASTICITY}
\DoxyCodeLine{01798         /* plastic strain */}
\DoxyCodeLine{01799         ep\_id = H5Dcreate2(file\_id, "{}/ep"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01800                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01801         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01802             x[i] = p\_host.ep[i];}
\DoxyCodeLine{01803 }
\DoxyCodeLine{01804         status = H5Dwrite(ep\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01805         status = H5Dclose(ep\_id);}
\DoxyCodeLine{01806 }
\DoxyCodeLine{01807         /* temperature */}
\DoxyCodeLine{01808         T\_id = H5Dcreate2(file\_id, "{}/T"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01809                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01810         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01811             x[i] = p\_host.T[i];}
\DoxyCodeLine{01812 }
\DoxyCodeLine{01813         status = H5Dwrite(T\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01814         status = H5Dclose(T\_id);}
\DoxyCodeLine{01815 \#endif}
\DoxyCodeLine{01816 }
\DoxyCodeLine{01817 }
\DoxyCodeLine{01818 }
\DoxyCodeLine{01819         /* number of interactions */}
\DoxyCodeLine{01820         ix = (int *) malloc(sizeof(int) * numberOfParticles);}
\DoxyCodeLine{01821 }
\DoxyCodeLine{01822         noi\_id = H5Dcreate2(file\_id, "{}/number\_of\_interactions"{}, H5T\_NATIVE\_INT, dataspace\_id,}
\DoxyCodeLine{01823                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01824 }
\DoxyCodeLine{01825         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01826             ix[i] = p\_host.noi[i];}
\DoxyCodeLine{01827 }
\DoxyCodeLine{01828         status = H5Dwrite(noi\_id, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, ix);}
\DoxyCodeLine{01829         status = H5Dclose(noi\_id);}
\DoxyCodeLine{01830 }
\DoxyCodeLine{01831         /* material type */}
\DoxyCodeLine{01832         mtype\_id = H5Dcreate2(file\_id, "{}/material\_type"{}, H5T\_NATIVE\_INT, dataspace\_id,}
\DoxyCodeLine{01833                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01834 }
\DoxyCodeLine{01835         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01836             ix[i] = p\_host.materialId[i];}
\DoxyCodeLine{01837 }
\DoxyCodeLine{01838         status = H5Dwrite(mtype\_id, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, ix);}
\DoxyCodeLine{01839         status = H5Dclose(mtype\_id);}
\DoxyCodeLine{01840 }
\DoxyCodeLine{01841 }
\DoxyCodeLine{01842         /* pressure */}
\DoxyCodeLine{01843         p\_id = H5Dcreate2(file\_id, "{}/p"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01844                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01845         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01846             x[i] = p\_host.p[i];}
\DoxyCodeLine{01847 }
\DoxyCodeLine{01848         status = H5Dwrite(p\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01849         status = H5Dclose(p\_id);}
\DoxyCodeLine{01850 }
\DoxyCodeLine{01851 }
\DoxyCodeLine{01852 \#if PALPHA\_POROSITY}
\DoxyCodeLine{01853         /* alpha\_jutzi */}
\DoxyCodeLine{01854         alpha\_id = H5Dcreate2(file\_id, "{}/alpha\_jutzi"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01855                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01856         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01857             x[i] = p\_host.alpha\_jutzi[i];}
\DoxyCodeLine{01858 }
\DoxyCodeLine{01859         status = H5Dwrite(alpha\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01860         status = H5Dclose(alpha\_id);}
\DoxyCodeLine{01861 }
\DoxyCodeLine{01862 \#endif}
\DoxyCodeLine{01863         /* soundspeed */}
\DoxyCodeLine{01864         cs\_id = H5Dcreate2(file\_id, "{}/soundspeed"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01865                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01866         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01867             x[i] = p\_host.cs[i];}
\DoxyCodeLine{01868 }
\DoxyCodeLine{01869         status = H5Dwrite(cs\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01870         status = H5Dclose(cs\_id);}
\DoxyCodeLine{01871 }
\DoxyCodeLine{01872 \#if SIRONO\_POROSITY}
\DoxyCodeLine{01873         /* compressive strength */}
\DoxyCodeLine{01874         compressive\_strength\_id = H5Dcreate2(file\_id, "{}/compressive\_strength"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01875                                     H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01876         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01877             x[i] = p\_host.compressive\_strength[i];}
\DoxyCodeLine{01878 }
\DoxyCodeLine{01879         status = H5Dwrite(compressive\_strength\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01880         status = H5Dclose(compressive\_strength\_id);}
\DoxyCodeLine{01881 }
\DoxyCodeLine{01882         /* tensile strength */}
\DoxyCodeLine{01883         tensile\_strength\_id = H5Dcreate2(file\_id, "{}/tensile\_strength"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01884                                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01885         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01886             x[i] = p\_host.tensile\_strength[i];}
\DoxyCodeLine{01887 }
\DoxyCodeLine{01888         status = H5Dwrite(tensile\_strength\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01889         status = H5Dclose(tensile\_strength\_id);}
\DoxyCodeLine{01890 }
\DoxyCodeLine{01891         /* bulk modulus */}
\DoxyCodeLine{01892         K\_id = H5Dcreate2(file\_id, "{}/K"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01893                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01894         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01895             x[i] = p\_host.K[i];}
\DoxyCodeLine{01896 }
\DoxyCodeLine{01897         status = H5Dwrite(K\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01898         status = H5Dclose(K\_id);}
\DoxyCodeLine{01899 }
\DoxyCodeLine{01900         /* density\_0prime */}
\DoxyCodeLine{01901         rho\_0prime\_id = H5Dcreate2(file\_id, "{}/rho\_0prime"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01902                             H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01903         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01904             x[i] = p\_host.rho\_0prime[i];}
\DoxyCodeLine{01905 }
\DoxyCodeLine{01906         status = H5Dwrite(rho\_0prime\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01907         status = H5Dclose(rho\_0prime\_id);}
\DoxyCodeLine{01908 }
\DoxyCodeLine{01909         /* density\_c\_plus */}
\DoxyCodeLine{01910         rho\_c\_plus\_id = H5Dcreate2(file\_id, "{}/rho\_c\_plus"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01911                             H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01912         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01913             x[i] = p\_host.rho\_c\_plus[i];}
\DoxyCodeLine{01914 }
\DoxyCodeLine{01915         status = H5Dwrite(rho\_c\_plus\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01916         status = H5Dclose(rho\_c\_plus\_id);}
\DoxyCodeLine{01917 }
\DoxyCodeLine{01918         /* density\_c\_minus */}
\DoxyCodeLine{01919         rho\_c\_minus\_id = H5Dcreate2(file\_id, "{}rho\_c\_minus"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01920                             H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01921         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01922             x[i] = p\_host.rho\_c\_minus[i];}
\DoxyCodeLine{01923 }
\DoxyCodeLine{01924         status = H5Dwrite(rho\_c\_minus\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01925         status = H5Dclose(rho\_c\_minus\_id);}
\DoxyCodeLine{01926 }
\DoxyCodeLine{01927         /* flag\_rho0\_prime */}
\DoxyCodeLine{01928         flag\_rho\_0prime\_id = H5Dcreate2(file\_id, "{}/flag\_rho\_0prime"{}, H5T\_NATIVE\_INT, dataspace\_id,}
\DoxyCodeLine{01929                             H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01930         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01931             ix[i] = p\_host.flag\_rho\_0prime[i];}
\DoxyCodeLine{01932 }
\DoxyCodeLine{01933         status = H5Dwrite(flag\_rho\_0prime\_id, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, ix);}
\DoxyCodeLine{01934         status = H5Dclose(flag\_rho\_0prime\_id);}
\DoxyCodeLine{01935 }
\DoxyCodeLine{01936         /* flag\_plastic */}
\DoxyCodeLine{01937         flag\_plastic\_id = H5Dcreate2(file\_id, "{}/flag\_plastic"{}, H5T\_NATIVE\_INT, dataspace\_id,}
\DoxyCodeLine{01938                             H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01939         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01940             ix[i] = p\_host.flag\_plastic[i];}
\DoxyCodeLine{01941 }
\DoxyCodeLine{01942         status = H5Dwrite(flag\_plastic\_id, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, ix);}
\DoxyCodeLine{01943         status = H5Dclose(flag\_plastic\_id);}
\DoxyCodeLine{01944 }
\DoxyCodeLine{01945         /* shear\_strength */}
\DoxyCodeLine{01946         shear\_strength\_id = H5Dcreate2(file\_id, "{}shear\_strength"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01947                             H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01948         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01949             x[i] = p\_host.shear\_strength[i];}
\DoxyCodeLine{01950 }
\DoxyCodeLine{01951         status = H5Dwrite(shear\_strength\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01952         status = H5Dclose(shear\_strength\_id);}
\DoxyCodeLine{01953 \#endif}
\DoxyCodeLine{01954 }
\DoxyCodeLine{01955 \#if EPSALPHA\_POROSITY}
\DoxyCodeLine{01956         /* alpha\_epspor */}
\DoxyCodeLine{01957         alpha\_epspor\_id = H5Dcreate2(file\_id, "{}/alpha\_epspor"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01958                             H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01959         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01960             x[i] = p\_host.alpha\_epspor[i];}
\DoxyCodeLine{01961 }
\DoxyCodeLine{01962         status = H5Dwrite(alpha\_epspor\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01963         status = H5Dclose(alpha\_epspor\_id);}
\DoxyCodeLine{01964 }
\DoxyCodeLine{01965         /* epsilon\_v */}
\DoxyCodeLine{01966         epsilon\_v\_id = H5Dcreate2(file\_id, "{}/epsilon\_v"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01967                             H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01968         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01969             x[i] = p\_host.epsilon\_v[i];}
\DoxyCodeLine{01970 }
\DoxyCodeLine{01971         status = H5Dwrite(epsilon\_v\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01972         status = H5Dclose(epsilon\_v\_id);}
\DoxyCodeLine{01973 \#endif}
\DoxyCodeLine{01974 }
\DoxyCodeLine{01975 \#if FRAGMENTATION}
\DoxyCodeLine{01976         /* number of activated flaws */}
\DoxyCodeLine{01977         noaf\_id = H5Dcreate2(file\_id, "{}/number\_of\_activated\_flaws"{}, H5T\_NATIVE\_INT, dataspace\_id,}
\DoxyCodeLine{01978                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01979 }
\DoxyCodeLine{01980         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01981             ix[i] = p\_host.numActiveFlaws[i];}
\DoxyCodeLine{01982 }
\DoxyCodeLine{01983         status = H5Dwrite(noaf\_id, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, ix);}
\DoxyCodeLine{01984         status = H5Dclose(noaf\_id);}
\DoxyCodeLine{01985 }
\DoxyCodeLine{01986         /* damage */}
\DoxyCodeLine{01987         damage\_id = H5Dcreate2(file\_id, "{}/DIM\_root\_of\_damage\_tensile"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01988                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01989         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{01990             x[i] = p\_host.d[i];}
\DoxyCodeLine{01991 }
\DoxyCodeLine{01992         status = H5Dwrite(damage\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{01993         status = H5Dclose(damage\_id);}
\DoxyCodeLine{01994 }
\DoxyCodeLine{01995 \#if PALPHA\_POROSITY}
\DoxyCodeLine{01996         /* damage porjutzi */}
\DoxyCodeLine{01997         damage\_porjutzi\_id = H5Dcreate2(file\_id, "{}/DIM\_root\_of\_damage\_porjutzi"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{01998                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{01999         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{02000             x[i] = p\_host.damage\_porjutzi[i];}
\DoxyCodeLine{02001 }
\DoxyCodeLine{02002         status = H5Dwrite(damage\_porjutzi\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02003         status = H5Dclose(damage\_porjutzi\_id);}
\DoxyCodeLine{02004 }
\DoxyCodeLine{02005 }
\DoxyCodeLine{02006         /* damage total */}
\DoxyCodeLine{02007         damage\_total\_id = H5Dcreate2(file\_id, "{}/damage\_total"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02008                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02009         for (i = 0; i < numberOfParticles; i++) \{}
\DoxyCodeLine{02010             x[i] = pow(p\_host.damage\_porjutzi[i], DIM) + pow(p\_host.d[i], DIM);}
\DoxyCodeLine{02011             if (x[i] > 1) x[i] = 1;}
\DoxyCodeLine{02012         \}}
\DoxyCodeLine{02013 }
\DoxyCodeLine{02014         status = H5Dwrite(damage\_total\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02015         status = H5Dclose(damage\_total\_id);}
\DoxyCodeLine{02016 }
\DoxyCodeLine{02017 \#endif}
\DoxyCodeLine{02018 }
\DoxyCodeLine{02019 }
\DoxyCodeLine{02020         /* find maximum number of flaws of all particles */}
\DoxyCodeLine{02021         maxnof = -\/1;}
\DoxyCodeLine{02022         for (i = 0; i < numberOfParticles; i++) \{}
\DoxyCodeLine{02023             if (p\_host.numFlaws[i] > maxnof)}
\DoxyCodeLine{02024                 maxnof = p\_host.numFlaws[i];}
\DoxyCodeLine{02025         \}}
\DoxyCodeLine{02026 }
\DoxyCodeLine{02027         /* write maximum number of flaws */}
\DoxyCodeLine{02028         dims[0] = 1;}
\DoxyCodeLine{02029         dataspace\_id = H5Screate\_simple(1, dims, NULL);}
\DoxyCodeLine{02030         maxnof\_id = H5Dcreate2(file\_id, "{}/maximum\_number\_of\_flaws"{}, H5T\_NATIVE\_INT, dataspace\_id,}
\DoxyCodeLine{02031                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02032         status = H5Dwrite(maxnof\_id, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, \&maxnof);}
\DoxyCodeLine{02033         status = H5Dclose(maxnof\_id);}
\DoxyCodeLine{02034 }
\DoxyCodeLine{02035         /* we will use maxnof for the flaws storage data set */}
\DoxyCodeLine{02036         if (maxnof > 0) \{}
\DoxyCodeLine{02037             dims[0] = numberOfParticles;}
\DoxyCodeLine{02038             dims[1] = maxnof;}
\DoxyCodeLine{02039 }
\DoxyCodeLine{02040             fprintf(stdout, "{}Using \%d doubles for flaws in hdf5 output.\(\backslash\)n"{}, maxnof);}
\DoxyCodeLine{02041             dataspace\_id = H5Screate\_simple(2, dims, NULL);}
\DoxyCodeLine{02042 }
\DoxyCodeLine{02043             activation\_thresholds\_id = H5Dcreate2(file\_id, "{}/activation\_thresholds"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02044                     H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02045             free(x);}
\DoxyCodeLine{02046             x = (double *) malloc(sizeof(double) * numberOfParticles * maxnof);}
\DoxyCodeLine{02047 }
\DoxyCodeLine{02048             for (i = 0; i < numberOfParticles; i++) \{}
\DoxyCodeLine{02049                 for (d = 0; d < p\_host.numFlaws[i]; d++) \{}
\DoxyCodeLine{02050                     x[i*maxnof + d] = p\_host.flaws[i*maxNumFlaws\_host+d];}
\DoxyCodeLine{02051                 \}}
\DoxyCodeLine{02052                 /* fill up with -\/1 */}
\DoxyCodeLine{02053                 for (d = p\_host.numFlaws[i]; d < maxnof; d++)}
\DoxyCodeLine{02054                     x[i*maxnof + d] = -\/1;}
\DoxyCodeLine{02055             \}}
\DoxyCodeLine{02056             status = H5Dwrite(activation\_thresholds\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02057             status = H5Dclose(activation\_thresholds\_id);}
\DoxyCodeLine{02058         \}}
\DoxyCodeLine{02059 \#endif}
\DoxyCodeLine{02060         free(ix);}
\DoxyCodeLine{02061         free(x);}
\DoxyCodeLine{02062 \#if SOLID}
\DoxyCodeLine{02063         /* the deviatoric stress tensor */}
\DoxyCodeLine{02064         x = (double *) malloc(sizeof(double) * numberOfParticles * DIM * DIM);}
\DoxyCodeLine{02065         dims[0] = numberOfParticles;}
\DoxyCodeLine{02066         dims[1] = DIM*DIM;}
\DoxyCodeLine{02067 }
\DoxyCodeLine{02068         dataspace\_id = H5Screate\_simple(2, dims, NULL);}
\DoxyCodeLine{02069         S\_id = H5Dcreate2(file\_id, "{}/deviatoric\_stress"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02070                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02071         for (i = 0; i < numberOfParticles; i++) \{}
\DoxyCodeLine{02072             for (d = 0; d < DIM; d++) \{}
\DoxyCodeLine{02073                 for (e = 0; e < DIM; e++) \{}
\DoxyCodeLine{02074                     x[i*DIM*DIM + d*DIM + e] = p\_host.S[i*DIM*DIM+d*DIM+e];}
\DoxyCodeLine{02075                 \}}
\DoxyCodeLine{02076             \}}
\DoxyCodeLine{02077         \}}
\DoxyCodeLine{02078         status = H5Dwrite(S\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02079         status = H5Dclose(S\_id);}
\DoxyCodeLine{02080         free(x);}
\DoxyCodeLine{02081 \#endif}
\DoxyCodeLine{02082 }
\DoxyCodeLine{02083 \#if NAVIER\_STOKES}
\DoxyCodeLine{02084         /* the deviatoric stress tensor */}
\DoxyCodeLine{02085         x = (double *) malloc(sizeof(double) * numberOfParticles * DIM * DIM);}
\DoxyCodeLine{02086         dims[0] = numberOfParticles;}
\DoxyCodeLine{02087         dims[1] = DIM*DIM;}
\DoxyCodeLine{02088 }
\DoxyCodeLine{02089         dataspace\_id = H5Screate\_simple(2, dims, NULL);}
\DoxyCodeLine{02090         Tshear\_id = H5Dcreate2(file\_id, "{}/viscous\_shear\_stress"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02091                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02092         for (i = 0; i < numberOfParticles; i++) \{}
\DoxyCodeLine{02093             for (d = 0; d < DIM; d++) \{}
\DoxyCodeLine{02094                 for (e = 0; e < DIM; e++) \{}
\DoxyCodeLine{02095                     x[i*DIM*DIM + d*DIM + e] = p\_host.Tshear[i*DIM*DIM+d*DIM+e];}
\DoxyCodeLine{02096                 \}}
\DoxyCodeLine{02097             \}}
\DoxyCodeLine{02098         \}}
\DoxyCodeLine{02099         status = H5Dwrite(Tshear\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02100         status = H5Dclose(Tshear\_id);}
\DoxyCodeLine{02101         free(x);}
\DoxyCodeLine{02102 \#endif}
\DoxyCodeLine{02103 }
\DoxyCodeLine{02104 }
\DoxyCodeLine{02105         /* write even more stuff: drhodt, dedt, dSdt, cs, depth, accels */}
\DoxyCodeLine{02106 }
\DoxyCodeLine{02107 \#if SOLID}
\DoxyCodeLine{02108         /* the change of the deviatoric stress tensor */}
\DoxyCodeLine{02109         x = (double *) malloc(sizeof(double) * numberOfParticles * DIM * DIM);}
\DoxyCodeLine{02110         dims[0] = numberOfParticles;}
\DoxyCodeLine{02111         dims[1] = DIM*DIM;}
\DoxyCodeLine{02112 }
\DoxyCodeLine{02113         dataspace\_id = H5Screate\_simple(2, dims, NULL);}
\DoxyCodeLine{02114         dSdt\_id = H5Dcreate2(file\_id, "{}/ddeviatoric\_stress\_dt"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02115                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02116         for (i = 0; i < numberOfParticles; i++) \{}
\DoxyCodeLine{02117             for (d = 0; d < DIM; d++) \{}
\DoxyCodeLine{02118                 for (e = 0; e < DIM; e++) \{}
\DoxyCodeLine{02119                     x[i*DIM*DIM + d*DIM + e] = p\_host.dSdt[i*DIM*DIM+d*DIM+e];}
\DoxyCodeLine{02120                 \}}
\DoxyCodeLine{02121             \}}
\DoxyCodeLine{02122         \}}
\DoxyCodeLine{02123         status = H5Dwrite(dSdt\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02124         status = H5Dclose(dSdt\_id);}
\DoxyCodeLine{02125         free(x);}
\DoxyCodeLine{02126 \#endif}
\DoxyCodeLine{02127         dims[0] = numberOfParticles;}
\DoxyCodeLine{02128         dims[1] = 1;}
\DoxyCodeLine{02129         dataspace\_id = H5Screate\_simple(1, dims, NULL);}
\DoxyCodeLine{02130         /* depth in tree */}
\DoxyCodeLine{02131         ix = (int *) malloc(sizeof(int) * numberOfParticles);}
\DoxyCodeLine{02132         depth\_id = H5Dcreate2(file\_id, "{}/tree\_depth"{}, H5T\_NATIVE\_INT, dataspace\_id,}
\DoxyCodeLine{02133                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02134 }
\DoxyCodeLine{02135         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{02136             ix[i] = p\_host.depth[i];}
\DoxyCodeLine{02137 }
\DoxyCodeLine{02138         status = H5Dwrite(depth\_id, H5T\_NATIVE\_INT, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, ix);}
\DoxyCodeLine{02139         status = H5Dclose(depth\_id);}
\DoxyCodeLine{02140 }
\DoxyCodeLine{02141 }
\DoxyCodeLine{02142         free(ix);}
\DoxyCodeLine{02143 }
\DoxyCodeLine{02144 \#if INTEGRATE\_DENSITY}
\DoxyCodeLine{02145         /* change of density */}
\DoxyCodeLine{02146         x = (double *) malloc(sizeof(double) * numberOfParticles);}
\DoxyCodeLine{02147         drhodt\_id = H5Dcreate2(file\_id, "{}/drhodt"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02148                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02149         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{02150             x[i] = p\_host.drhodt[i];}
\DoxyCodeLine{02151 }
\DoxyCodeLine{02152         status = H5Dwrite(drhodt\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02153         status = H5Dclose(drhodt\_id);}
\DoxyCodeLine{02154         free(x);}
\DoxyCodeLine{02155 \#endif}
\DoxyCodeLine{02156 \#if SOLID}
\DoxyCodeLine{02157         /* local strain */}
\DoxyCodeLine{02158         x = (double *) malloc(sizeof(double) * numberOfParticles);}
\DoxyCodeLine{02159         local\_strain\_id = H5Dcreate2(file\_id, "{}/local\_strain"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02160                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02161         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{02162             x[i] = p\_host.local\_strain[i];}
\DoxyCodeLine{02163 }
\DoxyCodeLine{02164         status = H5Dwrite(local\_strain\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02165         status = H5Dclose(local\_strain\_id);}
\DoxyCodeLine{02166         free(x);}
\DoxyCodeLine{02167 \#endif}
\DoxyCodeLine{02168 }
\DoxyCodeLine{02169 \#if INTEGRATE\_ENERGY}
\DoxyCodeLine{02170         /* change of energy */}
\DoxyCodeLine{02171         x = (double *) malloc(sizeof(double) * numberOfParticles);}
\DoxyCodeLine{02172         dedt\_id = H5Dcreate2(file\_id, "{}/dedt"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02173                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02174         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{02175             x[i] = p\_host.dedt[i];}
\DoxyCodeLine{02176 }
\DoxyCodeLine{02177         status = H5Dwrite(dedt\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02178         status = H5Dclose(dedt\_id);}
\DoxyCodeLine{02179         free(x);}
\DoxyCodeLine{02180 \#endif}
\DoxyCodeLine{02181 }
\DoxyCodeLine{02182 \#if FRAGMENTATION}
\DoxyCodeLine{02183         /* change of damage */}
\DoxyCodeLine{02184         x = (double *) malloc(sizeof(double) * numberOfParticles);}
\DoxyCodeLine{02185         dddt\_id = H5Dcreate2(file\_id, "{}/dddt"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02186                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02187         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{02188             x[i] = p\_host.dddt[i];}
\DoxyCodeLine{02189 }
\DoxyCodeLine{02190         status = H5Dwrite(dddt\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02191         status = H5Dclose(dddt\_id);}
\DoxyCodeLine{02192         free(x);}
\DoxyCodeLine{02193 \#if PALPHA\_POROSITY}
\DoxyCodeLine{02194         /* change of damage porjutzi */}
\DoxyCodeLine{02195         x = (double *) malloc(sizeof(double) * numberOfParticles);}
\DoxyCodeLine{02196         ddamage\_porjutzidt\_id = H5Dcreate2(file\_id, "{}/ddamage\_porjutzidt"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02197                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02198         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{02199             x[i] = p\_host.ddamage\_porjutzidt[i];}
\DoxyCodeLine{02200 }
\DoxyCodeLine{02201         status = H5Dwrite(ddamage\_porjutzidt\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02202         status = H5Dclose(ddamage\_porjutzidt\_id);}
\DoxyCodeLine{02203         free(x);}
\DoxyCodeLine{02204 \#endif}
\DoxyCodeLine{02205 \#endif}
\DoxyCodeLine{02206 }
\DoxyCodeLine{02207 \#if PALPHA\_POROSITY}
\DoxyCodeLine{02208         /* change of alpha\_jutzi */}
\DoxyCodeLine{02209         x = (double *) malloc(sizeof(double) * numberOfParticles);}
\DoxyCodeLine{02210         dalphadt\_id = H5Dcreate2(file\_id, "{}/dalphadt"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02211                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02212         for (i = 0; i < numberOfParticles; i++)}
\DoxyCodeLine{02213             x[i] = p\_host.dalphadt[i];}
\DoxyCodeLine{02214 }
\DoxyCodeLine{02215         status = H5Dwrite(dalphadt\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02216         status = H5Dclose(dalphadt\_id);}
\DoxyCodeLine{02217         free(x);}
\DoxyCodeLine{02218 \#endif}
\DoxyCodeLine{02219 }
\DoxyCodeLine{02220         status = H5Fclose(file\_id);}
\DoxyCodeLine{02221 }
\DoxyCodeLine{02222 }
\DoxyCodeLine{02223 \#if GRAVITATING\_POINT\_MASSES}
\DoxyCodeLine{02224 }
\DoxyCodeLine{02225         if (param.verbose) \{}
\DoxyCodeLine{02226             printf("{}writing to \%s.mass.h5.\(\backslash\)n"{}, file.name);}
\DoxyCodeLine{02227         \}}
\DoxyCodeLine{02228         file\_id = H5Fcreate(h5massfilename, H5F\_ACC\_TRUNC, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02229         /* the positions */}
\DoxyCodeLine{02230         dims[0] = numberOfPointmasses;}
\DoxyCodeLine{02231         dims[1] = DIM;}
\DoxyCodeLine{02232         dataspace\_id =  H5Screate\_simple(2, dims, NULL);}
\DoxyCodeLine{02233         x\_id = H5Dcreate2(file\_id, "{}/x"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02234                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02235 }
\DoxyCodeLine{02236         v\_id = H5Dcreate2(file\_id, "{}/v"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02237                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02238 }
\DoxyCodeLine{02239         a\_id = H5Dcreate2(file\_id, "{}/a"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02240                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02241 }
\DoxyCodeLine{02242         x = (double *) malloc(sizeof(double) * numberOfPointmasses * DIM);}
\DoxyCodeLine{02243         for (i = 0, e = 0; i < numberOfPointmasses; i++, e += DIM) \{}
\DoxyCodeLine{02244             x[e] = pointmass\_host.x[i];}
\DoxyCodeLine{02245 \#if DIM > 1}
\DoxyCodeLine{02246             x[e+1] = pointmass\_host.y[i];}
\DoxyCodeLine{02247 \#if DIM == 3}
\DoxyCodeLine{02248             x[e+2] = pointmass\_host.z[i];}
\DoxyCodeLine{02249 \#endif}
\DoxyCodeLine{02250 \#endif}
\DoxyCodeLine{02251         \}}
\DoxyCodeLine{02252 }
\DoxyCodeLine{02253         status = H5Dwrite(x\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02254         status = H5Dclose(x\_id);}
\DoxyCodeLine{02255 }
\DoxyCodeLine{02256         /* the velocities */}
\DoxyCodeLine{02257         for (i = 0, e = 0; i < numberOfPointmasses; i++, e += DIM) \{}
\DoxyCodeLine{02258             x[e] = pointmass\_host.vx[i];}
\DoxyCodeLine{02259 \#if DIM > 1}
\DoxyCodeLine{02260             x[e+1] = pointmass\_host.vy[i];}
\DoxyCodeLine{02261 \#if DIM == 3}
\DoxyCodeLine{02262             x[e+2] = pointmass\_host.vz[i];}
\DoxyCodeLine{02263 \#endif}
\DoxyCodeLine{02264 \#endif}
\DoxyCodeLine{02265         \}}
\DoxyCodeLine{02266 }
\DoxyCodeLine{02267         status = H5Dwrite(v\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02268         status = H5Dclose(v\_id);}
\DoxyCodeLine{02269 }
\DoxyCodeLine{02270 }
\DoxyCodeLine{02271         /* the accelerations */}
\DoxyCodeLine{02272         for (i = 0, e = 0; i < numberOfPointmasses; i++, e += DIM) \{}
\DoxyCodeLine{02273             x[e] = pointmass\_host.ax[i];}
\DoxyCodeLine{02274 \#if DIM > 1}
\DoxyCodeLine{02275             x[e+1] = pointmass\_host.ay[i];}
\DoxyCodeLine{02276 \#if DIM == 3}
\DoxyCodeLine{02277             x[e+2] = pointmass\_host.az[i];}
\DoxyCodeLine{02278 \#endif}
\DoxyCodeLine{02279 \#endif}
\DoxyCodeLine{02280         \}}
\DoxyCodeLine{02281         status = H5Dwrite(a\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02282         status = H5Dclose(a\_id);}
\DoxyCodeLine{02283 }
\DoxyCodeLine{02284 }
\DoxyCodeLine{02285         free(x);}
\DoxyCodeLine{02286         x = (double *)  malloc(sizeof(double) * numberOfPointmasses);}
\DoxyCodeLine{02287 }
\DoxyCodeLine{02288         /* time */}
\DoxyCodeLine{02289         dims[0] = 1;}
\DoxyCodeLine{02290         dataspace\_id = H5Screate\_simple(1, dims, NULL);}
\DoxyCodeLine{02291         time\_id = H5Dcreate2(file\_id, "{}/time"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02292                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02293         status = H5Dwrite(time\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, \&h5time);}
\DoxyCodeLine{02294         status = H5Dclose(time\_id);}
\DoxyCodeLine{02295 }
\DoxyCodeLine{02296         /* mass */}
\DoxyCodeLine{02297         dims[0] = numberOfPointmasses;}
\DoxyCodeLine{02298         dims[1] = 1;}
\DoxyCodeLine{02299         dataspace\_id = H5Screate\_simple(1, dims, NULL);}
\DoxyCodeLine{02300         m\_id = H5Dcreate2(file\_id, "{}/m"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02301                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02302 }
\DoxyCodeLine{02303         for (i = 0; i < numberOfPointmasses; i++)}
\DoxyCodeLine{02304             x[i] = pointmass\_host.m[i];}
\DoxyCodeLine{02305 }
\DoxyCodeLine{02306         status = H5Dwrite(m\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02307         status = H5Dclose(m\_id);}
\DoxyCodeLine{02308 }
\DoxyCodeLine{02309         /* rmin */}
\DoxyCodeLine{02310         rmin\_id = H5Dcreate2(file\_id, "{}/rmin"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02311                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02312         for (i = 0; i < numberOfPointmasses; i++)}
\DoxyCodeLine{02313             x[i] = pointmass\_host.rmin[i];}
\DoxyCodeLine{02314 }
\DoxyCodeLine{02315         status = H5Dwrite(rmin\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02316         status = H5Dclose(rmin\_id);}
\DoxyCodeLine{02317 }
\DoxyCodeLine{02318         /* rmax */}
\DoxyCodeLine{02319         rmax\_id = H5Dcreate2(file\_id, "{}/rmax"{}, H5T\_NATIVE\_DOUBLE, dataspace\_id,}
\DoxyCodeLine{02320                 H5P\_DEFAULT, H5P\_DEFAULT, H5P\_DEFAULT);}
\DoxyCodeLine{02321         for (i = 0; i < numberOfPointmasses; i++)}
\DoxyCodeLine{02322             x[i] = pointmass\_host.rmax[i];}
\DoxyCodeLine{02323 }
\DoxyCodeLine{02324         status = H5Dwrite(rmax\_id, H5T\_NATIVE\_DOUBLE, H5S\_ALL, H5S\_ALL, H5P\_DEFAULT, x);}
\DoxyCodeLine{02325         status = H5Dclose(rmax\_id);}
\DoxyCodeLine{02326 }
\DoxyCodeLine{02327         free(x);}
\DoxyCodeLine{02328         status = H5Fclose(file\_id);}
\DoxyCodeLine{02329 \#endif // GRAVITATING\_POINT\_MASSES}
\DoxyCodeLine{02330 }
\DoxyCodeLine{02331         if (param.verbose) \{}
\DoxyCodeLine{02332             fprintf(stdout, "{}\%d\(\backslash\)n"{}, status);}
\DoxyCodeLine{02333         \}}
\DoxyCodeLine{02334     \}}
\DoxyCodeLine{02335 }
\DoxyCodeLine{02336 \#endif // HDF5IO}
\DoxyCodeLine{02337 }
\DoxyCodeLine{02338 \}}
\DoxyCodeLine{02339 }
\DoxyCodeLine{02340 void *write\_timestep(void *argument)}
\DoxyCodeLine{02341 \{}
\DoxyCodeLine{02342     int timestep = *((int *) argument);}
\DoxyCodeLine{02343     if (timestep < 0) \{}
\DoxyCodeLine{02344         fprintf(stderr, "{}special write because SIGTERM received...\(\backslash\)n"{});}
\DoxyCodeLine{02345     \}}
\DoxyCodeLine{02346     fprintf(stderr, "{}start printing \%d \(\backslash\)n"{}, timestep+1);}
\DoxyCodeLine{02347     // last occurrence of .}
\DoxyCodeLine{02348     char *pch;}
\DoxyCodeLine{02349     pch = strrchr(inputFile.name, '.');}
\DoxyCodeLine{02350     // copy everything except the digits to the output filename}
\DoxyCodeLine{02351     File outputFile;}
\DoxyCodeLine{02352     strncpy(outputFile.name, inputFile.name, pch-\/inputFile.name+1);}
\DoxyCodeLine{02353     outputFile.name[pch-\/inputFile.name+1] = 0;}
\DoxyCodeLine{02354     // what was the start number of the input file?}
\DoxyCodeLine{02355     char inputFileNumber[256];}
\DoxyCodeLine{02356     memcpy(inputFileNumber, pch, strlen(pch)+1);}
\DoxyCodeLine{02357     int startNumber = atoi(inputFileNumber);}
\DoxyCodeLine{02358     // set output filename}
\DoxyCodeLine{02359     char outputFileEnding[256];}
\DoxyCodeLine{02360     sprintf(outputFileEnding, "{}\%04d"{}, startNumber+timestep+1);}
\DoxyCodeLine{02361     strcat(outputFile.name, outputFileEnding);}
\DoxyCodeLine{02362     // write}
\DoxyCodeLine{02363     write\_particles\_to\_file(outputFile);}
\DoxyCodeLine{02364 }
\DoxyCodeLine{02365 \#if TREEDEBUG}
\DoxyCodeLine{02366     // write tree}
\DoxyCodeLine{02367     File treeFile;}
\DoxyCodeLine{02368     strcpy(treeFile.name, outputFile.name);}
\DoxyCodeLine{02369     strcat(treeFile.name, "{}.tree"{});}
\DoxyCodeLine{02370     write\_tree\_to\_file(treeFile);}
\DoxyCodeLine{02371 \#endif}
\DoxyCodeLine{02372     if (timestep < 0) exit(0);}
\DoxyCodeLine{02373 }
\DoxyCodeLine{02374     //pthread\_exit((void*) argument);}
\DoxyCodeLine{02375     fprintf(stderr, "{}end printing \%d \(\backslash\)n"{}, timestep+1);}
\DoxyCodeLine{02376     currentDiskIO = FALSE;}
\DoxyCodeLine{02377     free(argument);}
\DoxyCodeLine{02378     return NULL;}
\DoxyCodeLine{02379 \}}
\DoxyCodeLine{02380 }
\DoxyCodeLine{02381 void get\_performance\_file(File \&file) \{}
\DoxyCodeLine{02382     sprintf(file.name, "{}\%010d.performance"{}, numberOfParticles);}
\DoxyCodeLine{02383 \}}
\DoxyCodeLine{02384 }
\DoxyCodeLine{02385 void clear\_performance\_file() \{}
\DoxyCodeLine{02386     File file;}
\DoxyCodeLine{02387     get\_performance\_file(file);}
\DoxyCodeLine{02388     // open file for writing}
\DoxyCodeLine{02389     if ((file.data = fopen(file.name, "{}w"{})) == NULL) \{}
\DoxyCodeLine{02390         fprintf(stderr, "{}Eih? Cannot write to \%s.\(\backslash\)n"{}, file.name);}
\DoxyCodeLine{02391         exit(1);}
\DoxyCodeLine{02392     \}}
\DoxyCodeLine{02393     fclose(file.data);}
\DoxyCodeLine{02394 \}}
\DoxyCodeLine{02395 }
\DoxyCodeLine{02396 void write\_performance(float *time) \{}
\DoxyCodeLine{02397     File file;}
\DoxyCodeLine{02398     get\_performance\_file(file);}
\DoxyCodeLine{02399     // open file for writing}
\DoxyCodeLine{02400     if ((file.data = fopen(file.name, "{}a"{})) == NULL) \{}
\DoxyCodeLine{02401         fprintf(stderr, "{}Eih? Cannot write to \%s.\(\backslash\)n"{}, file.name);}
\DoxyCodeLine{02402         exit(1);}
\DoxyCodeLine{02403     \}}
\DoxyCodeLine{02404     // write to file}
\DoxyCodeLine{02405     int i;}
\DoxyCodeLine{02406     float totalTime = 0;}
\DoxyCodeLine{02407     for (i = 0; i < 13; i++) \{}
\DoxyCodeLine{02408         fprintf(file.data, "{}\%f\(\backslash\)t"{}, time[i]);}
\DoxyCodeLine{02409         totalTime += time[i];}
\DoxyCodeLine{02410     \}}
\DoxyCodeLine{02411     fprintf(file.data, "{}\%f\(\backslash\)n"{}, totalTime);}
\DoxyCodeLine{02412     fclose(file.data);}
\DoxyCodeLine{02413 \}}
\DoxyCodeLine{02414 }
\DoxyCodeLine{02415 void write\_tree\_to\_file(File file) \{}
\DoxyCodeLine{02416     // open file for writing}
\DoxyCodeLine{02417     if ((file.data = fopen(file.name, "{}w"{})) == NULL) \{}
\DoxyCodeLine{02418         fprintf(stderr, "{}Eih? Cannot write to \%s.\(\backslash\)n"{}, file.name);}
\DoxyCodeLine{02419         exit(1);}
\DoxyCodeLine{02420     \}}
\DoxyCodeLine{02421     // write to file}
\DoxyCodeLine{02422     int i;}
\DoxyCodeLine{02423     for (i = numberOfParticles; i <= maxNodeIndex\_host; i++) \{}
\DoxyCodeLine{02424         fprintf(file.data, "{}\%le\(\backslash\)t"{}, p\_host.x[i]);}
\DoxyCodeLine{02425 \#if DIM > 1}
\DoxyCodeLine{02426         fprintf(file.data, "{}\%le\(\backslash\)t"{}, p\_host.y[i]);}
\DoxyCodeLine{02427 \#if DIM == 3}
\DoxyCodeLine{02428         fprintf(file.data, "{}\%le\(\backslash\)t"{}, p\_host.z[i]);}
\DoxyCodeLine{02429 \#endif}
\DoxyCodeLine{02430 \#endif}
\DoxyCodeLine{02431         fprintf(file.data, "{}\%le\(\backslash\)t"{}, p\_host.m[i]);}
\DoxyCodeLine{02432         fprintf(file.data, "{}\(\backslash\)n"{});}
\DoxyCodeLine{02433     \}}
\DoxyCodeLine{02434     fclose(file.data);}
\DoxyCodeLine{02435 \}}
\DoxyCodeLine{02436 }
\DoxyCodeLine{02437 void write\_fragments\_file() \{}
\DoxyCodeLine{02438     File file;}
\DoxyCodeLine{02439     sprintf(file.name, "{}fragments.input"{});}
\DoxyCodeLine{02440     // write to file}
\DoxyCodeLine{02441     int i;}
\DoxyCodeLine{02442     for (i = 0; i < numberOfParticles; i++) \{}
\DoxyCodeLine{02443         fprintf(file.data, "{}\%le\(\backslash\)t"{}, p\_host.x[i]);}
\DoxyCodeLine{02444 \#if DIM > 1}
\DoxyCodeLine{02445         fprintf(file.data, "{}\%le\(\backslash\)t"{}, p\_host.y[i]);}
\DoxyCodeLine{02446 \#if DIM == 3}
\DoxyCodeLine{02447         fprintf(file.data, "{}\%le\(\backslash\)t"{}, p\_host.z[i]);}
\DoxyCodeLine{02448 \#endif}
\DoxyCodeLine{02449 \#endif}
\DoxyCodeLine{02450         fprintf(file.data, "{}\%le\(\backslash\)t"{}, p\_host.vx[i]);}
\DoxyCodeLine{02451 \#if DIM > 1}
\DoxyCodeLine{02452         fprintf(file.data, "{}\%le\(\backslash\)t"{}, p\_host.vy[i]);}
\DoxyCodeLine{02453 \#if DIM == 3}
\DoxyCodeLine{02454         fprintf(file.data, "{}\%le\(\backslash\)t"{}, p\_host.vz[i]);}
\DoxyCodeLine{02455 \#endif}
\DoxyCodeLine{02456 \#endif}
\DoxyCodeLine{02457         fprintf(file.data, "{}\%le\(\backslash\)t"{}, p\_host.m[i]);}
\DoxyCodeLine{02458         fprintf(file.data, "{}\%le\(\backslash\)t"{}, sml[p\_host.materialId[i]]);}
\DoxyCodeLine{02459         fprintf(file.data, "{}\%le\(\backslash\)t"{}, p\_host.rho[i]);}
\DoxyCodeLine{02460         fprintf(file.data, "{}\(\backslash\)n"{});}
\DoxyCodeLine{02461     \}}
\DoxyCodeLine{02462     fclose(file.data);}
\DoxyCodeLine{02463 \}}
\DoxyCodeLine{02464 }
\DoxyCodeLine{02465 void copyToHostAndWriteToFile(int timestep, int lastTimestep)}
\DoxyCodeLine{02466 \{}
\DoxyCodeLine{02467     cudaVerify(cudaDeviceSynchronize());}
\DoxyCodeLine{02468 }
\DoxyCodeLine{02469     int rc;}
\DoxyCodeLine{02470 }
\DoxyCodeLine{02471 }
\DoxyCodeLine{02472     if (currentDiskIO) \{}
\DoxyCodeLine{02473         if (param.verbose) fprintf(stderr, "{}waiting for i/o thread ...\(\backslash\)n"{});}
\DoxyCodeLine{02474         rc = pthread\_join(fileIOthread, NULL);}
\DoxyCodeLine{02475         assert(0 == rc);}
\DoxyCodeLine{02476     \}}
\DoxyCodeLine{02477 }
\DoxyCodeLine{02478     // calling additional functions to get correct values at timestep}
\DoxyCodeLine{02479     if (param.verbose) \{}
\DoxyCodeLine{02480         printf("{}calling pressure for i/o\(\backslash\)n"{});}
\DoxyCodeLine{02481     \}}
\DoxyCodeLine{02482     cudaVerify(cudaDeviceSynchronize());}
\DoxyCodeLine{02483         cudaVerifyKernel((calculatePressure<<<numberOfMultiprocessors * 4, NUM\_THREADS\_PRESSURE>>>()));}
\DoxyCodeLine{02484 }
\DoxyCodeLine{02485 }
\DoxyCodeLine{02486     // copy particle data back to host}
\DoxyCodeLine{02487     if (param.verbose) printf("{}copying data to host...\(\backslash\)n"{});}
\DoxyCodeLine{02488 }
\DoxyCodeLine{02489 \#if GRAVITATING\_POINT\_MASSES}
\DoxyCodeLine{02490     cudaVerify(cudaMemcpy(pointmass\_host.x, pointmass\_device.x, memorySizeForPointmasses, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02491 \#if DIM > 1}
\DoxyCodeLine{02492     cudaVerify(cudaMemcpy(pointmass\_host.y, pointmass\_device.y, memorySizeForPointmasses, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02493 \#endif}
\DoxyCodeLine{02494     cudaVerify(cudaMemcpy(pointmass\_host.vx, pointmass\_device.vx, memorySizeForPointmasses, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02495 \#if DIM > 1}
\DoxyCodeLine{02496     cudaVerify(cudaMemcpy(pointmass\_host.vy, pointmass\_device.vy, memorySizeForPointmasses, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02497 \#endif}
\DoxyCodeLine{02498     cudaVerify(cudaMemcpy(pointmass\_host.ax, pointmass\_device.ax, memorySizeForPointmasses, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02499 \#if DIM > 1}
\DoxyCodeLine{02500     cudaVerify(cudaMemcpy(pointmass\_host.ay, pointmass\_device.ay, memorySizeForPointmasses, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02501 \#endif}
\DoxyCodeLine{02502 \#if DIM == 3}
\DoxyCodeLine{02503     cudaVerify(cudaMemcpy(pointmass\_host.z, pointmass\_device.z, memorySizeForPointmasses, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02504     cudaVerify(cudaMemcpy(pointmass\_host.vz, pointmass\_device.vz, memorySizeForPointmasses, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02505     cudaVerify(cudaMemcpy(pointmass\_host.az, pointmass\_device.az, memorySizeForPointmasses, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02506 \#endif}
\DoxyCodeLine{02507     cudaVerify(cudaMemcpy(pointmass\_host.m, pointmass\_device.m, memorySizeForPointmasses, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02508     cudaVerify(cudaMemcpy(pointmass\_host.rmin, pointmass\_device.rmin, memorySizeForPointmasses, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02509     cudaVerify(cudaMemcpy(pointmass\_host.rmax, pointmass\_device.rmax, memorySizeForPointmasses, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02510 \#endif // GRAVITATING\_POINT\_MASSES}
\DoxyCodeLine{02511 }
\DoxyCodeLine{02512     cudaVerify(cudaMemcpy(p\_host.x, p\_device.x, memorySizeForTree, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02513 \#if DIM > 1}
\DoxyCodeLine{02514     cudaVerify(cudaMemcpy(p\_host.y, p\_device.y, memorySizeForTree, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02515 \#endif}
\DoxyCodeLine{02516     cudaVerify(cudaMemcpy(p\_host.vx, p\_device.vx, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02517 \#if DIM > 1}
\DoxyCodeLine{02518     cudaVerify(cudaMemcpy(p\_host.vy, p\_device.vy, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02519 \#endif}
\DoxyCodeLine{02520     cudaVerify(cudaMemcpy(p\_host.ax, p\_device.ax, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02521 \#if DIM > 1}
\DoxyCodeLine{02522     cudaVerify(cudaMemcpy(p\_host.ay, p\_device.ay, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02523 \#endif}
\DoxyCodeLine{02524     cudaVerify(cudaMemcpy(p\_host.g\_ax, p\_device.g\_ax, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02525 \#if DIM > 1}
\DoxyCodeLine{02526     cudaVerify(cudaMemcpy(p\_host.g\_ay, p\_device.g\_ay, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02527 \#endif}
\DoxyCodeLine{02528 \#if DIM == 3}
\DoxyCodeLine{02529     cudaVerify(cudaMemcpy(p\_host.z, p\_device.z, memorySizeForTree, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02530     cudaVerify(cudaMemcpy(p\_host.vz, p\_device.vz, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02531     cudaVerify(cudaMemcpy(p\_host.az, p\_device.az, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02532     cudaVerify(cudaMemcpy(p\_host.g\_az, p\_device.g\_az, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02533 \#endif}
\DoxyCodeLine{02534     cudaVerify(cudaMemcpy(p\_host.m, p\_device.m, memorySizeForTree, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02535     cudaVerify(cudaMemcpy(p\_host.depth, p\_device.depth, memorySizeForInteractions, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02536     cudaVerify(cudaMemcpy(p\_host.rho, p\_device.rho, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02537 \#if INTEGRATE\_DENSITY}
\DoxyCodeLine{02538     cudaVerify(cudaMemcpy(p\_host.drhodt, p\_device.drhodt, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02539 \#endif}
\DoxyCodeLine{02540     cudaVerify(cudaMemcpy(p\_host.h, p\_device.h, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02541     cudaVerify(cudaMemcpy(p\_host.materialId, p\_device.materialId, memorySizeForInteractions, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02542     cudaVerify(cudaMemcpy(p\_host.p, p\_device.p, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02543     cudaVerify(cudaMemcpy(p\_host.cs, p\_device.cs, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02544     cudaVerify(cudaMemcpy(p\_host.noi, p\_device.noi, memorySizeForInteractions, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02545     cudaVerify(cudaMemcpy(interactions\_host, interactions, memorySizeForInteractions*MAX\_NUM\_INTERACTIONS, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02546     cudaVerify(cudaMemcpy(childList\_host, (void * )childListd, memorySizeForChildren, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02547 }
\DoxyCodeLine{02548 \#if PALPHA\_POROSITY}
\DoxyCodeLine{02549     cudaVerify(cudaMemcpy(p\_host.pold, p\_device.pold, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02550     cudaVerify(cudaMemcpy(p\_host.alpha\_jutzi, p\_device.alpha\_jutzi, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02551     cudaVerify(cudaMemcpy(p\_host.dalphadt, p\_device.dalphadt, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02552     cudaVerify(cudaMemcpy(p\_host.alpha\_jutzi\_old, p\_device.alpha\_jutzi\_old, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02553 \#endif}
\DoxyCodeLine{02554 \#if SIRONO\_POROSITY}
\DoxyCodeLine{02555     cudaVerify(cudaMemcpy(p\_host.compressive\_strength, p\_device.compressive\_strength, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02556     cudaVerify(cudaMemcpy(p\_host.tensile\_strength, p\_device.tensile\_strength, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02557     cudaVerify(cudaMemcpy(p\_host.K, p\_device.K, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02558     cudaVerify(cudaMemcpy(p\_host.rho\_0prime, p\_device.rho\_0prime, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02559     cudaVerify(cudaMemcpy(p\_host.rho\_c\_plus, p\_device.rho\_c\_plus, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02560     cudaVerify(cudaMemcpy(p\_host.rho\_c\_minus, p\_device.rho\_c\_minus, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02561     cudaVerify(cudaMemcpy(p\_host.shear\_strength, p\_device.shear\_strength, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02562     cudaVerify(cudaMemcpy(p\_host.flag\_rho\_0prime, p\_device.flag\_rho\_0prime, memorySizeForInteractions, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02563     cudaVerify(cudaMemcpy(p\_host.flag\_plastic, p\_device.flag\_plastic, memorySizeForInteractions, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02564 \#endif}
\DoxyCodeLine{02565 }
\DoxyCodeLine{02566 \#if EPSALPHA\_POROSITY}
\DoxyCodeLine{02567     cudaVerify(cudaMemcpy(p\_host.alpha\_epspor, p\_device.alpha\_epspor, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02568     cudaVerify(cudaMemcpy(p\_host.epsilon\_v, p\_device.epsilon\_v, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02569 \#endif}
\DoxyCodeLine{02570 }
\DoxyCodeLine{02571 \#if INTEGRATE\_ENERGY}
\DoxyCodeLine{02572     cudaVerify(cudaMemcpy(p\_host.e, p\_device.e, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02573     cudaVerify(cudaMemcpy(p\_host.dedt, p\_device.dedt, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02574 \#endif}
\DoxyCodeLine{02575 \#if JC\_PLASTICITY}
\DoxyCodeLine{02576     cudaVerify(cudaMemcpy(p\_host.ep, p\_device.ep, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02577     cudaVerify(cudaMemcpy(p\_host.T, p\_device.T, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02578 \#endif}
\DoxyCodeLine{02579 \#if NAVIER\_STOKES}
\DoxyCodeLine{02580     cudaVerify(cudaMemcpy(p\_host.Tshear, p\_device.Tshear, memorySizeForStress, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02581 \#endif}
\DoxyCodeLine{02582 \#if SOLID}
\DoxyCodeLine{02583     cudaVerify(cudaMemcpy(p\_host.S, p\_device.S, memorySizeForStress, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02584     cudaVerify(cudaMemcpy(p\_host.dSdt, p\_device.dSdt, memorySizeForStress, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02585     cudaVerify(cudaMemcpy(p\_host.local\_strain, p\_device.local\_strain, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02586 \#endif}
\DoxyCodeLine{02587 \#if FRAGMENTATION}
\DoxyCodeLine{02588     cudaVerify(cudaMemcpy(p\_host.d, p\_device.d, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02589     cudaVerify(cudaMemcpy(p\_host.dddt, p\_device.dddt, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02590     cudaVerify(cudaMemcpy(p\_host.numActiveFlaws, p\_device.numActiveFlaws, memorySizeForInteractions, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02591     cudaVerify(cudaMemcpy(p\_host.flaws, p\_device.flaws, memorySizeForActivationThreshold, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02592 \#if PALPHA\_POROSITY}
\DoxyCodeLine{02593     cudaVerify(cudaMemcpy(p\_host.damage\_porjutzi, p\_device.damage\_porjutzi, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02594     cudaVerify(cudaMemcpy(p\_host.ddamage\_porjutzidt, p\_device.ddamage\_porjutzidt, memorySizeForParticles, cudaMemcpyDeviceToHost));}
\DoxyCodeLine{02595 \#endif}
\DoxyCodeLine{02596 \#endif}
\DoxyCodeLine{02597 }
\DoxyCodeLine{02598     cudaVerify(cudaDeviceSynchronize());}
\DoxyCodeLine{02599 }
\DoxyCodeLine{02600 }
\DoxyCodeLine{02601     // write data to file}
\DoxyCodeLine{02602     pthread\_attr\_t attr;}
\DoxyCodeLine{02603     pthread\_attr\_init(\&attr);}
\DoxyCodeLine{02604     pthread\_attr\_setdetachstate(\&attr, PTHREAD\_CREATE\_JOINABLE);}
\DoxyCodeLine{02605     int *t = (int*)malloc(sizeof(int));}
\DoxyCodeLine{02606     *t = timestep;}
\DoxyCodeLine{02607     currentDiskIO = TRUE;}
\DoxyCodeLine{02608     h5time = currentTime;}
\DoxyCodeLine{02609     rc = pthread\_create(\&fileIOthread, \&attr, write\_timestep, (void*)t);}
\DoxyCodeLine{02610     pthread\_attr\_destroy(\&attr);}
\DoxyCodeLine{02611     assert(0 == rc);}
\DoxyCodeLine{02612 }
\DoxyCodeLine{02613 \}}

\end{DoxyCode}
