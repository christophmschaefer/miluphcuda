\hypertarget{damage_8cu_source}{}\doxysection{damage.\+cu}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001 /**}
\DoxyCodeLine{00002  * @author      Christoph Schaefer cm.schaefer@gmail.com}
\DoxyCodeLine{00003  *}
\DoxyCodeLine{00004  * @section     LICENSE}
\DoxyCodeLine{00005  * Copyright (c) 2019 Christoph Schaefer}
\DoxyCodeLine{00006  *}
\DoxyCodeLine{00007  * This file is part of miluphcuda.}
\DoxyCodeLine{00008  *}
\DoxyCodeLine{00009  * miluphcuda is free software: you can redistribute it and/or modify}
\DoxyCodeLine{00010  * it under the terms of the GNU General Public License as published by}
\DoxyCodeLine{00011  * the Free Software Foundation, either version 3 of the License, or}
\DoxyCodeLine{00012  * (at your option) any later version.}
\DoxyCodeLine{00013  *}
\DoxyCodeLine{00014  * miluphcuda is distributed in the hope that it will be useful,}
\DoxyCodeLine{00015  * but WITHOUT ANY WARRANTY; without even the implied warranty of}
\DoxyCodeLine{00016  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}
\DoxyCodeLine{00017  * GNU General Public License for more details.}
\DoxyCodeLine{00018  *}
\DoxyCodeLine{00019  * You should have received a copy of the GNU General Public License}
\DoxyCodeLine{00020  * along with miluphcuda.  If not, see <http://www.gnu.org/licenses/>.}
\DoxyCodeLine{00021  *}
\DoxyCodeLine{00022  */}
\DoxyCodeLine{00023 \#include "{}damage.h"{}}
\DoxyCodeLine{00024 \#include "{}miluph.h"{}}
\DoxyCodeLine{00025 \#include "{}timeintegration.h"{}}
\DoxyCodeLine{00026 \#include "{}parameter.h"{}}
\DoxyCodeLine{00027 \#include "{}pressure.h"{}}
\DoxyCodeLine{00028 }
\DoxyCodeLine{00029 \#if FRAGMENTATION}
\DoxyCodeLine{00030 \_\_global\_\_ void damageLimit(void) \{}
\DoxyCodeLine{00031     register int i, inc;}
\DoxyCodeLine{00032     volatile int nof, noaf;}
\DoxyCodeLine{00033     volatile double dmg, dmgMax;}
\DoxyCodeLine{00034     inc = blockDim.x * gridDim.x;}
\DoxyCodeLine{00035     for (i = threadIdx.x + blockIdx.x * blockDim.x; i < numParticles; i += inc) \{}
\DoxyCodeLine{00036         if (EOS\_TYPE\_IGNORE == matEOS[p\_rhs.materialId[i]] || p\_rhs.materialId[i] == EOS\_TYPE\_IGNORE) \{}
\DoxyCodeLine{00037                 continue;}
\DoxyCodeLine{00038         \}}
\DoxyCodeLine{00039         dmg = p.d[i];}
\DoxyCodeLine{00040         if (dmg < 0) dmg = 0;}
\DoxyCodeLine{00041         noaf = p.numActiveFlaws[i];}
\DoxyCodeLine{00042         dmgMax = 1;}
\DoxyCodeLine{00043         if (noaf < 1 \&\& dmg > 0) \{}
\DoxyCodeLine{00044             printf("{}Error, not possible: noaf: \%d, dmg \%e\(\backslash\)n"{}, noaf, dmg);}
\DoxyCodeLine{00045             assert(0);}
\DoxyCodeLine{00046         \}}
\DoxyCodeLine{00047         if (noaf > 0) \{}
\DoxyCodeLine{00048             nof = p.numFlaws[i];}
\DoxyCodeLine{00049             dmgMax = pow( ((double)noaf) / ((double)nof) , 1./DIM);}
\DoxyCodeLine{00050         \}}
\DoxyCodeLine{00051 }
\DoxyCodeLine{00052         if (dmg > dmgMax) \{}
\DoxyCodeLine{00053             dmg = dmgMax;}
\DoxyCodeLine{00054         \} else if (dmg < 0) \{}
\DoxyCodeLine{00055             printf("{}ERROR: DAMAGE is negative \(\backslash\)t \(\backslash\)t"{});}
\DoxyCodeLine{00056             printf("{}\%e \%e \%e \%d \%d\(\backslash\)n"{}, p.x[i], p.y[i], p.d[i], p.numFlaws[i], p.numActiveFlaws[i]);}
\DoxyCodeLine{00057             assert(0);}
\DoxyCodeLine{00058         \}}
\DoxyCodeLine{00059         p.d[i] = dmg;}
\DoxyCodeLine{00060 \#if PALPHA\_POROSITY}
\DoxyCodeLine{00061         if (p.damage\_porjutzi[i] > 1.0) \{}
\DoxyCodeLine{00062             p.damage\_porjutzi[i] = 1.0;}
\DoxyCodeLine{00063         \} else if (p.damage\_porjutzi[i] < 0) \{}
\DoxyCodeLine{00064             p.damage\_porjutzi[i] = 0.0;}
\DoxyCodeLine{00065         \}}
\DoxyCodeLine{00066         dmg = p.d[i] + p.damage\_porjutzi[i];}
\DoxyCodeLine{00067         if (dmg > 1) dmg = 1.0;}
\DoxyCodeLine{00068 \#endif}
\DoxyCodeLine{00069         p.damage\_total[i] = dmg;}
\DoxyCodeLine{00070     \}}
\DoxyCodeLine{00071 \}}
\DoxyCodeLine{00072 \#endif}

\end{DoxyCode}
